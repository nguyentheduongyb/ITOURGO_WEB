@{

    string strTitleURL = ViewContext.RouteData.Values["strTitleURL"].ToString();
    var langID = APP_B2B_PUB.Controllers.HomeController.GetLangID(Request.QueryString["lang"]);


    @functions {
        public static string GetUrl(string strTxt)
        {
            return APP_B2B_PUB.Controllers.HomeController.GetUrl(strTxt);
        }
        public static string GetFormatDateTime(string strTxt)
        {
            return APP_B2B_PUB.Controllers.HomeController.GetFormatDateTime(strTxt);
        }
    }


    System.Data.DataSet ds = APP_B2B_PUB.Controllers.HotelController.GetListSupplierForHotelByPUB("{"
        + "strUserGUID: '47ecbd6d-897a-4a41-a061-95d5d3b166b6'"
        + ",strCompanyPartnerGUID: 'e824fd66-a3ca-46f4-a1be-ab7a0d1f6137'"
        + ",strCompanyOwnerGUID: null"
        + ",strSupplierNameURL: '" + strTitleURL + "'"
        + ", strFilterSupplierName: null"
        + ", strFilterLocationCode: null"
        + ", strPriceFromRange: null"
        + ", intNoOfRooms: null"
        + ", dtmFilterCheckIn: null"
        + ", dtmFilterCheckOut: null"
        + ", IsShowAll: 1"
        + ", strListEasiaCateID: null"
        + ",intCurPage: null"
        + ",intPageSize: null"
        + ",strOrder:null"
        + ",tblsReturn:'[0]'"
        + "}");


    System.Data.DataRow objDetail = ds.Tables[0].Rows[0];

    var strTitle = objDetail["strSupplierName"];

    string storageItem = Request.QueryString["lang"];
    string verFile = System.Guid.NewGuid().ToString().Substring(0, 5);

    ViewBag.Lang = Request.QueryString["lang"];
    ViewBag.Title = strTitle;
    ViewBag.Keywords = objDetail["strMetaKeyword"];
    ViewBag.Description = objDetail["strMetaDescription"];
    ViewBag.ImagePage = GetUrl("strImgURL") + "" + objDetail["strSupplierImage"];
}
    <app-content-display>

        <script src="~/Lib_Custom/Hotel/layouts/layout-breadcrumb.js?v=@verFile"></script>
        <script src="~/Lib_Custom/Hotel/layouts/layout-searchbar.js?v=@verFile"></script>
        <div id="pnSearchbar"></div>
        <app-breadcrumb-root></app-breadcrumb-root>
        <script src="https://sp.zalo.me/plugins/sdk.js"></script>
        <div id="Content">
            <div class="panel-itl" style="background:#F5F7F8">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div id="pnSupInfo" class="col-md-12">
                                    
                                    <div class="row">
                                         <div class="col-md-4 pn-padding-b-15">
                                            <a action="ViewDetail" title="Nhấn để xem ảnh"><img src="@(!String.IsNullOrEmpty(objDetail["strSupplierImage"].ToString()) ? GetUrl("strImgURL")+objDetail["strSupplierImage"] : "/Lib_Common/assets/images/img-noimage.png")" alt="" border="0" width="100%" height="100%" class="pnImage"></a>
                                            <div class="pnGallery" style="background-color: white;"></div>
                                         </div>
                                         <div class="col-md-8">
                                            <h3 style="margin-top:0">@Html.Raw(@objDetail["strSupplierName"])</h3>
                                            @*<div style="color: #f1ce09; ">' + $.pngHtmlStars(Obj_Detail.intEasiaCateID) + '</div>*@
                                            <p><b>Địa chỉ: </b>@Html.Raw(@objDetail["strSupplierAddr"])</p>
                                            <p><b>Mô tả: </b></p>
                                            <p>@(@objDetail["strDescription"].ToString() == null ? Html.Raw("<i>Không có dữ liệu</i>") : @Html.Raw(objDetail["strDescription"]))</p>
                                         </div>
                                    </div>
                                </div>
                                <div id="pnListRoom" class="col-md-12"></div>
                                <div id="pnChildPolicy" class="col-md-12"></div>
                                <div id="pnInExclude" class="col-md-12 pn-margin-t-30"></div>
                                <div id="pnFOC" class="col-md-12"></div>
                                <div id="pnPayemntTerm" class="col-md-12"></div>
                                <div id="pnCancellation" class="col-md-12"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">


            $.ModuleMainLead_Hotel_Detail = function (options) {
                var defaults = {
                    strUserGUID: '47ecbd6d-897a-4a41-a061-95d5d3b166b6'
                    , strCompanyPartnerGUID: 'e824fd66-a3ca-46f4-a1be-ab7a0d1f6137'
                    , strCompanyOwnerGUID: null,
                    OnSuccess: function () {

                    }
                }
                options = $.extend(defaults, options);

                var IdOrClass_Main = "#Content"


                var Obj_SearchDtl = $.ModuleLayouts_Searchbar_GetValue()

                var Obj_User = JSON.parse(png.ArrLS.UserDetail.get());

                options.strUserGUID =  (Obj_User ? Obj_User.strPassengerGUID : null)

                console.log(options.strUserGUID)

                var Obj_Detail = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(objDetail))
                    Obj_Detail = Obj_Detail.Table[0]

                var ObjList_Api = {
                    // GetListSupplier:{
                    //     strApiLink:'api/supplier/GetListSupplier'
                    //     ,objParams:{
                    //         strUserGUID: options.strUserGUID
                    //         ,strSupplierOnlineGUID: $.pngGetQSVal("idmdit")
                    //         ,strOwnerCompanyGUID: options.strCompanyOwnerGUID
                    //         ,intCateID: 1
                    //         ,intCurrencyView : JSON.parse(png.ArrLS.Currency.get()).intCurrencyID

                    //         ,strFilterSupplierName: null
                    //         ,strPriceFromRange : null

                    //         ,strOrder: null
                    //         ,intCurPage: 1
                    //         ,intPageSize: 1
                    //         ,tblsReturn : '0'
                    //     }
                    // }
                    // ,GetListAllotmentDetailForHotel: {
                    //     strApiLink:'api/supplier/GetListAllotmentDetailForHotel'
                    //     ,objParams:{
                    //         strUserGUID:options.strUserGUID
                    //         ,strCompanyOwnerGUID: options.strCompanyOwnerGUID
                    //         ,strSupplierOnlineGUID: $.pngGetQSVal("idmdit")
                    //         ,strAllotmentDetailGUID: null
                    //         ,dtmAllotmentDateFrom: null
                    //         ,dtmAllotmentDateTo:  null
                    //         ,intCurPage:null
                    //         ,intPageSize:null
                    //         ,strOrder: null
                    //         ,tblsReturn:"[0][1]"
                    //     }
                    // }
                    // ,GetListPriceLevelSupplierForHotel: {
                    //     strApiLink:'api/supplier/GetListPriceLevelSupplierForHotel'
                    //     ,objParams:{
                    //         strUserGUID:options.strUserGUID
                    //         ,strSupplierOnlineGUID: $.pngGetQSVal("idmdit")
                    //         ,strPriceLevelGUID: JSON.parse(png.ArrLS.CompanyFriend.get()).strPriceLevelGUID
                    //         ,strCompanyOwnerGUID: options.strCompanyOwnerGUID

                    //         ,dtmFilterCheckInDate: null
                    //         ,dtmFilterCheckOutDate: null

                    //         ,intCurPage:null
                    //         ,intPageSize:null
                    //         ,strOrder: null
                    //         ,tblsReturn:"[0][1]"
                    //     }
                    // }
                    AddPassengerOrderForSupByHotelByPUB: {
                        strApiLink: 'api/public/traveller/AddPassengerOrderForSupByHotelByPUB'
                        , objParams: {
                            strUserGUID: (Obj_User ? Obj_User.strPassengerGUID : null)
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strCompanyOwnerGUID: options.strCompanyOwnerGUID
                            , strPriceLevelGUID: null
                            , strPriceListGUID: null

                            , strOrderBookingGUID: null
                            , intAdult: null
                            , strListChildAge: null
                            , strListItemTypeGUID: null
                            , strListSupplierChildAgeGUID: null
                            , strListSurchargeDateGUID: null
                            , IsBookNotMinstay: null
                            , dtmDateFrom: null
                            , dtmDateTo: null
                        }
                    }


                    , GetListSupplierForHotelByPUB: {
                        strApiLink: 'api/public/supplier/GetListSupplierForHotelByPUB'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strCompanyPartnerGUID: options.strCompanyPartnerGUID
                            , strCompanyOwnerGUID: options.strCompanyOwnerGUID
                            //, strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strSupplierNameURL: Obj_Detail.strSupplierNameURL
                            , strFilterLocationCode: null
                            , intNoOfRooms: null
                            , dtmFilterCheckIn: null
                            , dtmFilterCheckOut: null
                            , IsShowAll: 1
                            , strFilterSupplierName: null
                            , strPriceFromRange: null
                            , strListEasiaCateID: null
                            , intCurPage: 1
                            , intPageSize: 1
                            , strOrder: null
                            , tblsReturn: '[0][1]'
                        }
                    }

                    , GetListSupplierMappingPriceForHotelByPUB: {
                        strApiLink: 'api/public/supplier/GetListSupplierMappingPriceForHotelByPUB'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierMappingPriceGUID: null
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strPriceListGUID: null
                            //, strPriceLevelGUID: null
                            , strCompanyOwnerGUID: null
                            , dtmFilterCheckIn: null
                            , dtmFilterCheckOut: null
                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    }
                    , GetListSupplierChildAge: {
                        strApiLink: 'api/public/supplier/GetListSupplierChildAge'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strSupplierChildAgeGUID: null
                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },
                    GetListSurchargeDateForAgent: {
                        strApiLink: 'api/public/supplier/GetListSurchargeDateForAgent'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strCompanyOwnerGUID: null
                            , dtmFilterDateFrom: null
                            , dtmFilterDateTo: null
                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },
                    GetListSupplierImageFile: {
                        strApiLink: 'api/public/supplier/GetListSupplierImageFile'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierImageFileGUID: null
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strItemTypeGUID: null
                            , strSupplierImageFileLink: null

                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },
                    GetListItemTypeDetailByAgent: {
                        strApiLink: 'api/public/supplier/GetListItemTypeDetailByAgent'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strCompanyOwnerGUID: null
                            , strItemTypeDetailGUID: null
                            , strItemTypeGUID: null

                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },


                    GetListItemTypeByAgent:{
                        strApiLink:'api/public/supplier/GetListItemTypeByAgent'
                        ,objParams:{
                            strUserGUID : options.strUserGUID
                            ,strItemTypeGUID: null
                            ,strSupplierGUID: Obj_Detail.strSupplierGUID
                            ,strCompanyOwnerGUID: null

                            ,intCurPage: null
                            ,intPageSize: null
                            ,strOrder: null
                            ,tblsReturn:'[0]'
                        }
                    },


                    GetListSupplierPaymentTerm: {
                        strApiLink: 'api/public/supplier/GetListSupplierPaymentTerm'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierPaymentTermGUID: null
                            , strCompanyGUID: null
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , dtmCheckInDate: null
                            , intProductIDForBook: null
                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: 'IsDepositOnBook desc,intDayTo desc'
                            , tblsReturn: '[0]'
                        }
                    },

                    GetListSupplierCancellationPolicy: {       // Tên api
                        strApiLink: 'api/public/supplier/GetListSupplierCancellationPolicy' // api/eeeeeeee: route Prefix
                        , objParams: {                // Tham số cần cung cấp cho api
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strCompanyGUID: null
                            , strSupplierCancellationPolicyGUID: null
                            , dtmCheckInDate: null
                            , intProductIDForBook: null
                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: 'IsDepositedLost desc,intTo desc'
                            , tblsReturn: '[0]'
                        }
                    },

                    GetListFoc: {
                        strApiLink: 'api/public/supplier/GetListFoc'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strFocGUID: null
                            , strPriceListGUID: null
                            , intFOCTypeID: null
                            , dtmFilterDateFrom: null
                            , dtmFilterDateTo: null

                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },

                    GetListLinkSupplierChildAge: {
                        strApiLink: 'api/public/supplier/GetListLinkSupplierChildAge'
                        , objParams: {
                            strUserGUID: options.strUserGUID,
                            strLinkSupplierChildAgeGUID: null,
                            strItemTypeGUID: null,
                            intCurPage: null,
                            intPageSize: null,
                            strOrder: null,
                            tblsReturn: '[0]',
                        }
                    },

                    GetListPolicyNotes: {
                        strApiLink: 'api/public/supplier/GetListPolicyNotes'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , strPolicyNotesGUID: null
                            , strFilterPolicyName: null
                            , intPolicyTypeID: null
                            , dtmFilterDateTravelFrom: null
                            , dtmFilterDateTravelTo: null

                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },

                    GetListPriceList: {
                        strApiLink: 'api/public/supplier/GetListPriceList'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strPriceListGUID: null
                            , IsNotInPriceList: null
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , IsAddSystem: 1

                            , intCurPage: 1
                            , intPageSize: 10
                            , strOrder: 'IsSystem DESC,strPriceListName'
                            , tblsReturn: '[0]'
                        }
                    },


                    GetListPriceListForCompany: {
                        strApiLink: 'api/public/supplier/GetListPriceListForCompany'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strPriceListGUID: null
                            , IsNotInPriceList: null
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , IsAddSystem: 1
                            , strCompanyGUID: null
                            , IsEnable: 1

                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: null
                            , tblsReturn: '[0]'
                        }
                    },

                    AddBookingRequestForHotel: {
                        strApiLink: 'api/request/AddBookingRequestForHotel'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: null
                            , strCompanyPartnerGUID: null
                            , strCompanyOwnerGUID: null
                            , strPriceLevelGUID: null
                            , strPriceListGUID: null

                            , intAdult: null
                            , strListChildAge: null
                            , strListItemTypeGUID: null
                            , strListSupplierChildAgeGUID: null
                            , strListSurchargeDateGUID: null
                            , IsBookNotMinstay: null
                            , dtmDateFrom: null
                            , dtmDateTo: null
                            , strBookingRequestDescription: null
                            , intLangID: $.pngGetLangID()
                        }
                    },
                }

                var ObjList_ComboValue = {
                }


                var Str_CompanyOwnerGUID = ''
                var Str_PriceLevelGUID = ''

                var Arr_ListRoomType = []

                var ArrPriceRoom = []
                var Arr_ListDate = []
                var ArrPriceChildAge = []

                var Arr_Surcharge = []
                var Arr_ImageFile = []
                var Arr_ListFoc = []
                var Arr_ListPolicy = []

                var Arr_ListBook = []
                var Arr_ListBookFOC = []
                var Is_BookNotMinstay = null

                var Arr_ListMarket = []


                var Dbl_TotalAllPrice = 0

                var Obj_FormInput = {}
                var Obj_FormValDtl = {}
                var Arr_ListAgentHost = []
                var Obj_DetailAgentHost = {}

                var Arr_ListItemType = []
                var Arr_ListRoomType = []
                var Arr_ListOptionsChild = []

                var Int_ProductID = 1

                var Obj_FN_Main = {}

                png.postListApiGetValue({
                    objList_Api: ObjList_Api
                    //,objList_ComboValue: ObjList_ComboValue
                    , objListApi_RtnVal: {
                        'GetListSupplierForHotelByPUB': {
                            objParams_Cus: {
                                dtmFilterCheckIn: Obj_SearchDtl.dtmDateCheckIn,
                                tblsReturn: '[1]',
                            }
                            , OnSuccess: function (data) {

                                Arr_ListAgentHost = JSON.parse(data)[1]

                                if($.pngGetQSVal('strCompanyOwnerGUID')){
                                    // $('.strCompanyOwnerGUID',IdOrClass_Pn).val($.pngGetQSVal('strCompanyOwnerGUID'))
                                    Obj_DetailAgentHost = Arr_ListAgentHost.filter(function(item){ return item.strCompanyOwnerGUID.toUpperCase() == $.pngGetQSVal('strCompanyOwnerGUID').toUpperCase() })[0]
                                }else{
                                    // window.history.replaceState("", "", $.pngGetQSVal('strCompanyOwnerGUID', $('.strCompanyOwnerGUID',IdOrClass_Pn).val()));
                                    Obj_DetailAgentHost = Arr_ListAgentHost[0]
                                }

                                Str_CompanyOwnerGUID = Obj_DetailAgentHost.strCompanyOwnerGUID
                                Str_PriceLevelGUID = Obj_DetailAgentHost.strPriceLevelGUID

                                // return JSON.parse(data)[0]
                            }
                        },
                        GetListSupplierImageFile: {
                            objParams_Cus: {
                                tblsReturn: '[0]'
                            }
                            , OnSuccess: function (data) {

                                Arr_ImageFile = JSON.parse(data)[0]
                            }
                        },
                        // GetListPriceList:{
                        //     objParams_Cus:{
                        //         tblsReturn : '[0]'
                        //     }
                        //     ,OnSuccess: function(data){

                        //         Arr_ListMarket = JSON.parse(data)[0]

                        //     }
                        // },

                    }
                    //,objListComboValue_RtnVal: ObjListComboValue_RtnVal
                    , OnSuccessList: function (data) {

                        var objSearchDtl = {}

                        objSearchDtl['objDestination'] = {}
                        objSearchDtl['objDestination'][Obj_Detail.strLocationCode] = Obj_Detail.strSupplierName
                        objSearchDtl.objDestination.strSupplierGUID = Obj_Detail.strSupplierNameURL


                        $.ModuleLayouts_Searchbar({ idOrClass: '#pnSearchbar', objSearchDtl: objSearchDtl })


                        $.ModuleLayouts_BreadCrumb_ParAndChildDestination({
                            strLocation: Obj_Detail.strLocationCode,
                            OnSuccess: function (arrBrcbItems) {
                                arrBrcbItems.push({ id: '', title: Obj_Detail.strSupplierName, url: '' })
                                $.ModuleLayouts_BreadCrumb({ arrBrcbItems: arrBrcbItems })
                            }
                        })

                        png.postListApiGetValue({
                            objList_Api: ObjList_Api
                            //,objList_ComboValue: ObjList_ComboValue
                            , objListApi_RtnVal: {
                                GetListPriceListForCompany: {
                                    objParams_Cus: {
                                        strCompanyGUID: Str_CompanyOwnerGUID,
                                        tblsReturn: '[0]',
                                    }
                                    , OnSuccess: function (data) {

                                        Arr_ListMarket = JSON.parse(data)[0]
                                    }
                                },

                                GetListItemTypeByAgent: {
                                    objParams_Cus: {
                                        strCompanyOwnerGUID: Str_CompanyOwnerGUID,
                                        tblsReturn: null,
                                    }
                                    , OnSuccess: function (data) {

                                        Arr_ListItemType = JSON.parse(data)[0]
                                        Arr_ListRoomType = JSON.parse(data)[1]
                                        Arr_ListOptionsChild = JSON.parse(data)[2]

                                        Arr_ListItemType.forEach(function(value){
                                            value.arrListRoomType = Arr_ListRoomType.filter(function(item){ return item.strItemTypeGUID.toUpperCase() == value.strItemTypeGUID.toUpperCase()})
                                        })

                                    }
                                },
                            },
                            OnSuccessList: function (data) {

                                GetMainPanel()
                            }
                        })
                    }
                })
                function GetMainPanel() {

                    pnSupInfo("#pnSupInfo")
                    function pnSupInfo(_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var intKey = 0

                        $('a[action=ViewDetail]', IdOrClass_Pn).click(function () {
                            GetPopUp_ViewImage({ intKey: 0 })
                        })


                        if (Arr_ImageFile.length) {

                            // Arr_ImageFile.unshift({strSupplierImageFileLink:Obj_Detail.strSupplierImage})
                            var strHtml = ''
                            strHtml += '<div style="display: flex;">'
                            var intMoreImg = -1
                            Arr_ImageFile.forEach(function (value, key) {
                                if (key < 2) {
                                    var strUrl = (value.strSupplierImageFileLink ? png.getServerImgURL(value.strSupplierImageFileLink) : coreSystem.getLib_CommonURL('assets/images/img-noimage.png'))
                                    strHtml += '<div class="item" style="background:url(\'\') no-repeat center;background-size: cover;width: 33.33%;cursor:pointer;float:left;display: inline-table;" intKey="' + key + '" data="' + strUrl + '">'
                                    strHtml += '<img src="' + strUrl + '" style="height: 50px;width:100%">'
                                    strHtml += '</div>'
                                } else {
                                    intMoreImg += 1
                                }
                            })

                            if (Arr_ImageFile[2]) {
                                var strUrl = (Arr_ImageFile[2].strSupplierImageFileLink ? png.getServerImgURL(Arr_ImageFile[2].strSupplierImageFileLink) : coreSystem.getLib_CommonURL('assets/images/img-noimage.png'))
                                strHtml += '<div class="item" style="background:url(\'' + strUrl + '\') no-repeat center;background-size: cover;height: 50px;width: 33.33%;cursor:pointer;float:left;display: inline-table;" intKey="4" data="' + strUrl + '">'

                                if (intMoreImg > 0) {
                                    strHtml += '<span style="width: 100%;height: 100%;display: table-cell;background: #0000004d;color: #fff;text-align: center;vertical-align: middle;">+' + intMoreImg + '</span>'
                                }
                            }

                            strHtml += '</div>'
                            strHtml += '</div>'
                            $('.pnGallery').html(strHtml)


                            // $('.pnGallery .item').css('opacity', '0.5')

                            var FN_TimeUOut = null
                            // GetViewImage(intKey)


                            $('.pnGallery .item').click(function () {

                                var data = $(this).attr('data')

                                intKey = $(this).attr('intKey').getNumber()
                                // GetViewImage(intKey)
                                // GetNextImage()

                                GetPopUp_ViewImage({ intKey: intKey })
                            })


                            function GetViewImage(_intKey) {
                                var intKey = _intKey
                                var strUrl = (Arr_ImageFile[intKey].strSupplierImageFileLink ? png.getServerImgURL(Arr_ImageFile[intKey].strSupplierImageFileLink) : coreSystem.getLib_CommonURL('assets/images/img-noimage.png'))
                                $(IdOrClass_Pn + ' .pnImage').attr('src', strUrl)

                                $('.pnGallery .item').css('opacity', '0.5')
                                $('.pnGallery .item[intKey=' + intKey + ']').css('opacity', '1')

                                // var col = $('.pnGallery .item[intKey=' + intKey + ']')[0];
                                // var div = $('.pnGallery')[0];
                                // if (col != null && div != null) {
                                //     div.scrollLeft = col.offsetLeft;
                                // }

                                if ($(window).scrollTop() > $('.pnImage', IdOrClass_Pn).offset().top - 100)
                                    $(window).scrollTop($('.pnImage', IdOrClass_Pn).offset().top - 100)
                            }

                        }

                    }

                    //pnSupPrice("#pnSupPrice")
                    function pnSupPrice(_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''

                        if ($(window).width() >= 1024) {

                            strHtml += '<div>'
                            strHtml += ' <div class="pnCntBook" style="background:#fff;padding:20px;border-radius:1em;box-shadow: 0px 0px 18px -7px;">'
                            strHtml += '     <h3 style="font-weight:bold;color:#257EF8">Đặt khách sạn</h3>'
                            strHtml += '     <div class="pn-padding-t-b-15">'
                            strHtml += '     <div id="pnForm"></div>'
                            strHtml += '     <div class="pnPriceBooking"></div>'
                            strHtml += '     </div>'
                            strHtml += ' </div>'
                            strHtml += ' </div>'
                            $(IdOrClass_Pn).html(strHtml)

                            var lastScrollTop = 100;

                            var intTop = 100
                            $(window).scroll(function () {

                                var st = $(this).scrollTop();

                                if ($(IdOrClass_Pn + '>div').height() < $(IdOrClass_Pn).parent().height()) {

                                    var strPn = $(IdOrClass_Pn + '>div').width();
                                    if ($(this).scrollTop() + 100 > $(IdOrClass_Main).offset().top) {

                                        if (st > lastScrollTop) {
                                            // downscroll code

                                            if (($(this).scrollTop() + $(window).height()) < ($(IdOrClass_Pn + '>div').offset().top + $(IdOrClass_Pn + '>div').height()) || ($(this).scrollTop() + $(window).height()) > $('app-footer-root').offset().top ) {


                                                intTop = intTop + (lastScrollTop - st)

                                            }


                                        } else {
                                            // upscroll code

                                            intTop = intTop + (lastScrollTop - st)


                                        }

                                        if (intTop > 100) {
                                            intTop = 100
                                        }

                                        $(IdOrClass_Pn + '>div').attr('style', 'position:fixed;top: ' + intTop + 'px;width:' + strPn + 'px')

                                    } else {
                                        intTop = 100
                                        $(IdOrClass_Pn + '>div').attr('style', '')
                                    }

                                } else {
                                    $(IdOrClass_Pn + '>div').attr('style', '')
                                }

                                lastScrollTop = st;

                            });

                        } else {



                            strHtml += '<div class=" pn-round-1em" style="position:fixed;bottom:0;right:0;left:0;z-index:1;background:#fff;box-shadow: 0px 0px 18px -7px;">'
                            strHtml += '<div class="showhide" style="background: #e6e6e6;text-align: center;"><i class="fa fa-angle-double-down"></i></div>'
                            strHtml += '<div style="background:#fff;padding:15px;" class="pnCntBook">'
                            strHtml += '     <div class="row">'
                            strHtml += '         <div ìd="col-md-12" id="pnForm" style="display:none"></div>'
                            strHtml += '        <div class="col-xs-12" style="">'
                            strHtml += '            <div class="pnPriceBooking"> </div>'
                            strHtml += '            <div><a action="ViewCustom">Thay đổi thông tin</a> - <a action="ViewDetail">Xem chi tiết</a></div>'
                            strHtml += '        </div>'
                            // strHtml+= '        <div class="col-xs-6">'
                            // strHtml+= '             <div><button id="btnBook" class="btn" style="padding: 5px;background: #257ef8;color: #fff;width: 100%;border-radius: 10em;">BOOK NOW</button></div>'
                            // strHtml+= '        </div>'
                            strHtml += '     </div>'
                            strHtml += '</div>'
                            strHtml += '</div>'


                            $(IdOrClass_Pn).html(strHtml)
                            $(IdOrClass_Pn + ' .showhide').click(function () {
                                if ($(this).find('i').hasClass('fa-angle-double-down')) {
                                    $(IdOrClass_Pn + ' .pnCntBook').hide()
                                    $(this).find('i').removeClass('fa-angle-double-down').addClass('fa-angle-double-up')
                                } else {
                                    $(IdOrClass_Pn + ' .pnCntBook').show()
                                    $(this).find('i').removeClass('fa-angle-double-up').addClass('fa-angle-double-down')
                                }
                            })

                            $('a[action=ViewCustom]', IdOrClass_Pn).click(function () {
                                GetPanelFullScreen(function (_idOrClassPn) {

                                    Obj_SearchDtl = $.ModuleLayouts_Searchbar_GetValue()

                                    var strHtml = ''
                                    strHtml += '<div class="pn-padding-15">'
                                    strHtml += '<div class="pnCnt"></div>'
                                    strHtml += '<div><button class="btnSubmit btn bg-primary">Submit</button></div>'
                                    strHtml += '</div>'
                                    $(_idOrClassPn).html(strHtml)


                                    GetForm(_idOrClassPn + ' .pnCnt', true)

                                    $('.btnSubmit', _idOrClassPn).click(function () {

                                        Obj_FormValDtl = GetFromValDtl(_idOrClassPn + ' .pnCnt')


                                        $.ModuleLayouts_Searchbar_GetValue(Obj_SearchDtl)

                                        GetPrice(true)
                                        $('.pnFullScreen').remove()

                                    })
                                })
                            })

                            $('a[action=ViewDetail]', IdOrClass_Pn).click(function () {
                                GetPanelFullScreen(function (_idOrClassPn) {


                                    var strHtml = ''
                                    strHtml += '<div class="pn-padding-15">'
                                    strHtml += ($('#pnSupPrice .pnListBook').html() || 'Bạn chưa chọn Dịch vụ nào')
                                    strHtml += '</div>'
                                    $(_idOrClassPn).html(strHtml)

                                })
                            })
                        }

                        GetForm(IdOrClass_Pn + ' #pnForm', false)

                        Obj_FormValDtl = GetFromValDtl(IdOrClass_Pn + ' #pnForm')

                        function GetForm(_idOrClassPn, _IsMobile) {
                            Obj_FormInput = {
                                dtmDateCheckIn_dtmDateCheckOut: {
                                    title: pngElm.getLangKey({ langkey: 'sys_Txt_CheckIn' }) + ' - ' + pngElm.getLangKey({ langkey: 'sys_Txt_CheckOut' }), attr: 'class="col-md-12"', isRequire: true, IsRtn: true
                                    , datePickerRange: { todayHighlight: true, format: 'dd/mm/yyyy', weekStart: 1, startDate: new Date(), endDate: null, diffmin: 1, diffmax: 30 },
                                }
                                , pnAgeAndRoom: {
                                    title: '', attr: "class='col-md-12'"
                                    , input: { IsNoInput: true }
                                }
                            }

                            pngPn.getForm({
                                action: 1,
                                objInput: Obj_FormInput,
                                idOrClass: _idOrClassPn,
                                objDetail: Obj_SearchDtl
                            })

                            GetMain_GetAgeAndRoom(_idOrClassPn + ' .pnElm-pnAgeAndRoom', function () {

                                if (!_IsMobile) {
                                    $.ModuleLayouts_Searchbar_GetValue(Obj_SearchDtl)

                                    GetListRoom()
                                }
                            })

                            var FN_TimeOut = null
                            $('.hasDatepicker', _idOrClassPn + ' .pnElm-dtmDateCheckIn_dtmDateCheckOut').on('changeDate', function () {

                                if (!_IsMobile) {

                                    Obj_FormValDtl = GetFromValDtl(_idOrClassPn)

                                    clearTimeout(FN_TimeOut)

                                    FN_TimeOut = setTimeout(function () {
                                        GetPrice(true)
                                    }, 100)
                                }
                            });


                        }



                        function GetMain_GetAgeAndRoom(idOrClassPn, _OnRtn) {


                            var strHtml = ''
                            strHtml += '<div class=" dropdown">'
                            strHtml += '    <a class="form-control" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">'
                            strHtml += '        <span id="ListNoPaxAndNoRoom2"></span> <i class="fa fa-angle-down" style="float: right;  margin-left: 5px;  line-height: 20px;"></i>'
                            strHtml += '    </a>'
                            strHtml += '    <ul class="dropdown-menu open-right" id="ddlAgeType2" style="width: min-content;">'
                            strHtml += '        <form role="form" style="display: inline-flex">'
                            strHtml += '            <div id="pnInputAgeType2" style="padding: 15px;"></div>'
                            strHtml += '            <style>'
                            strHtml += '                #pnInputAgeType2 #pnChildren{'
                            strHtml += '                    max-height: 30vh;overflow-x: hidden;'
                            strHtml += '                }'
                            strHtml += '            </style>'
                            strHtml += '            '
                            strHtml += '        </form>'
                            strHtml += '        <div style="padding: 15px;padding-top:0"><button id="btnSaveNoOfPax" class="btn btn-texticon bg-primary"><i class="fa fa-floppy-o"></i><span langkey="sys_Btn_Save"></span></button></div>'
                            strHtml += '    </ul>'
                            strHtml += '</div>'
                            $(idOrClassPn).html(strHtml)

                            var IntNoAdult, ArrChildren, ObjNoOfRoom

                            var ObjOrderDetail = null
                            //coreLoadPage.viewOrderBooking({
                            //    IsGetDetail: true
                            //    , OnSuccess: function (_objOrderDetail) {
                            //        ObjOrderDetail = _objOrderDetail
                            //    }
                            //})

                            if (ObjOrderDetail) {
                                Obj_SearchDtl.intNoAdult = ObjOrderDetail.intAdults
                                Obj_SearchDtl.arrChildren = ObjOrderDetail.arrChildren
                                Obj_SearchDtl.objNoOfRoom = ObjOrderDetail.objNoOfRoom
                            }

                            var strHtml_AgeType = ''
                            pngElm.getAgeType({
                                idOrClass: idOrClassPn + ' #pnInputAgeType2'
                                , intNoAdult: JSON.parse(JSON.stringify(Obj_SearchDtl)).intNoAdult
                                , arrChildren: JSON.parse(JSON.stringify(Obj_SearchDtl)).arrChildren
                                , intNoRoom: null
                                // ,objNoOfRoom: JSON.parse(JSON.stringify(Obj_SearchDtl)).objNoOfRoom
                                , IsViewDblRoom: true
                                , OnSuccess: function (intNoAdults, arrChildren, objNoOfRoom) {

                                    var intNoRooms = 0
                                    Object.keys(objNoOfRoom).forEach(function (value) {
                                        intNoRooms += objNoOfRoom[value]
                                    })

                                    strHtml_AgeType = ''
                                    strHtml_AgeType += '<span>' + intNoAdults + ' <span langkey="sys_Txt_Hd_shtAdt"></span></span>'
                                    strHtml_AgeType += ' - <span>' + arrChildren.length + ' <span langkey="sys_Txt_Hd_shtKid"></span></span>'
                                    // if(intNoRooms)
                                    //     strHtml_AgeType+= ' - <span>'+intNoRooms+' <span langkey="sys_Txt_Hd_shtRoom"></span></span>'


                                    IntNoAdult = intNoAdults
                                    ArrChildren = arrChildren

                                    // ObjNoOfRoom = objNoOfRoom

                                    pngElm.ChangeLanguage()
                                }
                            })
                            $('#ListNoPaxAndNoRoom2', idOrClassPn).html(strHtml_AgeType)

                            if (ObjOrderDetail) {
                                $('.pnElm-strAgeRange', idOrClassPn + ' #pnInputAgeType2').hide()
                                $('a.exp', idOrClassPn + ' #pnInputAgeType2').hide()
                                $('a.add', idOrClassPn + ' #pnInputAgeType2').hide()
                                $('#pnChildren a', idOrClassPn + ' #pnInputAgeType2').hide()
                                $(idOrClassPn + ' #btnSaveNoOfPax').hide()

                                $(idOrClassPn + ' #pnSearchbar2').prepend('<small style="color:red">(You cannot make any changes because you are trying to put the service into your booking)</small>')
                            }
                            pngElm.ChangeLanguage()

                            $(idOrClassPn + ' #btnSaveNoOfPax').click(function () {
                                Obj_SearchDtl.intNoAdult = IntNoAdult
                                Obj_SearchDtl.arrChildren = ArrChildren
                                // Obj_SearchDtl.objNoOfRoom = ObjNoOfRoom

                                $('#ListNoPaxAndNoRoom2', idOrClassPn).html(strHtml_AgeType)
                                pngElm.ChangeLanguage()

                                _OnRtn.call()
                                // Obj_FN_Main.pnMain('pnListSurcharge')
                                // GetMain_GetFormMain()
                            })
                        }

                        // $('#btnChange',IdOrClass_Pn).click(function(){

                        // }).click()

                        GetPrice()
                        function GetPrice(IsChange = false) {

                            if (Obj_FormValDtl) {
                                Obj_SearchDtl.dtmDateCheckIn = Obj_FormValDtl.dtmDateCheckIn
                                Obj_SearchDtl.dtmDateCheckOut = Obj_FormValDtl.dtmDateCheckOut
                                $.ModuleLayouts_Searchbar_GetValue(Obj_SearchDtl)

                                if (IsChange) {
                                    png.postListApiGetValue({
                                        objList_Api: ObjList_Api
                                        //,objList_ComboValue: ObjList_ComboValue
                                        , objListApi_RtnVal: {
                                            'GetListSupplierForHotelByPUB': {
                                                objParams_Cus: {
                                                    dtmFilterCheckIn: Obj_FormValDtl.dtmDateCheckIn,
                                                    tblsReturn: '[1]',
                                                }
                                                , OnSuccess: function (data) {

                                                    Arr_ListAgentHost = JSON.parse(data)[1]

                                                    var intKey = 0
                                                    strHtml = ''
                                                    Arr_ListAgentHost.forEach(function (value, key) {
                                                        if (Str_CompanyOwnerGUID == value.strCompanyOwnerGUID) {
                                                            intKey = key
                                                        }
                                                        strHtml += '<option value="' + key + '">' + value.strCompanyName + ' (Giá từ:' + (value.dblPriceFrom == null ? 'N/A' : $.pngFormatPrice(value.dblPriceFrom) + '/phòng/đêm') + ')</option>'
                                                    })
                                                    $('.strCompanyOwnerGUID', '#pnListRoom').html(strHtml)

                                                    $('.strCompanyOwnerGUID', '#pnListRoom').val(intKey)

                                                    GetListRoom()
                                                }
                                            },
                                        }
                                    })
                                } else {
                                    GetListRoom()
                                }

                                // if(Obj_FN_Main.pnMain)
                                //     Obj_FN_Main.pnMain('pnListSurcharge')
                            }
                        }







                        function GetFromValDtl(_idOrClassPn) {
                            return pngPn.getForm({
                                action: 2,
                                objInput: Obj_FormInput,
                                idOrClass: _idOrClassPn
                            })
                        }

                    }


                    pnListRoom("#pnListRoom")
                    function pnListRoom(_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div style="display: flow-root">'
                        strHtml += '<h3 class="pn-margin-t-b-30 mobile-pn-float-none" style="float:left"><b>Chọn Phòng</b> </h3>'

                        strHtml += '<div class="mobile-pn-margin-0 pn-padding-15 pn-round-1em mobile-pn-float-none" style="border: 1px solid #909090; display: inline-block;float: left;padding: 10px; background: white; margin: 15px;">'
                        strHtml += '  <div for="filter"><b>Lựa chọn nhà cung cấp</b></div>'
                        strHtml += '  <select class="strCompanyOwnerGUID form-control pn-border-none pn-shadow-none pn-padding-0" style=" display: inline-block;"></select>'
                        strHtml += '</div>'

                        strHtml += '<div class="mobile-pn-padding-0 mobile-pn-margin-t-b-15 pn-padding-15 mobile-pn-float-none" style=" display: inline-block;float: left;padding: 10px;margin-top: 20px;">'
                        strHtml += '<button class="btn btn-texticon bg-success txt-white" action="Chat"><i class="fa fa-comment"></i> <span>Chat ngay</span></button>'
                        strHtml += '</div>'
                        strHtml += '</div>'

                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em">'
                        strHtml += '<div class="pnAgentHostDetail"></div>'
                        strHtml += '<div class="pnFormMarket"></div>'
                        strHtml += '<div class="txtCfmGT"></div>'
                        strHtml += '<div class="pnListPrice"></div>'
                        strHtml += '<div class="pnListPolicy"></div>'
                        strHtml += '</div>'

                        $(IdOrClass_Pn).html(strHtml)

                        var objAgentHostDtl = Arr_ListAgentHost[0]

                        var Obj_User = JSON.parse(png.ArrLS.UserDetail.get());
                        $('button[action=Chat]', IdOrClass_Pn).click(function () {

                            if (Obj_User) {

                            coreSystem.viewChat({
                                IsBegin: false,
                                objProduct: {
                                    strImageLink: Obj_Detail.strSupplierImage,
                                    strName: Obj_Detail.strSupplierName,
                                },
                                objFriendDetail: {
                                    strName: objAgentHostDtl.strCompanyName,
                                    strCode: objAgentHostDtl.strCompanyCode,
                                    strImageUrl: objAgentHostDtl.strCompanyLogo,
                                    strCompanyGUID: objAgentHostDtl.strCompanyOwnerGUID,
                                    strMemberGUID: null,
                                }
                            })

                            } else {
                                window.location.href = '/user/login?strReturnUrl=' + window.location.href
                            }
                        })

                        strHtml = ''
                        Arr_ListAgentHost.forEach(function(value,key){
                            strHtml+='<option value="'+value.strCompanyOwnerGUID+'">'+value.strCompanyName+' (Giá từ:'+(value.dblPriceFrom== null? 'N/A' : $.pngFormatPrice(value.dblPriceFrom)+'/phòng/đêm')+')</option>'
                        })
                        $('.strCompanyOwnerGUID', IdOrClass_Pn).html(strHtml)


                        if ($.pngGetQSVal('strCompanyOwnerGUID')) {
                            $('.strCompanyOwnerGUID', IdOrClass_Pn).val($.pngGetQSVal('strCompanyOwnerGUID'))
                        } else {
                            window.history.replaceState("", "", $.pngGetQSVal('strCompanyOwnerGUID', $('.strCompanyOwnerGUID', IdOrClass_Pn).val()));
                        }

                        $('.strCompanyOwnerGUID', IdOrClass_Pn).change(function () {

                            objAgentHostDtl = Arr_ListAgentHost[this.value]
                            Str_CompanyOwnerGUID = Arr_ListAgentHost[this.value].strCompanyOwnerGUID
                            Obj_DetailAgentHost = Arr_ListAgentHost[this.value]
                            Str_PriceLevelGUID = Arr_ListAgentHost[this.value].strPriceLevelGUID

                            png.postListApiGetValue({
                                objList_Api: ObjList_Api
                                //,objList_ComboValue: ObjList_ComboValue
                                , objListApi_RtnVal: {
                                    GetListPriceListForCompany: {
                                        objParams_Cus: {
                                            strCompanyGUID: Str_CompanyOwnerGUID,
                                            tblsReturn: '[0]',
                                        }
                                        , OnSuccess: function (data) {

                                            Arr_ListMarket = JSON.parse(data)[0]
                                        }
                                    },

                                    GetListItemTypeByAgent :{
                                        objParams_Cus:{
                                            strCompanyOwnerGUID: Str_CompanyOwnerGUID,
                                            tblsReturn : null,
                                        }
                                        ,OnSuccess: function(data){

                                            Arr_ListItemType = JSON.parse(data)[0]
                                            Arr_ListRoomType = JSON.parse(data)[1]
                                            Arr_ListOptionsChild = JSON.parse(data)[2]

                                            Arr_ListItemType.forEach(function(value){
                                                value.arrListRoomType = Arr_ListRoomType.filter(function(item){ return item.strItemTypeGUID.toUpperCase() == value.strItemTypeGUID.toUpperCase()})
                                            })

                                        }
                                    },
                                },
                                OnSuccessList: function () {
                                    GetTable()
                                    GetMarket()
                                    GetListRoom()
                                }
                            })
                            // Obj_FN_Main.pnMain('pnListSurcharge')
                        })
                        GetTable()
                        GetMarket()
                        GetListRoom()
                        function GetMarket() {

                            $('.pnAgentHostDetail', IdOrClass_Pn).html(`
                                <div><b><a href="/com/${Obj_DetailAgentHost.strCompanyNameUrl}">${Obj_DetailAgentHost.strCompanyName}</a></b>  (Giá từ: ${(Obj_DetailAgentHost.dblPriceFrom == null ? 'N/A' : $.pngFormatPrice(Obj_DetailAgentHost.dblPriceFrom)+'/phòng/đêm' )})</div>
                                <div class="pn-margin-b-15">${Obj_DetailAgentHost.strCompanyEmail} - ${Obj_DetailAgentHost.strCompanyPhone}</div>
                            `)

                            var ObjFormInput = {
                                strPriceListGUID: {
                                    title: 'Thị trường', attr: "class='col-md-12'", isRequire: false, IsRtn: true
                                    , input: { type: 'select', classEx: 'form-control', attr: ' ' }
                                    , dropDown: { arrList: $.pngGetArrComboValue(Arr_ListMarket, 'strPriceListGUID', 'strPriceListName') }
                                }
                            }
                            //----------------------------
                            pngPn.getForm({
                                action: 1,
                                objInput: ObjFormInput,
                                idOrClass: IdOrClass_Pn + ' .pnFormMarket',
                                objDetail: {
                                    strPriceListGUID: null
                                }
                            })

                            // if($.pngGetQSVal('strPriceListGUID')){
                            //     $('.strPriceListGUID',IdOrClass_Pn +' .pnFormMarket').val($.pngGetQSVal('strPriceListGUID'))
                            // }else{
                            //     window.history.replaceState("", "", $.pngGetQSVal('strPriceListGUID', $('.strPriceListGUID',IdOrClass_Pn +' .pnFormMarket').val()));
                            // }

                            if (Arr_ListMarket.length == 1) {
                                $(IdOrClass_Pn + ' .pnFormMarket').hide()
                            }

                            var strPriceListGUID = $('.strPriceListGUID', IdOrClass_Pn + ' .pnFormMarket').val()

                            $('select', IdOrClass_Pn + ' .pnFormMarket').change(function () {
                                var self = this
                                if (Arr_ListBook.length) {
                                    $.Confirm({
                                        strContent: 'Nếu bạn thay đổi thị trường. Những dịch vụ bạn đã chọn sẽ không còn. Bạn chắc chắn chứ?'
                                        , OnSuccess: function () {

                                            // window.history.pushState("", "", $.pngGetQSVal('strPriceListGUID', self.value));
                                            GetListRoom()
                                        }
                                        , OnExits: function () {
                                            $('.strPriceListGUID', IdOrClass_Pn + ' .pnFormMarket').val(strPriceListGUID)
                                        }
                                    })
                                } else {
                                    // window.history.pushState("", "", $.pngGetQSVal('strPriceListGUID', self.value));
                                    GetListRoom()
                                }
                                // Obj_FN_Main.pnMain('pnListSurcharge')
                            })
                        }

                        function GetTable(){

                            if ($(window).width() >= 767){

                                var objCols = {'No':{name:'<span langkey="sys_Txt_Tbl-No"></span>'}

                                    ,strItemTypeName_View:{name: pngElm.getLangKey({langkey:'sys_Txt_RoomName'}),IsMergeRow:true,strAttrTD:'style="vertical-align:top"'}
                                    ,intSglDblID:{name: 'Loại Phòng'
                                        ,list_input:{
                                            intSglDblID:{title: '',attr:"class='col-md-12' style='margin:0'",isRequire:false,IsRtn:true
                                                ,input:{type:'select',classEx:'form-control',attr:''}
                                            },
                                            PnSglDbl:{title:'',attr:"class='col-md-12' style='margin:0;padding: 5px;'"
                                                ,input:{IsNoInput:true}
                                            },
                                        }

                                    }

                                    ,intQuantity_View:{name: pngElm.getLangKey({langkey:'sys_Txt_NumberOfRooms'})
                                        ,list_input:{
                                            intQuantity:{title: '',attr:"class='col-md-12' style='margin:0'",isRequire:false,IsRtn:true
                                                ,input:{type:'text',classEx:'form-control',attr:'input-fn="true" style="width: 100px;"'}
                                            },
                                            PnAvailable:{title:'',attr:"class='col-md-12' style='margin:0;padding: 5px;'"
                                                ,input:{IsNoInput:true}
                                            },
                                        }
                                    }
                                    ,dblUnitPrice:{name: 'Đơn giá <span class="txtForNights" style="font-weight: normal;"></span>', strAttrTD:'style="text-align:right"'
                                        ,list_input:{
                                            dblUnitPriceView:{title:'',attr:"class='col-md-12' style='margin:0'"
                                                ,input:{IsNoInput:true,IsViewDtl:true}
                                            }
                                        }
                                    }
                                    ,dblTotalPrice:{name: '<span langkey="pg_Main_Supp_PPbook_TotalPrice"></span>', strAttrTD:'style="text-align:right"'}
                                    ,strHtmlAction: {name:'<span langkey="sys_Txt_Tbl-Action"></span>'
                                        ,strAttrTD:''
                                    }
                                }


                                pngPn.getTable2({
                                    objApi: null
                                    ,objParams_Cus: null
                                    ,editRltArr: function(arr){
                                        return Arr_ListItemType
                                    }
                                    ,editRlt: function(value,key){
                                        value = $.pngExtendObj(value,value.arrListRoomType[0],true)

                                        // console.log(value)

                                        value['strItemTypeName_View'] = ''
                                        value['strItemTypeName_View'] += '<a action="ViewItemTypeDtl" strItemTypeGUID="'+value['strItemTypeGUID']+'"><b>'+value['strItemTypeName']+'</b></a>'
                                        value['strItemTypeName_View'] += '<div class="pnMealIncludedType"><i class="fa fa-cutlery"></i> <span></span></div>'
                                        // value['strItemTypeName_View'] +='<div class="txtAlm">Allotment: 0</div>'


                                        value['strSglDblName_View'] = '<div>'+value['strSglDblName']+'</div>'

                                        if(value.intNoOfAdult)
                                            value['strSglDblName_View']+='<b><i class="fa fa-male"></i></b> '+value.intNoOfAdult+''
                                        if(value.intNoOfChild)
                                            value['strSglDblName_View']+=' - <b style="font-size:12px"><i class="fa fa-child"></i></b> '+value.intNoOfChild
                                        if(value.intNoOfExb)
                                            value['strSglDblName_View']+= '<div><b>No Of Exb</b>: '+value.intNoOfExb+'</div>'
                                            value['strSglDblName_View']+= '<div><a action="ViewSeeMore" intRowID="'+key+'" style="cursor: inherit;position:relative">Xem thêm</a></div>'


                                        value['strSglDblName_ViewMobile'] = `
                                            <div><b>Đơn giá</b> <span class="txtForNights" style="font-weight: normal;"></span></div>
                                            <div class="pn-dblUnitPrice" row="${key}"></div>
                                            <b langkey="pg_Main_Supp_PPbook_TotalPrice"></b>
                                            <div class="pn-dblTotalPrice" row="${key}"></div>
                                            <div class="pn-strHtmlAction" row="${key}">
                                            </div>
                                        `


                                    }
                                    ,objCols: objCols
                                    ,customEvent:function(_idOrClassPnTbl){

                                        $('.intQuantity',_idOrClassPnTbl).parent().append('<div class="txtNA">N/A</div>')
                                        $('.txtNA',_idOrClassPnTbl).hide()

                                        Arr_ListItemType.forEach(function(value,key){

                                            var strHtml= ''
                                            value.arrListRoomType.forEach(function(val){
                                                strHtml+='<option value="'+val.intSglDblID+'">'+val.strSglDblName+'</option>'
                                            })
                                            $('[row='+key+'] .intSglDblID',_idOrClassPnTbl).html(strHtml)

                                            if(value.arrListRoomType.length == 1){
                                                $('[row='+key+'] .intSglDblID',_idOrClassPnTbl).hide()
                                                $('[row='+key+'] .intSglDblID',_idOrClassPnTbl).parent().append(value.arrListRoomType[0].strSglDblName)
                                            }

                                            $('[row='+key+'] .intQuantity',_idOrClassPnTbl).parent().append(`

                                                <div class="pnQuantity" style="display: inline-flex;padding-bottom: 10px;">
                                                    <span style="width: 160px;">
                                                        <a class="exp qty" style="padding: 0 10px;display: inline-block;background: #d8d8d8; cursor: pointer;">-</a>
                                                        <div style="width: 40px;text-align: center;display: inline-block;">
                                                            <span class="no-qty">0</span>
                                                        </div>
                                                        <a class="add qty" style="padding: 0 10px;display: inline-block;background: #d8d8d8; cursor: pointer;">+</a>
                                                    </span>
                                                </div>

                                            `)
                                            $('[row='+key+'] .intQuantity',_idOrClassPnTbl).hide()



                                        })

                                        $('.exp.qty',_idOrClassPnTbl).click(function(){
                                            var intRowID = $(this).parents('tr').attr('row')
                                            var val = $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).getNumber()

                                            if(val>0){
                                                val-=1
                                            }
                                            $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val(val).change()

                                        })


                                        $('.add.qty',_idOrClassPnTbl).click(function(){
                                            var intRowID = $(this).parents('tr').attr('row')
                                            var val = $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).getNumber()

                                            // if(val>0){
                                                val+=1
                                            // }
                                            $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val(val).change()

                                        })

                                        $('.intQuantity',_idOrClassPnTbl).change(function(){
                                            var intRowID = $(this).parents('tr').attr('row')

                                            $('[row='+intRowID+'] .no-qty',_idOrClassPnTbl).html(this.value)
                                        })


                                        $('.intSglDblID',_idOrClassPnTbl).change(function(){
                                            var intRowID = $(this).parents('tr').attr('row')
                                            var self = this

                                            var obj = Arr_ListItemType[intRowID]

                                            Arr_ListItemType[intRowID] = $.pngExtendObj(obj, obj.arrListRoomType.filter(function(item){ return item.intSglDblID == self.value })[0], true)

                                            GetChangeQuantity(intRowID)

                                            obj = Arr_ListItemType[intRowID]

                                            obj.arrOptionsChild = Arr_ListOptionsChild.filter(function(item){ return item.strItemTypeDetailGUID.toUpperCase() == obj.strItemTypeDetailGUID.toUpperCase() })

                                            obj.intMaxNoOfAdult = obj.intNoOfAdult
                                            obj.intMaxNoOfChild = obj.intNoOfChild

                                            var strHtml = ''

                                            strHtml+='<div>'
                                            if(obj.arrOptionsChild.length){
                                                var intChildOptionID_Old = 0
                                                var intNoOfAdult = 0
                                                var intNoOfChild = 0

                                                obj.arrOptionsChild.forEach(function(value,key){

                                                    if(intChildOptionID_Old != value.intChildOptionID || (key + 1) == obj.arrOptionsChild.length ){
                                                        if(intChildOptionID_Old){
                                                            strHtml+='<div>'
                                                            strHtml+='<input type="radio" name="option_'+intRowID+'" value="'+intChildOptionID_Old+'" style="margin-right: 5px;">'
                                                            // if(intNoOfAdult)
                                                                strHtml+='<b><i class="fa fa-male"></i></b> '+intNoOfAdult+''
                                                            // if(intNoOfChild)
                                                                strHtml+=' - <b style="font-size:12px"><i class="fa fa-child"></i></b> '+intNoOfChild
                                                            strHtml+='</div>'

                                                            intNoOfAdult = 0
                                                            intNoOfChild = 0
                                                        }
                                                    }

                                                    if(!value.strSupplierChildAgeGUID){
                                                        intNoOfAdult = value.intNoOfChild
                                                    }else{
                                                        intNoOfChild+=value.intNoOfChild
                                                    }

                                                    intChildOptionID_Old = value.intChildOptionID
                                                })
                                            }else if(obj.intNoOfAdult){

                                                strHtml+='<input type="radio" name="option_'+intRowID+'" value="0" style="margin-right: 5px;">'
                                                if(obj.intNoOfAdult)
                                                    strHtml+='<b><i class="fa fa-male"></i></b> '+obj.intNoOfAdult+''
                                                if(obj.intNoOfChild)
                                                    strHtml+=' - <b style="font-size:12px"><i class="fa fa-child"></i></b> '+obj.intNoOfChild
                                            }
                                            strHtml+='</div>'

                                            if(obj.intNoOfExb)
                                                strHtml+= '<div><b>No Of Exb</b>: '+obj.intNoOfExb+'</div>'

                                            strHtml+= '<div><a action="ViewSeeMore" intRowID="'+intRowID+'" style="cursor: inherit;position:relative">Xem thêm</a></div>'

                                            $('[row='+intRowID+'] .pnElm-PnSglDbl').html(strHtml)

                                            if(obj.arrOptionsChild && obj.arrOptionsChild.length)
                                                $('[row='+intRowID+'] input[type=radio][value='+obj.arrOptionsChild[0].intChildOptionID+']', _idOrClassPnTbl).prop('checked',true)
                                            else
                                                $('[row='+intRowID+'] input[type=radio][value=0]', _idOrClassPnTbl).prop('checked',true)

                                            if ($(window).width() >= 1024){
                                                $( "a[action=ViewSeeMore]",_idOrClassPnTbl ).hover(function() {

                                                        var obj = Arr_ListItemType[$(this).attr('intRowID')]

                                                        var stHtml_Room = ''

                                                        if(obj.intNoOfRoom)
                                                            stHtml_Room+='<div><b>Tổng số phòng</b>: '+obj.intNoOfRoom+'</div>'
                                                        if(obj.intNoOfAdult)
                                                            stHtml_Room+='<div><b> Tổng số người lớn</b>: '+obj.intNoOfAdult+'</div>'
                                                        if(obj.intNoOfChild)
                                                            stHtml_Room+='<div><b> Tổng số Trẻ em</b>: '+obj.intNoOfChild+'</div>'
                                                        if(obj.intNoOfEx)
                                                            stHtml_Room+='<div><b>No Of Exb</b>: '+obj.intNoOfEx+'</div>'
                                                        if(obj.intSizeSquare)
                                                            stHtml_Room+='<div><b>Diện tích</b>: '+obj.intSizeSquare+'</div>'
                                                        if(obj.strBedsize)
                                                            stHtml_Room+='<div><b>Cỡ giường</b>: '+obj.strBedsize+'</div>'
                                                        if(obj.intNoOfWindow)
                                                            stHtml_Room+='<div><b>Số cửa sổ</b>: '+obj.intNoOfWindow+'</div>'
                                                        if(obj.intNoOfBalcony)
                                                            stHtml_Room+='<div><b>Số ban công</b>: '+obj.intNoOfBalcony+'</div>'

                                                        if(!stHtml_Room){
                                                            stHtml_Room+='<div>'+pngElm.getLangKey({langkey:'sys_Txt_NoData'})+'</div>'
                                                        }


                                                        var strHtml = ''
                                                        strHtml+='<div id="pnSeeMore" class="bg-white pn-padding-15" style="position:absolute;z-index: 2;line-height: 25px;box-shadow: 0px 0px 18px -7px;left: 0;width:200px">'
                                                        strHtml+=stHtml_Room
                                                        strHtml+='</div>'

                                                        $( this ).append( strHtml );
                                                    }, function() {
                                                    $( this ).find( "#pnSeeMore" ).remove();
                                                    }
                                                );
                                            }else{
                                                $( "a[action=ViewSeeMore]",_idOrClassPnTbl ).click(function(){

                                                    var obj = Arr_ListItemType[$(this).attr('intRowID')]
                                                    GetPanelFullScreen(function(_idOrClassPn){


                                                        var strHtml = ''
                                                        strHtml+='<div id="pnSeeMore" class="bg-white pn-padding-15" style="">'
                                                        var stHtml_Room = ''
                                                        if(obj.intNoOfRoom)
                                                            stHtml_Room+='<div><b>Tổng số phòng</b>: '+obj.intNoOfRoom+'</div>'
                                                        if(obj.intNoOfAdult)
                                                            stHtml_Room+='<div><b> Tổng số người lớn</b>: '+obj.intNoOfAdult+'</div>'
                                                        if(obj.intNoOfChild)
                                                            stHtml_Room+='<div><b> Tổng số Trẻ em</b>: '+obj.intNoOfChild+'</div>'
                                                        if(obj.intNoOfExb)
                                                            stHtml_Room+='<div><b>No Of Exb</b>: '+obj.intNoOfExb+'</div>'
                                                        if(obj.intSizeSquare)
                                                            stHtml_Room+='<div><b>Diện tích</b>: '+obj.intSizeSquare+'</div>'
                                                        if(obj.strBedsize)
                                                            stHtml_Room+='<div><b>Cỡ giường</b>: '+obj.strBedsize+'</div>'
                                                        if(obj.intNoOfWindow)
                                                            stHtml_Room+='<div><b>Số cửa sổ</b>: '+obj.intNoOfWindow+'</div>'
                                                        if(obj.intNoOfBalcony)
                                                            stHtml_Room+='<div><b>Số ban công</b>: '+obj.intNoOfBalcony+'</div>'

                                                        if(!stHtml_Room){
                                                            stHtml_Room+='<div>'+pngElm.getLangKey({langkey:'sys_Txt_NoData'})+'</div>'
                                                        }
                                                        strHtml+=stHtml_Room
                                                        strHtml+='</div>'

                                                        $(_idOrClassPn).html(strHtml)

                                                    })
                                                })
                                            }

                                        })


                                        $( "a",_idOrClassPnTbl ).click(function(){

                                            var action = $(this).attr('action')
                                            var intRowID = $(this).attr('intRowID')
                                            var strItemTypeGUID = $(this).attr('strItemTypeGUID')


                                            if(action=="ViewItemTypeDtl"){
                                                GetPopUp_ViewItemType({
                                                    objDetail: Arr_ListItemType.filter(function(item){ return item.strItemTypeGUID == strItemTypeGUID })[0],
                                                    OnSuccess: function () {

                                                    }
                                                })
                                            }

                                        })




                                        $('input',_idOrClassPnTbl).on('keyup change',function(){
                                            var intRowID = $(this).parents('tr').attr('row')

                                            if($('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val().getNumber() < 0)
                                                $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val(0).change()

                                            Arr_ListItemType[intRowID].intQuantity = $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val().getNumber()//parseFloat(this.value)

                                            GetChangeQuantity(intRowID)
                                            // GetTotalAllPrice()
                                        })


                                    }
                                    ,changeCkbMaster: function (IsChecked, intRowID, arrList) {

                                        Arr_ListItemType = arrList;
                                        console.log('Arr_ListItemType',Arr_ListItemType)
                                    }
                                    ,IsViewCheckBoxMain: false
                                    ,idOrClass:IdOrClass_Pn+' .pnListPrice'
                                })


                            }else{


                                // objCols = {'No':{name:'<span langkey="sys_Txt_Tbl-No"></span>'}

                                //     ,strItemTypeName_View:{name: pngElm.getLangKey({langkey:'sys_Txt_RoomName'}),IsMergeRow:true,strAttrTD:'style="vertical-align:top"'}
                                //     ,strSglDblName_ViewMobile:{name: 'Loại Phòng'
                                //         ,list_input:{

                                //             strSglDblName_View:{title:'',attr:"class='col-md-12' style='margin:0'"
                                //                 ,input:{IsNoInput:true,IsViewDtl:true}
                                //             },
                                //             intQuantity:{title:'',attr:"class='col-md-12' style='margin:0'"
                                //                 ,input:{type:'text',classEx:'form-control',attr:'input-fn="true" style="width: 100px;"'}
                                //             },
                                //             strSglDblName_ViewMobile:{title:'',attr:"class='col-md-12' style='margin:0'"
                                //                 ,input:{IsNoInput:true,IsViewDtl:true}
                                //             },
                                //         }
                                //     }
                                // }

                                var strHtml = ''
                                Arr_ListItemType.forEach(function(value,key){
                                    strHtml += '<div row="'+key+'" style="margin-bottom:30px;box-shadow: 0px 0px 18px -9px; border-radius: 1em;   ">'
                                    // strHtml += '    <div class="btn_Custom" guid="'+value.strSupplierGUID+'" style="margin-right:20px; height: 200px; width: 100%; background:url(\''+strImg+'\') no-repeat center;background-size: cover;border-radius:1em; border-bottom-left-radius: 0;border-bottom-right-radius: 0;"> </div>'
                                        strHtml += '<div style="padding: 15px">'
                                            strHtml += '<div class="pn-margin-b-15">'
                                                strHtml += '<b action="ViewItemTypeDtl" strItemTypeGUID="'+value['strItemTypeGUID']+'" intRowID="'+key+'" >'+value['strItemTypeName']+'</b> ('+value['strMealIncludedTypeName']+')'
                                            strHtml += '</div>'
                                            // strHtml += '<div>'+value['strSglDblName']+'</div>'
                                            // strHtml +='<div class="txtAlm">Allotment: 0</div>'
                                            // strHtml +='<div><a action="ViewItemTypeDtl" strItemTypeGUID="'+value['strItemTypeGUID']+'">'+pngElm.getLangKey({langkey:'sys_Txt_ViewDetail'})+'</a></div>'

                                                // +'<div><a action="ViewSeeMore" intRowID="'+key+'" style="cursor: inherit;">See More</a></div>'

                                            strHtml += `
                                            <div class="row">
                                                <div class="col-xs-6">

                                                    <div>${value['strSglDblName']}</div>
                                            `
                                            strHtml+='<div>'
                                            if(value.intNoOfAdult)
                                                strHtml+='<b><i class="fa fa-male"></i></b> '+value.intNoOfAdult+''
                                            if(value.intNoOfChild)
                                                strHtml+=' - <b style="font-size:12px"><i class="fa fa-child"></i></b> '+value.intNoOfChild
                                            strHtml+='</div>'
                                            if(value.intNoOfExb)
                                                strHtml+='<div><b>No Of Exb</b>: '+value.intNoOfExb+'</div>'
                                            strHtml += `<div class="txtAlm">Allotment: 0</div>

                                                </div>

                                                <div class="col-xs-6">
                                                    <div><b>Đơn giá</b> </div>
                                                    <div class="pn-dblUnitPrice" row="${key}"></div>
                                                </div>
                                                <div class="intQuantity col-xs-12 pn-margin-t-15" style="margin-bottom: 5px;"><b>${pngElm.getLangKey({langkey:'sys_Txt_NumberOfRooms'})}</b></div>
                                                <div class="col-xs-12" style="display:flex">
                                                    <div style="width: 50%;" >
                                                        <input type="text" class="intQuantity form-control" row="${key}" input-fn="true" autocomplete="off">
                                                    </div>
                                                    <div class="pn-strHtmlAction" row="${key}" style="margin-top: -1px;width: 50%;">
                                                    </div>
                                                </div>
                                            </div>
                                        `
                                            // strHtml += '<button class="btn " style="padding: 5px 40px;background: none;border: 1px solid #000;border-radius: 10em;" >Xem chi tiết</button>'
                                        strHtml += '</div>'
                                    strHtml += '</div>'
                                })
                                $(IdOrClass_Pn+' .pnListPrice').html(strHtml)

                                $('input',IdOrClass_Pn).getFormatNumberInput(false,true)

                                $('input',IdOrClass_Pn).click(function(){

                                    $(window).scrollTop($(this).offset().top - 100)
                                })

                                $( "b",IdOrClass_Pn ).click(function(){

                                    var action = $(this).attr('action')
                                    var intRowID = $(this).attr('intRowID')
                                    var strItemTypeGUID = $(this).attr('strItemTypeGUID')


                                    var obj = Arr_ListItemType[intRowID]
                                    var strHtml = ''
                                        var stHtml_Room = ''
                                        if(obj.intNoOfRoom)
                                            stHtml_Room+='<div><b>Tổng số phòng</b>: '+obj.intNoOfRoom+'</div>'
                                        if(obj.intNoOfAdult)
                                            stHtml_Room+='<div><b> Tổng số người lớn</b>: '+obj.intNoOfAdult+'</div>'
                                        if(obj.intNoOfChild)
                                            stHtml_Room+='<div><b> Tổng số Trẻ em</b>: '+obj.intNoOfChild+'</div>'
                                        if(obj.intNoOfExb)
                                            stHtml_Room+='<div><b>No Of Exb</b>: '+obj.intNoOfExb+'</div>'
                                        if(obj.intSizeSquare)
                                            stHtml_Room+='<div><b>Diện tích</b>: '+obj.intSizeSquare+'</div>'
                                        if(obj.strBedsize)
                                            stHtml_Room+='<div><b>Cỡ giường</b>: '+obj.strBedsize+'</div>'
                                        if(obj.intNoOfWindow)
                                            stHtml_Room+='<div><b>Số cửa sổ</b>: '+obj.intNoOfWindow+'</div>'
                                        if(obj.intNoOfBalcony)
                                            stHtml_Room+='<div><b>Số ban công</b>: '+obj.intNoOfBalcony+'</div>'

                                        if(!stHtml_Room){
                                            stHtml_Room+='<div>'+pngElm.getLangKey({langkey:'sys_Txt_NoData'})+'</div>'
                                        }
                                        strHtml+=stHtml_Room



                                    if(action=="ViewItemTypeDtl"){
                                        GetPopUp_ViewItemType({
                                            objDetail: Arr_ListItemType.filter(function(item){ return item.strItemTypeGUID == strItemTypeGUID })[0],
                                            strHtml_RoomType: strHtml,
                                            OnSuccess: function () {

                                            }
                                        })
                                    }

                                })


                                $('input',IdOrClass_Pn).on('keyup change',function(){
                                    var intRowID = $(this).attr('row')

                                    if($('[row='+intRowID+'] input.intQuantity',IdOrClass_Pn).val().getNumber() < 0)
                                        $('[row='+intRowID+'] input.intQuantity',IdOrClass_Pn).val(0).change()

                                    Arr_ListItemType[intRowID].intQuantity = $('[row='+intRowID+'] input.intQuantity',IdOrClass_Pn).val().getNumber()//parseFloat(this.value)


                                    var dblTotalPrice = Arr_ListItemType[intRowID].dblUnitPrice * Arr_ListItemType[intRowID].intQuantity


                                    Arr_ListItemType[intRowID].dblTotalPrice = dblTotalPrice

                                    Arr_ListItemType[intRowID].dblTotalComPrice = Arr_ListItemType[intRowID].dblUnitComPrice * Arr_ListItemType[intRowID].intQuantity

                                    // $('.pn-dblTotalPrice[row='+intRowID+']','.pnListPrice').html($.pngFormatPrice((dblTotalPrice)))

                                    if(Arr_ListItemType[intRowID].intQuantity){
                                        $('[row='+intRowID+'] button','.pnListPrice').show()//attr('disabled',false)
                                    }else{
                                        $('[row='+intRowID+'] button','.pnListPrice').hide()//attr('disabled',true)
                                    }


                                    // GetTotalAllPrice()
                                })

                            }

                        }



                    }


                    pnListChildAge("#pnListChildAge")
                    function pnListChildAge(_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div style="display: flow-root">'
                        strHtml += '<h3 class="pn-margin-t-b-30 mobile-pn-float-none" style="float:left"><b>List Child Age</b> </h3>'
                        strHtml += '</div>'

                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em">'
                        strHtml += '<div class="pnListPrice"></div>'
                        strHtml += '</div>'

                        $(IdOrClass_Pn).html(strHtml)
                    }


                    pnInExclude("#pnInExclude")
                    function pnInExclude (_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div class="row mobile-pn-display-block" style="display: flex;">'
                        strHtml += '<div class="col-md-6" style="display: flex;">'
                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em" style="width: 100%;">'
                        strHtml += '<div class="">'
                        strHtml += '<h3 class="pn-margin-b-30"><b langkey="pg_Main_Tour_MdDtl_Include"></b></h3>'
                        strHtml += '    <div class="tour_include_exclude">'
                        strHtml += (Obj_Detail.strInclude || '<i>' + pngElm.getLangKey({ langkey: 'sys_Txt_NoData' }) + '</i>')
                        strHtml += '    </div>'
                        strHtml += '</div>'
                        strHtml += '</div>'
                        strHtml += '</div>'
                        strHtml += '<div class="col-md-6" style="display: flex;">'
                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em" style="width: 100%;">'
                        strHtml += '<div >'
                        strHtml += '<h3 class="pn-margin-b-30"><b langkey="pg_Main_Tour_MdDtl_Exclude"></b></h3>'
                        strHtml += '    <div class="tour_include_exclude">'
                        strHtml += (Obj_Detail.strExclude || '<i>' + pngElm.getLangKey({ langkey: 'sys_Txt_NoData' }) + '</i>')
                        strHtml += '    </div>'
                        strHtml += '</div>'
                        strHtml += '</div>'
                        strHtml += '</div>'
                        strHtml += '</div>'

                        $(IdOrClass_Pn).html(strHtml)
                    }
                    pnFOC("#pnFOC")
                    function pnFOC(_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div style="display: flow-root">'
                        strHtml += '<h3 class="pn-margin-t-b-30 mobile-pn-float-none" style="float:left"><b>FOC</b> </h3>'
                        strHtml += '</div>'

                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em">'
                        strHtml += '<div class="pnListPrice">' + (Obj_Detail.strFOCBrief || '<i>' + pngElm.getLangKey({ langkey: 'sys_Txt_NoData' }) + '</i>') + '</div>'
                        strHtml += '</div>'

                        $(IdOrClass_Pn).html(strHtml)
                    }
                    pnPayemntTerm("#pnPayemntTerm")
                    function pnPayemntTerm (_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div style="display: flow-root">'
                        strHtml += '<h3 class="pn-margin-t-b-30 mobile-pn-float-none" style="float:left"><b>Payment Term</b> </h3>'
                        strHtml += '</div>'

                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em">'
                        strHtml += '<div class="pnListPrice"></div>'
                        strHtml += '</div>'

                        //$(IdOrClass_Pn).html(strHtml)

                        if (Dbl_TotalAllPrice && Dbl_TotalAllPrice > 0) {
                            pngPn.getTable2({
                                objApi: ObjList_Api.GetListSupplierPaymentTerm
                                , objParams_Cus: {
                                    strCompanyGUID: Str_CompanyOwnerGUID
                                    , dtmCheckInDate: Obj_SearchDtl.dtmDateCheckIn
                                    , intProductIDForBook: Int_ProductID
                                }
                                , editRltArr: function (_arr, _arrAll) {
                                    var arr = _arr.filter(function (item) { return !item.IsInstantTerm })

                                    return arr
                                }
                                , editRlt: function (value, key) {

                                    var strFromDate = $.pngFormatDateTime(moment(Obj_SearchDtl.dtmDateCheckIn).add('days', 0 - value.intDayTo).format('l'))
                                    var strToDate = $.pngFormatDateTime(moment(Obj_SearchDtl.dtmDateCheckIn).add('days', 0 - value.intDayFrom).format('l'))

                                    if (value.IsDepositOnBook) {
                                        strFromDate = $.pngFormatDateTime(moment().format('l'))
                                        strToDate = $.pngFormatDateTime(moment().add(value.intHourInHold, 'h').format('l'))
                                    }

                                    value['No'] = (key + 1)
                                    value['strFromDate'] = strFromDate
                                    value['strToDate'] = strToDate
                                    value['dblPaymentPrice'] = $.pngFormatPrice(Dbl_TotalAllPrice / 100 * value['dblPaymentPercentage']) + (value.IsDepositOnBook ? ' (Deposit)' : '')
                                }
                                , objCols: {

                                    No: { name: '<span langkey="sys_Txt_No"></span>' }
                                    , strFromDate: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_FromDate' }) }
                                    , strToDate: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_ToDate' }) }
                                    , dblPaymentPrice: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_Payment' }), strAttrTD: 'style="text-align:right"' }

                                }
                                // ,editTableInput:function(){}
                                , changeCkbMaster: function (_IsChecked, _intRowID, _arrList) {

                                }
                                , customEvent: function (_iOrClass_Pn) {


                                }
                                // ,changeInput:function(){}
                                , IsViewCheckBoxMain: false
                                , idOrClass: IdOrClass_Pn + ' .pnListPrice'
                            })
                        } else {
                            $(IdOrClass_Pn + ' .pnListPrice').html('Bạn hãy chọn Dịch vụ để Book')
                        }

                    }

                    pnCancellation("#pnCancellation")
                    function pnCancellation (_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div style="display: flow-root">'
                        strHtml += '<h3 class="pn-margin-t-b-30 mobile-pn-float-none" style="float:left"><b>Cancellation Policy</b> </h3>'
                        strHtml += '</div>'

                        strHtml += '<div class="pn-padding-15 bg-white pn-round-1em">'
                        strHtml += '<div class="pnListPrice"></div>'
                        strHtml += '</div>'

                        //$(IdOrClass_Pn).html(strHtml)


                        if (Dbl_TotalAllPrice && Dbl_TotalAllPrice > 0) {
                            pngPn.getTable2({
                                objCols: {
                                    No: { name: pngElm.getLangKey({ langkey: 'sys_Txt_No' }) }
                                    , strFromDate: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_FromDate' }) }
                                    , strToDate: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_ToDate' }) }
                                    , dblTourCancellationCharge: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_CancellationCharge' }), strAttrTD: 'style="text-align:right"' }
                                    // ,dblTourCancellationPolicyValue: {name:'Cancellation Charge'}
                                }
                                , objApi: ObjList_Api.GetListSupplierCancellationPolicy
                                , objParams_Cus: {
                                    strCompanyGUID: Str_CompanyOwnerGUID
                                    , dtmCheckInDate: Obj_SearchDtl.dtmDateCheckIn
                                    , intProductIDForBook: Int_ProductID
                                }
                                , editRlt: function (value, key) {
                                    var dtmStart = Obj_SearchDtl.dtmDateCheckIn
                                    var strFromDate = $.pngFormatDateTime(moment(dtmStart).add('days', 0 - value.intTo).format('l'))
                                    if (!value.intTo) {
                                        if (moment() < moment(dtmStart).add('days', 0 - value.intFrom))
                                            strFromDate = $.pngFormatDateTime(moment().format('l'))
                                        else
                                            strFromDate = $.pngFormatDateTime(moment(dtmStart).add('days', 0 - value.intFrom).format('l'))
                                    }
                                    value['strFromDate'] = strFromDate
                                    value['strToDate'] = $.pngFormatDateTime(moment(dtmStart).add('days', 0 - value.intFrom).format('l'))
                                    value['dblTourCancellationCharge'] = $.pngFormatPrice(Dbl_TotalAllPrice / 100 * value['dblSupplierCancellationPolicyValue']) + (value.IsDepositedLost ? ' (Deposit Lost)' : '')

                                }
                                , IsViewCheckBoxMain: false
                                , idOrClass: IdOrClass_Pn + ' .pnListPrice'
                            })

                        } else {
                            $(IdOrClass_Pn + ' .pnListPrice').html('Bạn hãy chọn Dịch vụ để Book')
                        }

                    }
                    // ===================================




                    function GetListRoom(){

                        Arr_ListBook = []
                        Arr_ListBookFOC = []


                        var IntNoOfNight = moment(Obj_SearchDtl.dtmDateCheckOut).diff(moment(Obj_SearchDtl.dtmDateCheckIn),'days')

                        $('.txtForNights','#pnListRoom').html('Cho '+IntNoOfNight+' Đêm')

                        png.postListApiGetValue({
                            objList_Api: ObjList_Api
                            //,objList_ComboValue: ObjList_ComboValue
                            , objListApi_RtnVal: {
                                'GetListSupplierMappingPriceForHotelByPUB': {
                                    objParams_Cus: {
                                        strPriceLevelGUID: Str_PriceLevelGUID
                                        ,strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                        ,dtmFilterCheckOutDate: Obj_SearchDtl.dtmDateCheckOut
                                        ,dtmFilterCheckIn: Obj_SearchDtl.dtmDateCheckIn
                                        ,dtmFilterCheckOut: Obj_SearchDtl.dtmDateCheckOut
                                        , strPriceListGUID: ($('#pnListRoom .strPriceListGUID').val() || Arr_ListMarket[0].strPriceListGUID)
                                        ,tblsReturn: '[0][1]'
                                    }
                                    ,OnSuccess: function(data){
                                        // GetPanel(JSON.parse(data))
                                        ArrPriceRoom = JSON.parse(data)[0]
                                        Arr_ListDate = JSON.parse(data)[1]
                                    }
                                },
                                GetListFoc:{
                                    objParams_Cus:{
                                        dtmFilterDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                        ,dtmFilterDateTo: Obj_SearchDtl.dtmDateCheckOut
                                        ,strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                        ,tblsReturn : '[0]'
                                    }
                                    ,OnSuccess: function(data){

                                        Arr_ListFoc = JSON.parse(data)[0]

                                    }
                                },
                                GetListPolicyNotes:{
                                    objParams_Cus:{
                                        dtmFilterDateTravelFrom: Obj_SearchDtl.dtmDateCheckIn
                                        ,dtmFilterDateTravelTo: moment(Obj_SearchDtl.dtmDateCheckOut).add(-1,'days').format('l')
                                        ,tblsReturn : '[0]'
                                    }
                                    ,OnSuccess: function(data){

                                        Arr_ListPolicy = JSON.parse(data)[0]

                                        console.log(Arr_ListPolicy)

                                    }
                                },
                                // 'GetListSupplierChildAge':{
                                //     objParams_Cus:{
                                //     }
                                //     ,OnSuccess: function(data){
                                //         Arr_ChildAge = JSON.parse(data)[0]
                                //     }
                                // },

                            }
                            ,OnSuccessList:function(data){

                                GetPriceTable()
                                GetPolicy()
                            }
                        })



                    }


                    function GetChangeQuantity(_intKey){

                        var objDetail = Arr_ListItemType[_intKey]

                        var ArrListForGIT = Arr_ListFoc.filter(function(item){ return item.intFOCTypeID==3 })


                        var arr = ArrPriceRoom.filter(function(item){ return (item.strItemTypeGUID || '').toUpperCase() == objDetail.strItemTypeGUID.toUpperCase() })


                        var obj = null
                        if( arr.length ){

                            obj = arr[0]

                            var intQuantity = 1
                            var dtmDateFrom
                            var dtmDateTo
                            var dblUnitPrice = 0

                            var objPriceDetail = {}

                            objDetail['arrListPrice'] = []
                            objDetail['arrListMealIncludedType'] = []

                            var IsNA = false
                            var IsGIT = false

                            Arr_ListDate.forEach(function(_val){

                                objDetail['arrListMealIncludedType'] = ArrPriceRoom.filter(function(item){ return (item.strItemTypeGUID || '').toUpperCase() == objDetail.strItemTypeGUID.toUpperCase() && item.strPriceSeasonGUID.toUpperCase() == (_val.strPriceSeasonGUID || '').toUpperCase() })
                                var arr = objDetail['arrListMealIncludedType'].filter(function(item){ return item.intMealIncludedTypeID == objDetail.intMealIncludedTypeID })

                                if( arr.length ){

                                    val = arr[0]

                                    var dblUnitPriceItem = 0
                                    var dblUnitComPriceItem = 0

                                    var IsGITItem = false

                                    // if(IsGIT && ArrListForGIT.filter(function(item){  return moment(item.dtmDateFrom) <= moment($.pngFormatDateTime(_val.dtmDate,'l')) && moment(item.dtmDateTo) >= moment($.pngFormatDateTime(_val.dtmDate,'l'))}).length   ){
                                    //     IsGITItem = true
                                    // }
                                    if(ArrListForGIT.filter(function(item){ return objDetail.intQuantity >= item.intFOCPax && moment(item.dtmDateFrom) <= moment($.pngFormatDateTime(_val.dtmDate,'l')) && moment(item.dtmDateTo) >= moment($.pngFormatDateTime(_val.dtmDate,'l'))}).length   ){
                                        IsGITItem = true
                                        IsGIT = true
                                    }

                                    if(objDetail.strSglDblCode == 'Dbl' || objDetail.strSglDblCode == 'Twn' || objDetail.strSglDblCode.indexOf('St')!=-1){

                                        if(IsGITItem){
                                            dblUnitPriceItem = val.dblGITPrice
                                            dblUnitComPriceItem = val.dblComGITPrice
                                        }else{
                                            dblUnitPriceItem = val.dblPrice
                                            dblUnitComPriceItem = val.dblComPrice
                                        }



                                    }
                                    if(objDetail.strSglDblCode == 'Sgl'){
                                        if(IsGITItem){
                                            dblUnitPriceItem = val.dblGITPriceSGL
                                            dblUnitComPriceItem = val.dblComGITPriceSGL
                                        }else{
                                            dblUnitComPriceItem = val.dblPriceSGL
                                            dblUnitComPriceItem = val.dblComPriceSGL
                                        }
                                    }
                                    if(objDetail.strSglDblCode == 'Tpl'){
                                        if(IsGITItem){
                                            dblUnitPriceItem = val.dblGITPriceTPL
                                            dblUnitComPriceItem = val.dblComGITPriceTPL
                                        }else{
                                            dblUnitPriceItem = val.dblPriceTPL
                                            dblUnitComPriceItem = val.dblComPriceTPL
                                        }
                                    }

                                    if(dblUnitPrice!=dblUnitPriceItem){
                                        intQuantity = 1
                                        dblUnitPrice=dblUnitPriceItem
                                        dtmDateFrom = $.pngFormatDateTime(_val.dtmDate,'l')

                                        if(Object.keys(objPriceDetail).length)
                                            objDetail['arrListPrice'].push(objPriceDetail)
                                    }else{
                                        intQuantity++
                                    }

                                    dtmDateTo = moment($.pngFormatDateTime(_val.dtmDate,'l')).add('days',1).format('l')

                                    objPriceDetail = {
                                        intQuantity: intQuantity,
                                        dblUnitPrice: dblUnitPrice,
                                        dblUnitComPrice: dblUnitComPriceItem,
                                        dtmDateFrom: dtmDateFrom,
                                        dtmDateTo: dtmDateTo,
                                        strPriceSeasonGUID: _val.strPriceSeasonGUID
                                    }

                                }else{
                                    IsNA=true
                                }

                            })

                            objDetail['arrListPrice'].push(objPriceDetail)

                            $('[row='+_intKey+'] .pnGITPrice','#pnListRoom .pnListPrice').hide()

                            if(!IsNA){

                                if(IsGIT)
                                    $('[row='+_intKey+'] .pnGITPrice','#pnListRoom .pnListPrice').show()

                                objDetail['IsInstantBooking'] = true
                                objDetail['dblUnitPrice'] = 0
                                objDetail['dblUnitComPrice'] = 0
                                objDetail['arrListPrice'].forEach(function(val){
                                    objDetail['dblUnitPrice']+= val.intQuantity*val.dblUnitPrice
                                    objDetail['dblUnitComPrice']+= val.intQuantity*val.dblUnitComPrice
                                })

                                objDetail['intAllotmentRemain'] = obj.intAllotmentRemain

                                $('[row='+_intKey+'] .pnElm-PnAvailable','#pnListRoom .pnListPrice').html('(<b>Available:</b> '+obj.intAllotmentRemain+')')

                                $('[row='+_intKey+'] .pnQuantity','#pnListRoom .pnListPrice').show().change()
                                $('[row='+_intKey+'] .txtNA','#pnListRoom .pnListPrice').hide()

                                $('[row='+_intKey+'] .pn-dblUnitPrice','#pnListRoom .pnListPrice').html('<a action="ViewUnitPrice" intRowID="'+_intKey+'" style="cursor: inherit;position:relative">'+$.pngFormatPrice((objDetail['dblUnitPrice']))+'</a> '+(IsGIT? '<div class="pnGITPrice" ><i class="fa fa-usd"></i> GIT</div>' : ''))

                                $('[row='+_intKey+'] .pnMealIncludedType','#pnListRoom .pnListPrice').show()
                                var str = objDetail.strMealIncludedTypeName
                                if (objDetail['arrListMealIncludedType'].length > 1)
                                    str += ' <a class="btnMealIncludedType"><i class="fa fa-pencil"></i></a>'
                                $('[row='+_intKey+'] .pnMealIncludedType span','#pnListRoom .pnListPrice').html(str)

                                $('[row='+_intKey+'] .pnMealIncludedType .btnMealIncludedType','#pnListRoom .pnListPrice').click(function(){
                                    GetPopUp_ChangeMealIncludeType({
                                        arrList: objDetail['arrListMealIncludedType'],
                                        objDetail: objDetail,
                                        OnSuccess: function(_intMealIncludedTypeID){
                                            objDetail.intMealIncludedTypeID = _intMealIncludedTypeID
                                            objDetail.strMealIncludedTypeName = objDetail['arrListMealIncludedType'].filter(function(item){ return item.intMealIncludedTypeID == _intMealIncludedTypeID })[0].strMealIncludedTypeName
                                            GetChangeQuantity(_intKey)
                                        }
                                    })
                                })



                                if ($(window).width() >= 1024){

                                    $( '[row='+_intKey+'] a[action=ViewUnitPrice]','#pnListRoom .pnListPrice' ).hover(function() {

                                        var obj = Arr_ListItemType[$(this).attr('intRowID')]

                                        var strHtml = ''
                                        strHtml+='<div id="pnSeeMore" class="bg-white pn-padding-15" style="position:absolute;z-index: 2;line-height: 25px;box-shadow: 0px 0px 18px -7px;text-align:left;right: 0;width:400px">'

                                        obj.arrListPrice.forEach(function(value){
                                            strHtml+= ''
                                            strHtml+='<div><b>'+$.pngFormatDateTime(value.dtmDateFrom)+' - '+$.pngFormatDateTime(value.dtmDateTo)+'</b></div>'
                                            strHtml+='<div> '+value.intQuantity+' x '+$.pngFormatPrice(value.dblUnitPrice)+'</div>'

                                        })

                                        strHtml+='</div>'

                                        $( this ).append( strHtml );
                                    }, function() {
                                    $( this ).find( "#pnSeeMore" ).remove();
                                    }

                                    );
                                }else{
                                    $('[row='+_intKey+'] a[action=ViewUnitPrice]','#pnListRoom .pnListPrice' ).click(function(){

                                        var obj = Arr_ListItemType[$(this).attr('intRowID')]
                                        GetPanelFullScreen(function(_idOrClassPn){


                                            var strHtml = ''
                                            strHtml+='<div id="pnSeeMore" class="bg-white pn-padding-15" style="">'

                                            obj.arrListPrice.forEach(function(value){
                                                strHtml+= ''
                                                strHtml+='<div><b>'+$.pngFormatDateTime(value.dtmDateFrom)+' - '+$.pngFormatDateTime(value.dtmDateTo)+'</b></div>'
                                                strHtml+='<div> '+value.intQuantity+' x '+$.pngFormatPrice(value.dblUnitPrice)+'</div>'

                                            })

                                            strHtml+='</div>'

                                            $(_idOrClassPn).html(strHtml)

                                        })
                                    })


                                }

                                objDetail.intQuantity = parseFloat(objDetail.intQuantity)

                                objDetail.dblTotalPrice = objDetail.dblUnitPrice * objDetail.intQuantity

                                objDetail.dblTotalComPrice = objDetail.dblUnitComPrice * objDetail.intQuantity

                                $('.pn-dblTotalPrice[row='+_intKey+']','.pnListPrice').html($.pngFormatPrice((objDetail.dblTotalPrice)))

                                $('[row='+_intKey+'] button','.pnListPrice').hide()//attr('disabled',true)

                                if(objDetail.intQuantity)
                                    if(objDetail.intQuantity > objDetail.intAllotmentRemain){
                                        $('[row='+_intKey+'] button[action=Request]','.pnListPrice').show()
                                    }else{
                                        $('[row='+_intKey+'] button[action=AddToCart]','.pnListPrice').show()
                                        $('[row='+_intKey+'] button[action=Booking]','.pnListPrice').show()
                                    }

                            }else{
                            }
                        }else{

                        }


                    }

                    function GetPriceTable(){
                        var ArrListForGIT = Arr_ListFoc.filter(function(item){ return item.intFOCTypeID==3 })

                        strHtml = ''

                        if(ArrListForGIT.length){
                            strHtml += '<div class="pn-padding-b-15" style="color:red">(Bạn hãy chọn '+ArrListForGIT[0].intFOCPax+' phòng trở lên để được giá GIT)</div>'
                        }

                        $('#pnListRoom .txtCfmGT').html(strHtml)

                        $('.pnMealIncludedType','#pnListRoom .pnListPrice').hide()

                        Arr_ListItemType.forEach(function(value,key){

                            var arr = ArrPriceRoom.filter(function(item){ return (item.strItemTypeGUID || '').toUpperCase() == value.strItemTypeGUID.toUpperCase() })

                            // console.log( value)
                            // console.log( ArrPriceRoom)
                            // var arrListDate = ArrPriceRoom.map(item => item.dtmDate)
                            //                 .filter((value, index, self) => self.indexOf(value) === index)

                            var obj = null
                            if( arr.length ){

                                obj = arr[0]

                                var intQuantity = 1
                                var dtmDateFrom
                                var dtmDateTo
                                var dblUnitPrice = 0

                                var objPriceDetail = {}
                                var objPriceDetailGIT = {
                                    intQuantity: 1,
                                    dblUnitPrice: 0
                                }

                                value['arrListPrice'] = []
                                value['arrListPriceGIT'] = []

                                if(!value.intMealIncludedTypeID){
                                    value.intMealIncludedTypeID = obj.intMealIncludedTypeID
                                    value.strMealIncludedTypeName = obj.strMealIncludedTypeName
                                }

                                var IsNA = false

                                Arr_ListDate.forEach(function(_val){

                                    var arr = ArrPriceRoom.filter(function(item){ return (item.intMealIncludedTypeID == value.intMealIncludedTypeID && item.strItemTypeGUID || '').toUpperCase() == value.strItemTypeGUID.toUpperCase() && item.strPriceSeasonGUID.toUpperCase() == (_val.strPriceSeasonGUID || '').toUpperCase() })

                                    if( arr.length ){

                                    }else{
                                        IsNA=true
                                    }

                                })

                                if(!IsNA){

                                    $('[row='+key+'] .pnQuantity','#pnListRoom .pnListPrice').show().change()
                                    $('[row='+key+'] .txtNA','#pnListRoom .pnListPrice').hide()


                                    GetButtonSelect(true,key)

                                    GetChangeQuantity(key)


                                    function GetButtonSelect(_IsSelect,_intRowID){

                                        if(_IsSelect){

                                            var strHtml = ''
                                            // if(!value.IsSelect)
                                                strHtml+='<button class="btn bg-success txt-white" action="Booking" data="'+_intRowID+'" style="">Đặt luôn</button>'
                                                strHtml+='<button class="btn" action="AddToCart" data="'+_intRowID+'" style="">Thêm vào giỏ hàng</button>'
                                                strHtml+='<button class="btn" action="Request" data="'+_intRowID+'" style="">Gửi yêu cầu</button>'
                                            // else
                                            //     strHtml+='<b>Đã chọn</b>'

                                            $('[row='+_intRowID+'] .pn-strHtmlAction','#pnListRoom .pnListPrice').html(strHtml)
                                            $('[row='+_intRowID+'] .intQuantity','#pnListRoom .pnListPrice').attr('disabled',false)
                                            $('[row='+key+'] input','#pnListRoom .pnListPrice').change()

                                            $('[row='+_intRowID+'] button','#pnListRoom .pnListPrice').click(function(){
                                                var action = $(this).attr('action')
                                                var intRowID = $(this).attr('data')
                                                if (Obj_User) {
                                                    if(action=='Request'){

                                                        GetPopUp_SelectRoom({
                                                            Str_CompanyOwnerGUID: Str_CompanyOwnerGUID,
                                                            Arr_PriceRoom: ArrPriceRoom,
                                                            Arr_ListDate: Arr_ListDate,
                                                            Arr_ListBook: Arr_ListBook,
                                                            Arr_ListFoc: Arr_ListFoc,
                                                            objAgentHostDtl: Obj_DetailAgentHost,
                                                            Obj_SearchDtl:Obj_SearchDtl,
                                                            objDetail: Arr_ListItemType[intRowID],
                                                            intChildOptionID: ($('[row='+intRowID+'] input[name=option_'+intRowID+']:checked','#pnListRoom .pnListPrice').val() || 0),
                                                            intType: 1,
                                                            OnSuccess: function (_arr_List_Book,_arr_List_BookFOC) {
                                                                Arr_ListBook= _arr_List_Book
                                                                Arr_ListBookFOC = _arr_List_BookFOC


                                                                // GetButtonSelect(false,intRowID)
                                                                GetPriceTable()
                                                                // GetTotalAllPrice()
                                                            },
                                                        })
                                                        // Arr_ListItemType[intRowID].IsSelect = true

                                                    }

                                                    if(action=='AddToCart'){
                                                        GetPopUp_SelectRoom({
                                                            Str_CompanyOwnerGUID: Str_CompanyOwnerGUID,
                                                            Arr_PriceRoom: ArrPriceRoom,
                                                            Arr_ListDate: Arr_ListDate,
                                                            Arr_ListBook: Arr_ListBook,
                                                            Arr_ListFoc: Arr_ListFoc,
                                                            objAgentHostDtl: Obj_DetailAgentHost,
                                                            Obj_SearchDtl:Obj_SearchDtl,
                                                            objDetail: Arr_ListItemType[intRowID],
                                                            intChildOptionID: ($('[row='+intRowID+'] input[name=option_'+intRowID+']:checked','#pnListRoom .pnListPrice').val() || 0),
                                                            intType: 2,
                                                            OnSuccess: function (_arr_List_Book,_arr_List_BookFOC) {
                                                            },
                                                        })
                                                        Arr_ListItemType[intRowID].IsSelect = true

                                                    }
                                                    if(action=='Booking'){

                                                        Obj_DetailAgentHost.strPassengerOrderByAgentHostGUID = Str_CompanyOwnerGUID
                                                        Obj_DetailAgentHost.strCompanyGUID = Str_CompanyOwnerGUID
                                                        Arr_ListItemType[intRowID].strServiceName_View = Arr_ListItemType[intRowID].strItemTypeName + '(' + Arr_ListItemType[intRowID].strMealIncludedTypeName + ')' + ' - ' + Arr_ListItemType[intRowID].strSglDblName + '<br>' + $.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckIn) + ' - ' + $.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckOut)
                                                        Arr_ListItemType[intRowID].strPassengerOrderByAgentHostGUID = Str_CompanyOwnerGUID

                                                        Arr_ListItemType[intRowID]['dblPriceTotal_View'] = $.pngFormatPrice(Arr_ListItemType[intRowID].dblTotalPrice)
                                                        Arr_ListItemType[intRowID]['dblTotalCommission_View'] = $.pngFormatPrice(Arr_ListItemType[intRowID].dblTotalComPrice)

                                                        var arrListAgentHost = [Obj_DetailAgentHost]
                                                        var arrListService = [Arr_ListItemType[intRowID]]


                                                        var Arr_ListFOCUse = []
                                                        GetArr_ListFOC({
                                                            Arr_ListBook: [Arr_ListItemType[intRowID]],
                                                            Arr_ListFoc: Arr_ListFoc,
                                                            Obj_SearchDtl: Obj_SearchDtl,
                                                            Is_BookNotMinstay: null,
                                                            OnSuccess: function (_arr) {
                                                                Arr_ListFOCUse = _arr
                                                            }
                                                        })

                                                        $.fn.loadJS(coreSystem.getLinkVer('Lib_Custom/_MdCm_All.js'))
                                                        $.ModuleCommon_All_PopUpPaymentBooking({
                                                            strUserGUID: options.strUserGUID
                                                            ,strCompanyPartnerGUID: options.strCompanyPartnerGUID
                                                            ,arrListAgentHost: arrListAgentHost
                                                            ,arrListService: arrListService
                                                            ,objSuppDetail: $.pngExtendObj(Arr_ListItemType[intRowID],{
                                                                strSupplierGUID: Obj_Detail.strSupplierGUID
                                                                ,strCompanyGUID: Str_CompanyOwnerGUID
                                                                ,strPriceLevelGUID: Str_PriceLevelGUID
                                                                ,strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                                                ,objSearchDtl: Obj_SearchDtl
                                                                ,arrListDate: Arr_ListDate
                                                                ,arrPriceRoom: ArrPriceRoom
                                                                ,arrListFoc: Arr_ListFoc
                                                                ,arrListFOCUse: Arr_ListFOCUse
                                                                ,intChildOptionID: ($('[row='+intRowID+'] input[name=option_'+intRowID+']:checked','#pnListRoom .pnListPrice').val() || 0),
                                                            })
                                                            ,OnSuccess: function () {
                                                            }
                                                        })

                                                        // GetPopUp_SelectRoom({
                                                        //     Str_CompanyOwnerGUID: Str_CompanyOwnerGUID,
                                                        //     Arr_PriceRoom: ArrPriceRoom,
                                                        //     Arr_ListDate: Arr_ListDate,
                                                        //     Arr_ListBook: Arr_ListBook,
                                                        //     Arr_ListFoc: Arr_ListFoc,
                                                        //     objAgentHostDtl: objAgentHostDtl,
                                                        //     Obj_SearchDtl:Obj_SearchDtl,
                                                        //     objDetail: Arr_ListItemType[intRowID],
                                                        //     intChildOptionID: $('[row='+intRowID+'] input[name=option_'+intRowID+']:checked','#pnListRoom .pnListPrice').val(),
                                                        //     intType: 3,
                                                        // })
                                                        // Arr_ListItemType[intRowID].IsSelect = true

                                                    }
                                                }else {
                                                    window.location.href = '/user/login?strReturnUrl=' + window.location.href
                                                }
                                            })

                                        }else{

                                            var strHtml = ''
                                            // if(!value.IsSelect)
                                            strHtml = '<button class="btn" action="UnSelect" data="'+_intRowID+'" style="width:100%">Bỏ Chọn</button>'
                                            // else
                                            //     strHtml+='<b>Đã chọn</b>'

                                            $('[row='+_intRowID+'] .pn-strHtmlAction','#pnListRoom .pnListPrice').html(strHtml)
                                            $('[row='+_intRowID+'] .intQuantity','#pnListRoom .pnListPrice').attr('disabled',true)

                                            $('[row='+_intRowID+'] button','#pnListRoom .pnListPrice').click(function(){
                                                var action = $(this).attr('action')
                                                var intRowID = $(this).attr('data')

                                                if(action=='UnSelect'){
                                                    var IsConfirm = false
                                                    var intNoRooms = 0

                                                    Arr_ListBook.forEach(function(value){
                                                        intNoRooms+=parseInt(value.intQuantity)
                                                    })

                                                    var ArrListForGIT = Arr_ListFoc.filter(function(item){ return item.intFOCTypeID==3 })

                                                    if(ArrListForGIT.length){
                                                        if(intNoRooms >= ArrListForGIT[0].intFOCPax && intNoRooms - parseInt(Arr_ListItemType[intRowID].intQuantity) < ArrListForGIT[0].intFOCPax ){
                                                            IsConfirm = true
                                                        }
                                                    }

                                                    var strContent = '<span langkey="sys_Cfm_AYS"></span>'

                                                    if(IsConfirm){
                                                        strContent = 'Nếu bạn bỏ chọn phòng này. Hệ thống sẽ cập nhật sang giá FIT.<br> Bạn chắc chắn chứ'
                                                    }


                                                    $.Confirm({
                                                        strContent: strContent
                                                        , OnSuccess: function () {
                                                            Arr_ListBook.forEach(function(value,key){
                                                                if(value.strItemTypeDetailGUID.toUpperCase() == Arr_ListItemType[intRowID].strItemTypeDetailGUID.toUpperCase()){
                                                                    Arr_ListBook.splice(key,1)
                                                                }
                                                            })


                                                            // GetButtonSelect(true,intRowID)

                                                            GetArr_ListFOC({
                                                                Arr_ListBook: Arr_ListBook,
                                                                Arr_ListFoc: Arr_ListFoc,
                                                                Obj_SearchDtl: Obj_SearchDtl,
                                                                Is_BookNotMinstay: Is_BookNotMinstay,
                                                                OnSuccess: function (_arr) {
                                                                    Arr_ListBookFOC = _arr
                                                                }
                                                            })

                                                            GetPriceTable()
                                                            // GetTotalAllPrice()
                                                        }
                                                    })


                                                    // Arr_ListItemType[intRowID].IsSelect = true

                                                }
                                            })

                                        }

                                    }
                                }else{
                                    GetRowNA(value,key)
                                }


                            }else{

                                GetRowNA(value,key)

                            }


                        })

                        // GetArr_ListFOC({
                        //     Arr_ListBook: Arr_ListBook,
                        //     Arr_ListFoc: Arr_ListFoc,
                        //     Obj_SearchDtl: Obj_SearchDtl,
                        //     Is_BookNotMinstay: Is_BookNotMinstay,
                        //     OnSuccess: function (_arr) {
                        //         Arr_ListBookFOC = _arr
                        //     }
                        // })


                        function GetRowNA(value,key){
                            value['IsInstantBooking'] = false
                            value['IsSelect'] = false
                            value['dblUnitPrice'] = null
                            value['dblUnitComPrice'] = null

                            $('[row='+key+'] .txtAlm','#pnListRoom .pnListPrice').html('')

                            $('[row='+key+'] .pnQuantity','#pnListRoom .pnListPrice').hide()
                            $('[row='+key+'] .intQuantity','#pnListRoom .pnListPrice').hide()
                            $('[row='+key+'] .txtNA','#pnListRoom .pnListPrice').show()

                            $('[row='+key+'] .pn-dblUnitPrice','#pnListRoom .pnListPrice').html('N/A')
                            $('[row='+key+'] .pn-dblTotalPrice','#pnListRoom .pnListPrice').html('N/A')
                            $('[row='+key+'] .pn-strHtmlAction','#pnListRoom .pnListPrice').html('')
                        }

                        GetTotalAllPrice()
                    }

                    function GetPolicy() {
                        var arrChild = Arr_ListPolicy.filter(function (item) { return item.intPolicyTypeID == 3 })

                        if (arrChild.length) {
                            var strHtml = ''
                            strHtml += '<div style="display: flow-root">'
                            strHtml += '<h3 class="pn-margin-t-b-30 mobile-pn-float-none" style="float:left"><b>Chính sách trẻ em</b> </h3>'
                            strHtml += '</div>'

                            strHtml += '<div class="pn-padding-15 bg-white pn-round-1em">'
                            arrChild.forEach(function (value) {
                                strHtml += '<p><b>' + value.strPolicyName + '</b></p>'
                                strHtml += '<p>' + value.strPolicyContent + '</p>'
                            })
                            strHtml += '</div>'

                            $('#pnChildPolicy').html(strHtml)
                        } else {
                            $('#pnChildPolicy').html('')
                        }

                        var arrPro = Arr_ListPolicy.filter(function (item) { return item.intPolicyTypeID == 1 })
                        var arrSur = Arr_ListPolicy.filter(function (item) { return item.intPolicyTypeID == 2 })

                        var strHtml = `
                                <div class="pnPro"></div>
                                <div class="pnSur"></div>
                            `
                        $('#pnListRoom .pnListPolicy').html(strHtml)

                        strHtml = ''
                        if (arrPro.length) {
                            strHtml += '<h3 class="pn-margin-t-b-15"><b>Khuyến mại</b></h3>'
                            arrPro.forEach(function (value) {
                                strHtml += '<p><b>' + value.strPolicyName + '</b></p>'
                                strHtml += '<p>' + value.strPolicyContent + '</p>'
                            })
                        }

                        if (arrSur.length) {
                            strHtml += '<h3 class="pn-margin-t-b-15"><b>Phụ thu</b></h3>'
                            arrSur.forEach(function (value) {
                                strHtml += '<p><b>' + value.strPolicyName + '</b></p>'
                                strHtml += '<p>' + value.strPolicyContent + '</p>'
                            })
                        }

                        $('.pnPro', '#pnListRoom .pnListPolicy').html(strHtml)




                    }


                    function GetTotalAllPrice(){
                        var dblTotalAllPrice = 0
                        var dblTotalAllComPrice = 0
                        var dblTotalAllRooms = 0

                        // var ArrBooking = Arr_ListItemType.filter(function(item){ return (item.intQuantity || item.intQuantity >0 ) && item.IsSelect })

                        var strItemTypeGUID = ''
                        var intQuantity = 0

                        var IsInstantBooking = true

                        // var ArrAllBooking = ArrBooking.filter(function(item){ return (item.intAllotmentRemain || item.intAllotmentRemain >0 )})

                        Arr_ListBook.forEach(function(value){
                            dblTotalAllPrice+=value.dblTotalPriceAll
                            dblTotalAllComPrice+=value.dblTotalComPriceAll


                            // if( value.IsInstantBooking){
                                dblTotalAllRooms+=parseInt(value.intQuantity)
                            // }
                            if(IsInstantBooking && value.IsInstantBooking){
                                if(strItemTypeGUID != value.strItemTypeGUID){
                                    strItemTypeGUID = value.strItemTypeGUID
                                    intQuantity= 0
                                }
                                intQuantity+= value.intQuantity
                                if(!value.intAllotmentRemain || intQuantity > value.intAllotmentRemain){
                                    IsInstantBooking = false
                                }

                            }

                        })

                        if(Arr_ListBookFOC.length){
                            Arr_ListBookFOC.forEach(function(value){

                                dblTotalAllPrice+= value.intQuantity * value.dblUnitPrice

                            })
                        }
                        // ArrPriceChildAge.forEach(function(value){
                        //     if( value.IsEnableInput ){
                        //         dblTotalAllPrice+=value.dblTotalPrice
                        //         dblTotalAllComPrice+=value.dblTotalComPrice
                        //     }
                        // })

                        // if(ArrBooking.length){
                        //     console.log(Arr_Surcharge)
                        //     if(Arr_Surcharge && Arr_Surcharge.length){
                        //         var arr = Arr_Surcharge.filter(function(item) { return item.IsEnableInput })

                        //         arr.forEach(function(value){
                        //             dblTotalAllPrice+=value.dblTotalPrice
                        //         })
                        //     }
                        // }

                        Dbl_TotalAllPrice = dblTotalAllPrice

                        pnSupPrice_PriceBooking({
                            dblTotalPrice: dblTotalAllPrice
                            , dblTotalComPrice: dblTotalAllComPrice
                            , dblTotalRooms: dblTotalAllRooms
                            , IsInstantBooking:IsInstantBooking
                        })

                        if(Obj_FN_Main.pnMain){
                            Obj_FN_Main.pnMain('pnPayemntTerm')
                            Obj_FN_Main.pnMain('pnCancellation')
                        }

                    }

                    function pnSupPrice_PriceBooking(_Opt) {
                        var Dft = {
                            dblTotalPrice: 0
                            , dblTotalComPrice: 0
                            , dblTotalRooms: 0
                            , IsInstantBooking: false
                            , OnSuccess: function () {

                            }
                        }
                        _Opt = $.extend(Dft, _Opt);

                        var IdOrClassPn = '#pnSupPrice .pnPriceBooking'


                        var strHtml = ''

                        strHtml += '<div class="row">'
                        strHtml += '<div class="col-md-12 col-xs-8">'
                        strHtml += '<div style="color:#F7904D;">Tổng số phòng: <b>' + _Opt.dblTotalRooms + ' phòng</b></div>'
                        strHtml += '<div style="font-size:20px;font-weight:bold;color:#1076FC">Tổng giá: ' + $.pngFormatPrice(_Opt.dblTotalPrice) + ' </div>'
                        //strHtml += '<div>(Tổng giá hoa hồng:' + $.pngFormatPrice(_Opt.dblTotalComPrice) + ')</div>'
                        strHtml += '</div>'
                        strHtml += '<div class="col-md-12 col-xs-4">'
                        if (_Opt.dblTotalPrice != 0) {
                            if (_Opt.IsInstantBooking) {
                                strHtml += '<button class="btn" style="padding:5px;width:100%;background:#257EF8;color:#fff;border-radius:10em" id="btnInstantBooking">Instant Booking</button>'
                            } else {
                                strHtml += '<button class="btn" style="padding:5px;width:100%;background:#257EF8;color:#fff;border-radius:10em" id="btnBooking">Booking</button>'
                            }
                        }
                        strHtml += '</div>'
                        strHtml += '<div style="margin-top: 15px;padding-top: 15px;border-top: 1px solid #ccc;" class="col-md-12 pnListBook tablet-pn-display-none"></div>'

                        if (_Opt.dblTotalRooms != 0)
                            $(IdOrClassPn).html(strHtml)
                        else
                            $(IdOrClassPn).html('<b>Bạn hãy chọn Dịch vụ để Book</b>')


                        var ObjOrderDetail = null
                        //coreLoadPage.viewOrderBooking({
                        //    IsGetDetail: true
                        //    , OnSuccess: function (_objOrderDetail) {
                        //        ObjOrderDetail = _objOrderDetail
                        //    }
                        //})

                        strHtml = ''
                        Arr_ListBook.forEach(function (Obj_Rtn) {
                            strHtml += '<div style="padding-bottom: 15px;margin-bottom: 15px;border-bottom: 1px solid #ccc;">'
                            strHtml += '<div>'
                            strHtml += '<b>' + Obj_Rtn.strItemTypeName + ' - ' + Obj_Rtn.strSglDblName + '</b>'
                            strHtml += ' (' + Obj_Rtn.intQuantity + ' x ' + $.pngFormatPrice(Obj_Rtn.dblUnitPrice) + ')'
                            strHtml += '</div>'
                            strHtml += '<div> '

                            strHtml += '<div><b>' + pngElm.getLangKey({ langkey: 'sys_Txt_CheckIn' }) + ' - ' + pngElm.getLangKey({ langkey: 'sys_Txt_CheckOut' }) + ': </b></div>'
                            strHtml += '<div> ' + $.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckIn) + ' - ' + $.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckOut) + '</div>'
                            if (Obj_Rtn.arrChildAge && Obj_Rtn.arrChildAge.length) {
                                strHtml += '<div><b>' + pngElm.getLangKey({ langkey: 'sys_Txt_ChildAge' }) + '</b></div>'
                                Obj_Rtn.arrChildAge.forEach(function (value, key) {
                                    strHtml += '<div> - <b>' + value.strChildAge + '</b>: ' + value.intQuantity + ' x ' + $.pngFormatPrice(value.dblUnitPrice) + '</div>'
                                })
                            }
                            if (Obj_Rtn.arrSurcharge && Obj_Rtn.arrSurcharge.length) {
                                strHtml += '<div><b>Surcharge</b></div>'
                                Obj_Rtn.arrSurcharge.forEach(function (value, key) {
                                    strHtml += '<div> - <b>' + value.strSurchargeName + '</b>: ' + value.intQuantity + ' x ' + $.pngFormatPrice(value.dblUnitPrice) + '</div>'
                                })
                            }
                            strHtml += '</div> '
                            // if(Obj_Rtn.arrFOC && Obj_Rtn.arrFOC.length){
                            //     strHtml+= '<div><b>FOC</b></div>'
                            //     Obj_Rtn.arrFOC.forEach(function(value,key){
                            //         strHtml+= '<div> - <b>'+value.strName+'</b>: '+value.intQuantity+' x '+$.pngFormatPrice(value.dblUnitPrice)+'</div>'
                            //     })
                            // }
                            strHtml += '</div>'
                        })

                        if (Arr_ListBookFOC.length) {
                            strHtml += '<div><b>FOC</b></div>'
                            Arr_ListBookFOC.forEach(function (value) {
                                strHtml += '<div> - <b>' + value.strName + '</b>: ' + value.intQuantity + ' x ' + $.pngFormatPrice(value.dblUnitPrice) + '</div>'

                            })
                        }

                        $('.pnListBook', IdOrClassPn).html(strHtml)


                        $('#btnBooking').click(function () {



                            if (Obj_User) {

                                $.Confirm({
                                    strContent: '<span langkey="sys_Cfm_AYS-book"></span>'  //---Dialog Lựa chọn
                                    , OnSuccess: function () {
                                        BookingHotel(false)
                                    }
                                })
                            } else {
                                window.location.href = '/user/login?strReturnUrl=' + window.location.href
                            }
                        })
                        $('#btnInstantBooking').click(function () {
                            // if(ObjOrderDetail){
                            //     coreLoadPage.viewOrderBooking_Cfm({
                            //         objOrderDetail: ObjOrderDetail
                            //         ,OnSuccess: function (_strOrderBookingGUID) {
                            //             BookingHotel(true,_strOrderBookingGUID)
                            //         }
                            //     })
                            // }else{
                            //     coreLoadPage.viewOrderBooking_Cfm({
                            //         objOrderDetail: null
                            //         ,OnSuccess: function () {
                            //             BookingHotel(true)
                            //         }
                            //     })
                            // }

                            var strListItemTypeGUID = ''
                            var strListSupplierChildAgeGUID = ''
                            var strListSurchargeDateGUID = ''
                            var strListFocGUID = ''


                            Arr_ListBook.forEach(function (value) {
                                strListItemTypeGUID += value.strItemTypeGUID + '!' + value.intSglDblID + '!' + value.intQuantity + '#'

                                if (value.arrChildAge && value.arrChildAge.length) {
                                    value.arrChildAge.forEach(function (val) {
                                        strListSupplierChildAgeGUID += value.strItemTypeGUID + '!' + val.strSupplierChildAgeGUID + '!' + value.intSglDblID + '!' + val.intQuantity + '#'
                                    })

                                }

                                if (value.arrSurcharge && value.arrSurcharge.length) {
                                    value.arrSurcharge.forEach(function (val) {
                                        strListSurchargeDateGUID += value.strItemTypeGUID + '!' + val.strSurchargeDateGUID + '!' + value.intSglDblID + '!' + val.intQuantity + '#'
                                    })

                                }
                            })

                            Arr_ListBookFOC.forEach(function (value) {
                                // if(value.IsEnableInput){
                                strListFocGUID += value.strFocGUID + ','
                                // }
                            })

                            $.ModuleMainLead_Hotel_Detail_PopUpAllotment({
                                strUserGUID: options.strUserGUID
                                , strCompanyPartnerGUID: options.strCompanyPartnerGUID
                                , strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                , intAdult: Obj_SearchDtl.intNoAdult
                                , arrChildren: Obj_SearchDtl.arrChildren
                                , dtmDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                , dtmDateTo: Obj_SearchDtl.dtmDateCheckOut
                                , strPriceLevelGUID: Str_PriceLevelGUID
                                , strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                , strListItemTypeGUID: strListItemTypeGUID
                                , strListSupplierChildAgeGUID: strListSupplierChildAgeGUID
                                , strListSurchargeDateGUID: strListSurchargeDateGUID
                                , strListFocGUID: strListFocGUID
                                , dblTotalPrice: _Opt.dblTotalPrice
                                , dblTotalComPrice: _Opt.dblTotalComPrice
                                , Arr_ListBook: Arr_ListBook
                                , Arr_ListBookFOC: Arr_ListBookFOC
                                , OnSuccess: function () {

                                }
                            })
                        })



                        function BookingHotel(_isInstantBooking, _strOrderBookingGUID = null) {
                            var xmlNoOfChild = ''
                            Obj_SearchDtl.arrChildren.forEach(function (value) {
                                xmlNoOfChild += '<child>' + value + '</child>'
                            })

                            console.log(Arr_ListBook)

                            var strListItemTypeGUID = ''
                            var strListSupplierChildAgeGUID = ''
                            var strListSurchargeDateGUID = ''
                            var strListFocGUID = ''


                            Arr_ListBook.forEach(function (value) {
                                strListItemTypeGUID += value.strItemTypeGUID + '!' + value.intSglDblID + '!' + value.intQuantity + '#'

                                if (value.arrChildAge && value.arrChildAge.length) {
                                    value.arrChildAge.forEach(function (val) {
                                        strListSupplierChildAgeGUID += value.strItemTypeGUID + '!' + val.strSupplierChildAgeGUID + '!' + value.intSglDblID + '!' + val.intQuantity + '#'
                                    })

                                }

                                if (value.arrSurcharge && value.arrSurcharge.length) {
                                    value.arrSurcharge.forEach(function (val) {
                                        strListSurchargeDateGUID += value.strItemTypeGUID + '!' + val.strSurchargeDateGUID + '!' + value.intSglDblID + '!' + val.intQuantity + '#'
                                    })

                                }
                            })

                            Arr_ListBookFOC.forEach(function (value) {
                                // if(value.IsEnableInput){
                                strListFocGUID += value.strFocGUID + ','
                                // }
                            })

                            // ArrPriceRoom.forEach(function(value){
                            //     if(value.intNoOfRooms && value.intNoOfRooms > 0 && value.IsEnableInput)
                            //         // strListSupplierMappingPriceGUID+=value.strSupplierMappingPriceGUID+'!'+value.intSglDblID+'!'+value.intNoOfRooms+'!'+(value.intAEB || 0)+'!'+(value.intEXB || 0)+'!'+(value.intBFN || 0)+'#'
                            //         strListSupplierMappingPriceGUID+=value.strSupplierMappingPriceGUID+'!'+value.intSglDblID+'!'+value.intNoOfRooms+'#'
                            // })


                            // ArrPriceChildAge.forEach(function(value){
                            //     if(value.intQuantity && value.intQuantity > 0 && value.IsEnableInput)
                            //         strListChildSupplierMappingPriceGUID+=value.strSupplierMappingPriceGUID+'!'+value.intQuantity+'#'
                            // })
                            // Arr_Surcharge.forEach(function(value){
                            //     if(value.intQuantity && value.intQuantity > 0 && value.IsEnableInput)
                            //         strListSurchargeDateGUID+=value.strSurchargeDateGUID+'!'+value.intQuantity+'#'
                            // })

                            // $.Confirm({
                            //     strContent: '<span langkey="sys_Cfm_AYS-book"></span>', IsConfirm: true,
                            //     OnSuccess: function () {

                            pngPn.getOutputApi({
                                objApi: ObjList_Api.AddPassengerOrderForSupByHotelByPUB
                                , objParams_Cus: {
                                    strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                   // , strPriceLevelGUID: Str_PriceLevelGUID
                                    , strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                    , strListItemTypeGUID: strListItemTypeGUID
                                    , strListSupplierChildAgeGUID: strListSupplierChildAgeGUID
                                    , strListSurchargeDateGUID: strListSurchargeDateGUID
                                    // ,strListFocGUID: strListFocGUID
                                    , IsBookNotMinstay: Is_BookNotMinstay
                                    , strOrderBookingGUID: _strOrderBookingGUID
                                    , intAdult: Obj_SearchDtl.intNoAdult
                                    , xmlNoOfChild: xmlNoOfChild
                                    , dtmDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                    , dtmDateTo: Obj_SearchDtl.dtmDateCheckOut
                                    , IsInstantBooking: _isInstantBooking
                                }
                                , customEvent: function (ArrAllList) {

                                    //coreLoadPage.viewOrderBooking({
                                    //    IsDelete: true
                                    //})

                                    //var strUrl = coreLoadPage.getUrlHost()
                                    //strUrl = $.pngGetQSVal('cname', $.pngGetQSVal('cname'), strUrl)
                                    //strUrl = $.pngGetQSVal('page', 'order', strUrl)
                                    //strUrl = $.pngGetQSVal('GUID', ArrAllList[0][0]['strOrderBookingGUID'], strUrl)

                                    //window.location.href = strUrl

                                    window.location.href = '/user/orderdetail?GUID=' + ArrAllList[0][0]['strOrderBookingGUID']
                                }
                            })
                            //     }
                            // })
                        }



                    }


                    function GetPanelFullScreen(_OnHtml) {
                        var IdOrClass_Pn = Math.random().toString(36).substring(4).toUpperCase()

                        var strHtml = ''
                        strHtml += '<div id="' + IdOrClass_Pn + '" class="pnFullScreen" style="background: #fff; position: fixed; z-index: 1000; top: 0; bottom: 0; left: 0; right: 0;">'
                        strHtml += '<div style="display: flow-root;border-bottom: 1px solid #ccc;padding: 5px">'
                        strHtml += '     <button type="button" class="close" style="font-size: 40px;"><i class="fa fa-times"></i></button>'
                        strHtml += '</div>'
                        strHtml += '<div class="pnContent" style="overflow: auto; height: calc( 100vh - 60px);"></div>'
                        strHtml += '</div>'

                        $('body').append(strHtml)

                        IdOrClass_Pn = '#' + IdOrClass_Pn

                        $('.close', IdOrClass_Pn).click(function () {
                            $(IdOrClass_Pn).remove()
                        })

                        _OnHtml.call(this, IdOrClass_Pn + ' .pnContent')


                    }

                }



                function GetPopUp_ViewImage(_Opt) {
                    var Dft = {
                        intKey: 0,
                        OnSuccess: function () {

                        }
                    }
                    _Opt = $.extend(Dft, _Opt);

                    var IdOrClass__Main = ''


                    //---------Obj__XXX      // Khai báo các biến dùng chung cho cả hàm
                    //---------Arr__XXX
                    //---------Is__XXX
                    //---------Int__XXX
                    //---------Str__XXX



                    //------------------- Khái báo biển chính của giao diện
                    var Obj__Filter_Dtl = {}
                    var Obj__Filter = {}

                    // var Obj_FormInput = {}
                    var Arr__ListTbl = []

                    var Obj__FN_Main = {}
                    //-------------------


                    GetPopUp()

                    function GetPopUp() {
                        pngPn.getPopUp({
                            strTitle: 'Xem hình ảnh'
                            , intTypeSize: 2//------------1 small ---2 medium ---3 large
                            , OnPanel: GetMainPanel
                            , OnClosePopUp: function () {
                                //------Chọn sự kiện khi Đóng PopUP
                            }
                        })
                    }

                    function GetMainPanel(_IdOrClassPp, _OnClosePp) {

                        IdOrClass__Main = _IdOrClassPp
                        Obj__FN_Main.OnClosePp = _OnClosePp

                        // Obj__FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                        // Obj__FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}


                        var objPanel = {
                            pnMain: {
                                tag: 'div', attr: 'class=""'
                                , childTags: [{ div: 'class="row"' }]
                                , pnContent: { tag: 'div', attr: 'class="col-md-12"' }
                                // ,pnBtn:{tag:'div',attr:'class="col-md-12"'}
                            }
                        }
                        var objEvtPanel = {}
                        objEvtPanel.pnContent = function (_idOrClassPn) {
                            var IdOrClass_Pn = _idOrClassPn


                            var strHtml = ''
                            strHtml += '        <div style="background-color: white;position: relative;text-align:center">'
                            strHtml += '         <span style="cursor:pointer;padding: 5px;background: #ffffffb5;position:absolute;left:0;top:50%;font-size: 24px; margin-top: -20px;" class="prev"><i class="fa fa-chevron-left"></i></span>'
                            // strHtml+= '         <div style="background:url(\'\') no-repeat center;background-size: cover  ;height:100%" class="pnImage"></div>'
                            strHtml += '         <img src="" alt="" border="0" width="auto" style="max-height: 70vh;max-width: 100%;" class="pnImage">'
                            strHtml += '         <span style="cursor:pointer;padding: 5px;background: #ffffffb5;position:absolute;right: 0;top:50%;font-size: 24px; margin-top: -20px;" class="next"><i class="fa fa-chevron-right"></i></span>'
                            strHtml += '        </div>'
                            strHtml += '        <div class="pnGallery" style="background-color: white;overflow: auto;"></div>'

                            $(IdOrClass_Pn).html(strHtml)

                            var strHtml = ''
                            strHtml += '<div style="height:100px;background-color: white;display:inline-flex">'


                            Arr_ImageFile.forEach(function (value, key) {
                                var strUrl = (value.strSupplierImageFileLink ? png.getServerImgURL(value.strSupplierImageFileLink) : 'assets/images/img-noimage.png')
                                strHtml += '<div class="item" style=" height: 100%;width: 150px;cursor:pointer" intKey="' + key + '" data="' + strUrl + '">'
                                // strHtml+='<div class="item" style="background:url(\''+ strUrl+'\') no-repeat center;background-size: cover;height: 100%;width: 150px;cursor:pointer" intKey="'+key+'" data="'+strUrl+'">'
                                strHtml += '<img src="' + strUrl + '" style="height:100px;width:100%">'
                                strHtml += '</div>'
                            })
                            strHtml += '</div>'
                            $('.pnGallery', IdOrClass_Pn).html(strHtml)


                            $('.pnGallery .item', IdOrClass_Pn).css('opacity', '0.5')
                            var intKey = _Opt.intKey
                            var FN_TimeUOut = null
                            GetViewImage(intKey)
                            // GetNextImage()


                            $('.pnGallery .item', IdOrClass_Pn).click(function () {

                                var data = $(this).attr('data')

                                intKey = $(this).attr('intKey').getNumber()
                                GetViewImage(intKey)
                                // GetNextImage()
                            })

                            $(IdOrClass_Pn + ' .prev').click(function () {
                                if (intKey != 0) {
                                    intKey -= 1
                                } else {
                                    intKey = Arr_ImageFile.length - 1
                                }
                                GetViewImage(intKey)
                                // GetNextImage()
                            })
                            $(IdOrClass_Pn + ' .next').click(function () {
                                if (intKey != Arr_ImageFile.length - 1) {
                                    intKey += 1
                                } else {
                                    intKey = 0
                                }

                                GetViewImage(intKey)
                                // GetNextImage()
                            })

                            function GetNextImage() {
                                clearTimeout(FN_TimeUOut)
                                FN_TimeUOut = setInterval(function () {
                                    if (intKey != Arr_ImageFile.length - 1) {
                                        intKey += 1
                                    } else {
                                        intKey = 0
                                    }

                                    GetViewImage(intKey)

                                }, 10000);
                            }

                            function GetViewImage(_intKey) {
                                var intKey = _intKey
                                var strUrl = (Arr_ImageFile[intKey].strSupplierImageFileLink ? png.getServerImgURL(Arr_ImageFile[intKey].strSupplierImageFileLink) : coreSystem.getLib_CommonURL('assets/images/img-noimage.png'))
                                // $(IdOrClass_Pn + ' .pnImage').attr('style', 'background:url(\'' + strUrl + '\') no-repeat center;background-size: cover  ;height:100%')
                                $(IdOrClass_Pn + ' .pnImage').attr('src', strUrl)


                                $('.pnGallery .item', IdOrClass_Pn).css('opacity', '0.5')
                                $('.pnGallery .item[intKey=' + intKey + ']', IdOrClass_Pn).css('opacity', '1')

                                var col = $('.pnGallery .item[intKey=' + intKey + ']', IdOrClass_Pn)[0];
                                var div = $('.pnGallery', IdOrClass_Pn)[0];
                                if (col != null && div != null) {
                                    div.scrollLeft = col.offsetLeft - $('.pnGallery', IdOrClass_Pn).width() / 2;;
                                }
                            }


                        }
                        // ===================================

                        pngPn.getPanelHtml({            // Get ra panel dạng html
                            objPanel: objPanel
                            , objEvtPanel: objEvtPanel
                            , idOrClass: IdOrClass__Main  // Id or class chính
                            , OnChangeIdPn: function (_Fn) {
                                Obj__FN_Main.pnMain = _Fn    // Hàm đổi trang
                            }
                        })



                    }
                }


                function GetPopUp_ViewItemType(_Opt) {
                    var Dft = {
                        objDetail: {},
                        strHtml_RoomType: null,
                        OnSuccess: function () {

                        }
                    }
                    _Opt = $.extend(Dft, _Opt);

                    var IdOrClass__Main = ''

                    var Obj_Detail = _Opt.objDetail
                    var Arr_ImageFile_ItemType = Arr_ImageFile.filter(function (item) { return (item.strItemTypeGUID || '').toUpperCase() == Obj_Detail.strItemTypeGUID.toUpperCase() })

                    console.log(Obj_Detail)
                    //---------Obj__XXX      // Khai báo các biến dùng chung cho cả hàm
                    //---------Arr__XXX
                    //---------Is__XXX
                    //---------Int__XXX
                    //---------Str__XXX



                    //------------------- Khái báo biển chính của giao diện
                    var Obj__Filter_Dtl = {}
                    var Obj__Filter = {}

                    // var Obj_FormInput = {}
                    var Arr__ListTbl = []

                    var Obj__FN_Main = {}
                    //-------------------


                    GetPopUp()

                    function GetPopUp() {
                        pngPn.getPopUp({
                            strTitle: pngElm.getLangKey({ langkey: 'sys_Txt_ViewDetail' })
                            , intTypeSize: 2//------------1 small ---2 medium ---3 large
                            , OnPanel: GetMainPanel
                            , OnClosePopUp: function () {
                                //------Chọn sự kiện khi Đóng PopUP
                            }
                        })
                    }

                    function GetMainPanel(_IdOrClassPp, _OnClosePp) {

                        IdOrClass__Main = _IdOrClassPp
                        Obj__FN_Main.OnClosePp = _OnClosePp

                        // Obj__FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                        // Obj__FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}


                        var objPanel = {
                            pnMain: {
                                tag: 'div', attr: 'class=""'
                                , childTags: [{ div: 'class="row"' }]
                                , pnDetail: { tag: 'div', attr: 'class="col-md-4"' }
                                , pnContent: { tag: 'div', attr: 'class="col-md-8"' }
                                // ,pnBtn:{tag:'div',attr:'class="col-md-12"'}
                            }
                        }

                        if ($(window).width() < 1024) {
                            objPanel = {
                                pnMain: {
                                    tag: 'div', attr: 'class=""'
                                    , childTags: [{ div: 'class="row"' }]
                                    , pnContent: { tag: 'div', attr: 'class="col-md-8"' }
                                    , pnDetail: { tag: 'div', attr: 'class="col-md-4"' }
                                    // ,pnBtn:{tag:'div',attr:'class="col-md-12"'}
                                }
                            }
                        }

                        var objEvtPanel = {}

                        objEvtPanel.pnDetail = function (_idOrClassPn) {
                            var IdOrClass_Pn = _idOrClassPn

                            var strHtml = ''

                            // strHtml+=  '<div><b>'+pngElm.getLangKey({langkey:'sys_Txt_RoomName'})+'</b></div>'
                            strHtml += '<div class="pn-margin-b-15"><b>' + Obj_Detail['strItemTypeName'] + '</b> (' + Obj_Detail['strMealIncludedTypeName'] + ')</div>'

                            if (Obj_Detail.strRemark) {
                                // strHtml+= '<div><b>'+pngElm.getLangKey({langkey:'sys_Txt_Remark'})+'</b></div>'
                                strHtml += '<div class="pn-margin-b-15">' + Obj_Detail.strRemark + '</div>'
                            }

                            if (_Opt.strHtml_RoomType) {
                                strHtml += '<h3 class="pn-margin-t-b-15">Chi tiết phòng</h3>'
                                strHtml += _Opt.strHtml_RoomType
                            }

                            $(IdOrClass_Pn).html(strHtml)

                        }
                        objEvtPanel.pnContent = function (_idOrClassPn) {
                            var IdOrClass_Pn = _idOrClassPn


                            var strHtml = ''
                            strHtml += '        <div style="background-color: white;position: relative;text-align:center">'
                            strHtml += '         <span style="cursor:pointer;padding: 5px;background: #ffffffb5;position:absolute;left:0;top:50%;font-size: 24px; margin-top: -20px;" class="prev"><i class="fa fa-chevron-left"></i></span>'
                            // strHtml+= '         <div style="background:url(\'\') no-repeat center;background-size: cover  ;height:100%" class="pnImage"></div>'
                            strHtml += '         <img src="" alt="" border="0" width="auto" style="max-height: 70vh;max-width: 100%;" class="pnImage">'
                            strHtml += '         <span style="cursor:pointer;padding: 5px;background: #ffffffb5;position:absolute;right: 0;top:50%;font-size: 24px; margin-top: -20px;" class="next"><i class="fa fa-chevron-right"></i></span>'
                            strHtml += '        </div>'
                            strHtml += '        <div class="pnGallery pn-margin-b-30" style="background-color: white;overflow: auto;"></div>'
                            $(IdOrClass_Pn).html(strHtml)

                            var strHtml = ''
                            strHtml += '<div style="height:100px;background-color: white;display:inline-flex">'

                            if (Arr_ImageFile_ItemType.length) {
                                Arr_ImageFile_ItemType.forEach(function (value, key) {
                                    var strUrl = (value.strSupplierImageFileLink ? png.getServerImgURL(value.strSupplierImageFileLink) : coreSystem.getLib_CommonURL('assets/images/img-noimage.png'))
                                    // strHtml+='<div class="item" style="background:url(\''+ strUrl+'\') no-repeat center;background-size: cover;height: 100%;width: 150px;cursor:pointer" intKey="'+key+'" data="'+strUrl+'">'
                                    // strHtml+='</div>'
                                    strHtml += '<div class="item" style=" height: 100%;width: 150px;cursor:pointer" intKey="' + key + '" data="' + strUrl + '">'
                                    // strHtml+='<div class="item" style="background:url(\''+ strUrl+'\') no-repeat center;background-size: cover;height: 100%;width: 150px;cursor:pointer" intKey="'+key+'" data="'+strUrl+'">'
                                    strHtml += '<img src="' + strUrl + '" style="height:100px;width:100%">'
                                    strHtml += '</div>'
                                })
                                strHtml += '</div>'
                                $('.pnGallery', IdOrClass_Pn).html(strHtml)


                                $('.pnGallery .item', IdOrClass_Pn).css('opacity', '0.5')
                                var intKey = 0
                                var FN_TimeUOut = null
                                GetViewImage(intKey)
                                // GetNextImage()
                            }
                            else {
                                $(IdOrClass_Pn).html('<img src="' + coreSystem.getLib_CommonURL('assets/images/img-noimage.png') + '" alt="" border="0" width="auto" style="max-height: 70vh;max-width: 100%;" class="pnImage">')
                            }


                            $('.pnGallery .item', IdOrClass_Pn).click(function () {

                                var data = $(this).attr('data')

                                intKey = $(this).attr('intKey').getNumber()
                                GetViewImage(intKey)
                                // GetNextImage()
                            })

                            $(IdOrClass_Pn + ' .prev').click(function () {
                                if (intKey != 0) {
                                    intKey -= 1
                                } else {
                                    intKey = Arr_ImageFile_ItemType.length - 1
                                }
                                GetViewImage(intKey)
                                // GetNextImage()
                            })
                            $(IdOrClass_Pn + ' .next').click(function () {
                                if (intKey != Arr_ImageFile_ItemType.length - 1) {
                                    intKey += 1
                                } else {
                                    intKey = 0
                                }

                                GetViewImage(intKey)
                                // GetNextImage()
                            })


                            function GetViewImage(_intKey) {
                                var intKey = _intKey
                                var strUrl = (Arr_ImageFile_ItemType[intKey].strSupplierImageFileLink ? png.getServerImgURL(Arr_ImageFile_ItemType[intKey].strSupplierImageFileLink) : coreSystem.getLib_CommonURL('assets/images/img-noimage.png'))
                                // $(IdOrClass_Pn + ' .pnImage').attr('style', 'background:url(\'' + strUrl + '\') no-repeat center;background-size: cover  ;height:100%')
                                $(IdOrClass_Pn + ' .pnImage').attr('src', strUrl)


                                $('.pnGallery .item', IdOrClass_Pn).css('opacity', '0.5')
                                $('.pnGallery .item[intKey=' + intKey + ']', IdOrClass_Pn).css('opacity', '1')

                                var col = $('.pnGallery .item[intKey=' + intKey + ']', IdOrClass_Pn)[0];
                                var div = $('.pnGallery', IdOrClass_Pn)[0];
                                if (col != null && div != null) {
                                    div.scrollLeft = col.offsetLeft - $('.pnGallery', IdOrClass_Pn).width() / 2;
                                }
                            }


                        }
                        // ===================================

                        pngPn.getPanelHtml({            // Get ra panel dạng html
                            objPanel: objPanel
                            , objEvtPanel: objEvtPanel
                            , idOrClass: IdOrClass__Main  // Id or class chính
                            , OnChangeIdPn: function (_Fn) {
                                Obj__FN_Main.pnMain = _Fn    // Hàm đổi trang
                            }
                        })



                    }
                }


                function GetPopUp_SelectRoom(_Opt){
                    var Dft = {
                        Str_CompanyOwnerGUID:'',
                        Arr_PriceRoom: null,
                        Arr_ListDate: null,
                        Arr_ListBook: null,
                        Arr_ListFoc: null,
                        objAgentHostDtl: {},
                        Obj_SearchDtl:{},
                        objDetail: {},
                        intChildOptionID:null,
                        intType: null,
                        OnSuccess: function () {

                        }
                    }
                    _Opt = $.extend(Dft, _Opt);

                    var IdOrClass__Main = ''

                    var Obj_Detail = _Opt.objDetail

                    var Obj_Rtn = JSON.parse(JSON.stringify(Obj_Detail))

                    var Str_CompanyOwnerGUID = _Opt.Str_CompanyOwnerGUID
                    var Obj_SearchDtl = _Opt.Obj_SearchDtl

                    var Obj_AgentHostDtl = _Opt.objAgentHostDtl

                    var Arr_PriceRoom =  JSON.parse(JSON.stringify(_Opt.Arr_PriceRoom))
                    var Arr_ListDate =  _Opt.Arr_ListDate
                    var Arr_ListFoc =  _Opt.Arr_ListFoc
                    var Arr_ListBook =   JSON.parse(JSON.stringify(_Opt.Arr_ListBook))
                    Arr_ListBook.push(Obj_Rtn)


                    var IsBookNotMinstay = null

                    // var Arr_ImageFile_ItemType = Arr_ImageFile.filter(function(item){ return (item.strItemTypeGUID || '').toUpperCase() == Obj_Detail.strItemTypeGUID.toUpperCase() })

                    //---------Obj_XXX      // Khai báo các biến dùng chung cho cả hàm
                    //---------Arr__XXX
                    //---------Is__XXX
                    //---------Int__XXX
                    //---------Str__XXX


                    var Arr_ListChild = []
                    var Arr_ListChildAge = []

                    var Arr_Surcharge = []
                    var ArrSurchargePrice = []

                    var Arr_ListFOCUse = []

                    var objInput = {}


                    var Arr_OrderPaymentTerm = []
                    var Arr_PaymentMethodID = []
                    var Obj_Payment = {}

                    var Arr_Salute_Ddl = []
                    var Arr_Country_Ddl = []
                    var Arr_Age_Ddl = []
                    //------------------- Khái báo biển chính của giao diện
                    var Obj_Filter_Dtl = {}
                    var Obj_Filter = {}

                    // var Obj_FormInput = {}
                    var Arr_ListTbl = []

                    var Obj_FN_Main = {}
                    //-------------------


                    png.postListApiGetValue({
                        objList_Api: ObjList_Api
                        ,objList_ComboValue: ObjList_ComboValue
                        ,objListApi_RtnVal: {
                            'GetListLinkSupplierChildAge':{
                                objParams_Cus:{
                                    strItemTypeGUID: Obj_Detail.strItemTypeGUID
                                }
                                , OnSuccess: function(data){
                                    Arr_ListChild = JSON.parse(data)[0]

                                    Arr_ListChildAge = Obj_SearchDtl.arrChildren.filter(function(item){ return (Arr_ListChild.filter(function(item2){ return item >= item2.dblAgeFrom && item <= item2.dblAgeTo }).length)  })


                                }
                            },

                            'GetListSupplierPaymentTerm':{
                                objParams_Cus:{
                                    strCompanyGUID: Obj_AgentHostDtl.strCompanyOwnerGUID
                                }
                                , OnSuccess: function(data){
                                    Arr_OrderPaymentTerm = JSON.parse(data)[0]
                                }
                            },
                            'GetListSurchargeDateForAgent':{
                                objParams_Cus:{
                                    dtmFilterDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                    ,dtmFilterDateTo: Obj_SearchDtl.dtmDateCheckOut
                                    ,strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                    ,tblsReturn:'[0][1]'
                                }
                                ,OnSuccess: function(data){
                                    Arr_Surcharge = JSON.parse(data)[0]
                                    ArrSurchargePrice = JSON.parse(data)[1]

                                    Arr_Surcharge.forEach(function(value,key){
                                        if(value.intPerPaxID == 1){
                                            value.intQuantity = Obj_SearchDtl.intNoAdult// + Obj_SearchDtl.arrChildren.length
                                        }else if(value.intPerPaxID == 2){
                                            value.intQuantity = 1
                                        }
                                        //var arr = ArrSurchargePrice.filter(function(item){ return item.strSurchargeDateGUID.toUpperCase() == value.strSurchargeDateGUID.toUpperCase() && item.intPaxFrom <=value.intQuantity  && item.intPaxTo >= value.intQuantity })

                                        //value.dblUnitPrice = arr[0].dblPrice
                                    })

                                }
                            },

                        }
                        ,objListComboValue_RtnVal: {
                            'Arr_SQL':{
                                objParams_Cus:{
                                    strTableName:'OB12'
                                    ,strFeildSelect:'OB12_PaymentMethodID AS intID,OB12_PaymentMethodName AS strName'
                                    ,strWhere:'WHERE IsActive=1 AND OB12_PaymentMethodID = 1 ORDER BY OB12_Order'
                                },
                                OnSuccess: function(data){
                                    Arr_PaymentMethodID = data   // Dữ liệu trả về từ dropdownlist trên
                                }
                            },

                            'arrCountry':{
                                objParams_Cus:{}, OnSuccess: function(data){
                                    Arr_Country_Ddl = $.pngGetArrComboValue(data,'intID','strName')
                                }
                            }
                            ,'arrSalute':{
                                objParams_Cus:{}, OnSuccess: function(data){
                                    Arr_Salute_Ddl = $.pngGetArrComboValue(data,'intID','strName')
                                }
                            }
                            ,'arrAge':{
                                objParams_Cus:{}, OnSuccess: function(data){
                                    Arr_Age_Ddl = $.pngGetArrComboValue(data,'intID','strName')
                                }
                            }
                        }
                        ,OnSuccessList:function(data){


                            GetArr_ListFOC({
                                Arr_ListBook: Arr_ListBook,
                                Arr_ListFoc: Arr_ListFoc,
                                Obj_SearchDtl: Obj_SearchDtl,
                                Is_BookNotMinstay: IsBookNotMinstay,
                                OnSuccess: function (_arr) {
                                    Arr_ListFOCUse = _arr
                                }
                            })

                            var IsAdd = true
                            if(_Opt.intType !=2){
                                IsAdd = false
                            }
                            if(Obj_SearchDtl.arrChildren && Obj_SearchDtl.arrChildren.length){
                                IsAdd = false
                            }
                            if(Arr_ListFOCUse && Arr_ListFOCUse.length){
                                IsAdd = false
                            }
                            if(Arr_Surcharge && Arr_Surcharge.length){
                                IsAdd = false
                            }

                            if(IsAdd){

                                var strListItemTypeGUID = ''

                                strListItemTypeGUID+=Obj_Detail.strItemTypeGUID+'!'+Obj_Detail.intSglDblID+'!'+Obj_Detail.intQuantity+'!'+Obj_Detail.intMealIncludedTypeID+'!'+Obj_Detail.strItemTypeDetailGUID+'!'+(_Opt.intChildOptionID || 0)+'#'


                                png.postListApiGetValue({
                                    objList_Api: ObjList_Api
                                    //,objList_ComboValue: ObjList_ComboValue
                                    ,objListApi_RtnVal: {
                                        'AddPassengerOrderForSupByHotelByPUB':{
                                            objParams_Cus: {
                                                strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                                ,strPriceLevelGUID: Str_PriceLevelGUID
                                                ,strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                                ,strListItemTypeGUID: strListItemTypeGUID
                                                ,strListSupplierChildAgeGUID: ''
                                                ,strListSurchargeDateGUID: ''
                                                // ,strListFocGUID: strListFocGUID
                                                ,IsBookNotMinstay: IsBookNotMinstay
                                                ,intAdult: Obj_SearchDtl.intNoAdult
                                                ,strListChildAge: ''
                                                ,dtmDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                                ,dtmDateTo : Obj_SearchDtl.dtmDateCheckOut
                                            }
                                            ,OnSuccess: function(data){

                                                GetLinkBooking()

                                                function GetLinkBooking(){

                                                    var strUrl = coreLoadPage.getUrlHost()
                                                    strUrl = $.pngGetQSVal('cname', $.pngGetQSVal('cname'),strUrl)
                                                    strUrl = $.pngGetQSVal('page', 'listorderbooking', strUrl)
                                                    // strUrl = $.pngGetQSVal('GUID', ArrAllList[0][0]['strOrderBookingGUID'], strUrl)

                                                    window.location.href = strUrl

                                                }
                                            }
                                        }
                                    }
                                })

                            }else{
                                GetPopUp()
                            }
                        }
                    })

                    // GetPopUp()

                    function GetPopUp(){

                        // var arr =  Arr_PriceRoom.map(item => item.strSupplierChildAgeGUID)
                        //                 .filter((value, index, self) => self.indexOf(value) === index)
                        //                 .filter(function(item){ return item })

                        // arr.forEach(function(value) {

                        //     var obj = Arr_PriceRoom.filter(function(item) { return (item.strSupplierChildAgeGUID || '').toUpperCase() == value.toUpperCase() })[0]

                        //     Arr_ListChild.push(obj)

                        // });

                        var strTitle = ''
                        if(_Opt.intType == 1){
                            strTitle = 'Yêu cầu book đặt'
                        }
                        if(_Opt.intType == 2){
                            strTitle = 'Thêm vào giỏ hàng'
                        }

                        if(_Opt.intType == 3){
                            strTitle = 'Book đặt dịch vụ'
                        }


                        pngPn.getPopUp({
                            strTitle: strTitle
                            , intTypeSize:2//------------1 small ---2 medium ---3 large
                            , OnPanel: GetMainPanel
                            , OnClosePopUp: function () {
                                //------Chọn sự kiện khi Đóng PopUP
                            }
                        })
                    }

                    function GetMainPanel(_IdOrClassPp,_OnClosePp){

                        IdOrClass__Main = _IdOrClassPp
                        Obj_FN_Main.OnClosePp = _OnClosePp

                        // Obj_FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                        // Obj_FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}


                        var objPanel = {
                            pnMain:{tag:'div',attr:'class=""'
                                    ,childTags:[{div:'class="row"'}]
                                // ,pnDetail:{tag:'div',attr:'class="col-md-4"'}
                                ,pnContent:{tag:'div',attr:'class="col-md-12"'}
                                ,pnService:{tag:'div',attr:'class="col-md-12" style="" ',childTags:[{div:'class="row"'}]
                                    ,pnListChildAge:{tag:'div',attr:'class="col-md-12"'}
                                    ,pnListSurcharge:{tag:'div',attr:'class="col-md-12"'}
                                }
                                ,pnListFOC:{tag:'div',attr:'class="col-md-12"'}
                                ,pnBtn:{tag:'div',attr:'class="col-md-12 pn-margin-t-15"'}
                            }
                        }
                        var objEvtPanel = {}

                        // objEvtPanel.pnDetail = function(_idOrClassPn){
                        //     var IdOrClass_Pn = _idOrClassPn

                        //     var strHtml = ''

                        //     strHtml+=  '<div><b>'+pngElm.getLangKey({langkey:'sys_Txt_RoomName'})+'</b></div>'
                        //     strHtml+=  '<div class="pn-margin-b-15">'+Obj_Detail['strItemTypeName']+'('+Obj_Detail['strMealIncludedTypeName']+')</div>'

                        //     if(Obj_Detail.strRemark){
                        //         strHtml+= '<div><b>'+pngElm.getLangKey({langkey:'sys_Txt_Remark'})+'</b></div>'
                        //         strHtml+= '<div class="pn-margin-b-15">'+Obj_Detail.strRemark+'</div>'
                        //     }

                        //     $(IdOrClass_Pn).html(strHtml)

                        // }
                        objEvtPanel.pnContent = function(_idOrClassPn){
                            var IdOrClass_Pn = _idOrClassPn


                            var strHtml = `
                            <div class="pn-padding-b-15">
                                <b>Tổng số Pax:</b> ${Obj_SearchDtl.intNoAdult+Obj_SearchDtl.arrChildren.length} (<b><i class="fa fa-male"></i></b> ${Obj_SearchDtl.intNoAdult} - <b style="font-size:12px"><i class="fa fa-child"></i></b> ${Obj_SearchDtl.arrChildren.length})
                            </div>
                            <div class="pn-padding-15" style="border: 1px solid #ccc; border-radius: 1em; padding: 15px; margin-bottom: 15px;">
                                <h4 class="pn-margin-b-15"><i class="fa fa-briefcase"></i> ${Obj_AgentHostDtl.strCompanyName}</h4>
                                <div class="pn-padding-b-15">
                                    <b>Số lượng người lớn:</b> ${(Obj_SearchDtl.intNoAdult + (Obj_SearchDtl.arrChildren.length - Arr_ListChildAge.length) )}
                                </div>
                                <div class="pnTable_Ser"></div>
                                <div class="row">
                                    <div class="col-md-12">
                                        `
                                        // strHtml+=`
                                        // <p style="display: flex;align-items: center;justify-content: space-between;">
                                        //     <b>Số tiền dịch vụ còn lại:</b>
                                        //     <span class="txtRemain"></span>
                                        // </p>
                                        // `
                                        strHtml+=`
                                    </div>
                                </div>

                                <div class="pnListChildAge"></div>
                                <div class="pnListSurcharge"></div>
                                <div class="pnListFOC"></div>
                                <div class="pnPayment"></div>

                                <div class="pnForm pn-margin-t-15"></div>
                            </div>
                            <div class="pnFormCustomer"></div>
                            `
                            $(IdOrClass_Pn).html(strHtml)

                            // var strHtml = ''
                            // strHtml+='<div class="row">'
                            //     strHtml+='<div class="col-md-6">'
                            //         strHtml+='<div >'
                            //             strHtml+='<h3 class=" pn-margin-b-15"><b>Thông tin</b> </h3>'
                            //         strHtml+='</div>'
                            //         strHtml+='<p><b>Check In - Check Out: </b> '+$.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckIn)+' - '+$.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckOut)+'</p>'
                            //         strHtml+='<p><b>Tên phòng: </b>'+Obj_Detail.strItemTypeName+' - '+Obj_Detail.strSglDblName+' ('+Obj_Detail.intQuantity+' x '+$.pngFormatPrice(Obj_Detail.dblUnitPrice)+')</p>'
                            //     strHtml+='</div>'
                            //     strHtml+='<div class="col-md-6">'
                            //         strHtml+='<div id="pnTotal" style="float: right"></div>'
                            //     strHtml+='</div>'
                            // strHtml+='</div>'
                            // $(IdOrClass_Pn).html(strHtml)


                            pngPn.getTable2({
                                objApi:null
                                ,objParams_Cus:null

                                ,editRltArr: function(_arr,_arrAll){

                                    var arr = []
                                    arr.push(Obj_Detail)

                                    return arr
                                }
                                ,editRlt: function(value,key){
                                    value['No'] = (key+1)
                                    value['strServiceName'] = Obj_Detail.strItemTypeName+'('+Obj_Detail.strMealIncludedTypeName+')'+' - '+Obj_Detail.strSglDblName
                                    value['strDtmDateStart'] = $.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckIn)+' - '+$.pngFormatDateTime(Obj_SearchDtl.dtmDateCheckOut)
                                    // if(options.dblTotalPrice == null)
                                    //     value['dblPriceTotal_View'] = 'N/A'
                                    // else

                                    value['dblPriceTotal_View'] = $.pngFormatPrice(value.dblTotalPrice)
                                    value['dblTotalCommission_View'] = $.pngFormatPrice(value.dblTotalComPrice)

                                }
                                ,objCols: {

                                    No: { name: '<span langkey="sys_Txt_No"></span>' },
                                    strServiceName: { name: 'Service name' },
                                    strDtmDateStart:{name:'Date'},
                                    intQuantity: { name: 'Quantity' },
                                    // intTotalPax:{name:'Total Pax',strAttrTD:' style="text-align:right"'},
                                    dblPriceTotal_View:{name:'Total price',strAttrTD:' style="text-align:right"'},
                                }
                                // ,editTableInput:function(){}
                                , changeCkbMaster: function (IsChecked, intRowID,arrList) {


                                    // arr = arrList
                                }
                                ,customEvent: function(_idOrClass_Pn){

                                }
                                // ,changeInput:function(){}
                                ,IsViewCheckBoxMain:false
                                ,idOrClass: IdOrClass_Pn+' .pnTable_Ser'
                            })


                            GetPanel_pnListChildAge(IdOrClass_Pn+' .pnListChildAge')
                            GetPanel_pnListSurcharge(IdOrClass_Pn+' .pnListSurcharge')
                            GetPanel_pnListFOC(IdOrClass_Pn+' .pnListFOC')


                            if(_Opt.intType == 1){
                                objInput = {
                                    strBookingRequestDescription:{title:'Yêu cầu book đặt',isRequire:false,attr:"class='col-md-12'",IsRtn:true
                                        ,input:{type:'textarea',classEx:'form-control',attr:'rows="5"'}
                                    }
                                }
                                pngPn.getForm({
                                    action: 1,
                                    objInput: objInput,
                                    idOrClass: IdOrClass_Pn+' .pnForm',
                                    objDetail: {}
                                })
                            }
                            if(_Opt.intType == 3){

                                var strHtml = ''
                                strHtml+=`
                                <h3 class="pn-margin-b-15">Thanh toán</h3>
                                <p style="display: flex;align-items: center;justify-content: space-between;">
                                    <span>
                                        <input type="checkbox" class="IsUseCommission chkCustom-1" style="float: left;margin-right: 5px;margin-top: 2px;"> <b>Sử dụng tiền hoa hồng</b> (${$.pngFormatPrice(Obj_Detail.dblSumPayableBalance)})
                                    </span>
                                    <span class="txtComPricePay"></span>
                                </p>
                                `
                                strHtml+=`
                                <p style="display: flex;align-items: center;justify-content: space-between;">
                                    <b>Số tiền dịch vụ còn lại:(<a class="intPaymentMethod"></a>)<span class="pnPayNot"></span></b>
                                    <span class="dblSumRemain"></span>
                                </p>
                                <div>
                                    <label>Lời nhắn riêng</label>
                                    <input type="text" class="strRemark form-control" autocomplete="off">
                                </div>
                                `
                                $(IdOrClass_Pn + ' .pnPayment').html(strHtml)

                                $('.pnPayNot',IdOrClass_Pn).html('<div style="font-size: 12px;color: red;">Bạn sẽ thanh toán trước '+$.pngFormatDateTime(moment().add(1,'days').format('l'))+' 23:59:59 để hoàn thành quá trình book đặt</div>')

                                Obj_Detail = $.pngExtendObj(Obj_Detail,{strRemark:''})

                                $(IdOrClass_Pn + ' .pnPayment .strRemark').change(function(){
                                    Obj_Detail.strRemark = this.value
                                })

                                var ArrListAccount = []


                                Obj_Detail.intPaymentMethodID = Arr_PaymentMethodID[0].intID

                                png.postListApiGetValue({
                                    objList_Api: ObjList_Api
                                    ,objListApi_RtnVal: {
                                        'GetFilterCompanyBankAccount':{
                                            objParams_Cus:{
                                                strCompanyGUID: Obj_AgentHostDtl.strCompanyOwnerGUID
                                            }
                                            , OnSuccess: function(data){
                                                ArrListAccount = JSON.parse(data)[0]
                                                Obj_Detail.strCompanyBankAccountGUID = ArrListAccount[0].strCompanyBankAccountGUID
                                                GetPanelAccount()
                                            }
                                        }
                                    }
                                })


                                $('.intPaymentMethod',IdOrClass_Pn).click(function(){
                                    GetPopUp_PayMethod({
                                        objDetail:{
                                            intPaymentMethodID: Obj_Detail.intPaymentMethodID,
                                            strCompanyBankAccountGUID: Obj_Detail.strCompanyBankAccountGUID,
                                        },
                                        ArrListAccount: ArrListAccount,
                                        OnSuccess: function(_objRtn){
                                            Obj_Detail = $.pngExtendObj(Obj_Detail,_objRtn)
                                            GetPanelAccount()
                                        }
                                    })
                                })


                                function GetPanelAccount(){
                                    var strHtml = ''

                                    var obj = Arr_PaymentMethodID.filter(function(item){ return item.intID == Obj_Detail.intPaymentMethodID })[0]
                                    var obj_2 = ArrListAccount.filter(function(item){ return item.strCompanyBankAccountGUID.toUpperCase() == Obj_Detail.strCompanyBankAccountGUID.toUpperCase() })[0]
                                    strHtml+=obj.strName+'-'+obj_2.strNameDisplay
                                    $('.intPaymentMethod',IdOrClass_Pn).html(strHtml)
                                }



                                objInput =  {
                                    intSaluteID:{title:'<span langkey="pg_Dft_TC_OrDtl_Salute"></span>',isRequire:true,attr:"class='col-md-3'",IsRtn:true
                                        ,input:{type:'select',classEx:'form-control',attr:''}
                                        ,dropDown:{arrList:Arr_Salute_Ddl}
                                    }
                                    ,strPassengerFirstName: {title: pngElm.getLangKey({langkey:'sys_Txt_FirstName'}),isRequire:true,attr:"class='col-md-3'",IsRtn:true
                                        ,input:{type:'text',classEx:'form-control',attr:''}
                                    }
                                    ,strPassengerLastName: {title: pngElm.getLangKey({langkey:'sys_Txt_LastName'}),isRequire:true,attr:"class='col-md-3'",IsRtn:true
                                        ,input:{type:'text',classEx:'form-control',attr:''}
                                    }
                                    ,strCountryGUID:{title:'<span langkey="pg_Dft_TC_OrDtl_Country"></span>',isRequire:true,attr:"class='col-md-3'",IsRtn:true
                                            ,input:{type:'text',classEx:'require',attr:' style="width:100%" placeholder="'+pngElm.getLangKey({langkey:'sys_Txt_DdlSelectVal-Country'})+'"'}
                                            ,dropDown:{Select2:{IsMultiple:false}, arrList:Arr_Country_Ddl}
                                    }
                                    ,intAgeID:{title:'<span langkey="pg_Dft_TC_OrDtl_Age"></span>',isRequire:true,attr:"class='col-md-3'",IsRtn:true
                                            ,input:{type:'select',classEx:'form-control',attr:''}
                                            ,dropDown:{arrList: Arr_Age_Ddl}
                                    }
                                    ,dtmPassengerBirthday: {title:'<span langkey="pg_Dft_TC_OrDtl_DateOfBirth"></span>',isRequire:false,attr:"class='col-md-3'",IsRtn:true
                                            ,input:{type:'text',classEx:'form-control',attr:''}
                                            ,datePicker:{todayHighlight: true,format: 'dd/mm/yyyy',startDate: null, endDate: moment().add('years', -18).format('DD/MM/YYYY')}
                                    }
                                    ,strPassengerEmail:{title:'Email',isRequire:false,attr:"class='col-md-3'",IsRtn:true
                                            ,input:{type:'text',classEx:'form-control',attr:''}
                                            ,validate:{format:/^([\w-\.]+@@([\w-]+\.)+[\w-]{2,4})?$/}
                                    }
                                    ,strPassengerPhone: {title: pngElm.getLangKey({langkey:'sys_Txt_PhoneNumber'}),isRequire:false,attr:"class='col-md-3'",IsRtn:true
                                            ,input:{type:'text',classEx:'form-control',attr:''}
                                            ,validate:{format: /^([+]\d{2})?\d{9,15}$/}
                                    }
                                    ,strPassengerRemark: {title:'<span langkey="pg_Dft_TC_OrDtl_Remark"></span>',isRequire:false,attr:"class='col-md-12'",IsRtn:true
                                            ,input:{type:'textarea',classEx:'form-control',attr:'rows="3" cols="30"'}
                                    }
                                }

                                var strHtml = ''
                                strHtml+='<div class="pn-padding-15" style="border: 1px solid #ccc; border-radius: 1em; padding: 15px; margin-bottom: 15px;">'
                                    strHtml+='<div class="pnCus" data="0" style="">'
                                        strHtml+='<h3 style="margin: 0 0 20px; display:inline-block;">Liên lạc chính</h3>'
                                        strHtml+='<div style="display: inline-flex; margin-left: 15px;">'
                                        strHtml+='<input id="chkIsTraveller" type="checkbox" class="chkCustom-1"> <span style="padding: 4px;">Là khách du lịch</span>'
                                        strHtml+='</div>'
                                        strHtml+='<div class="pnForm_2"></div>'
                                    strHtml+='</div>'
                                    // strHtml+='<div id="pnCusNoMain" class="pn-margin-b-15"></div>'
                                    // strHtml+='<div>'
                                    // strHtml+='    <button class="btn btn-texticon bg-success txt-white" id="btnAddCustomer"><i class="fa fa-plus"></i><span langkey="pg_Dft_TC_OrDtl_btn-AddCustomer"></span></button>'
                                    // strHtml+='    <button class="btn btn-texticon bg-primary txt-white" id="btnSaveCustomer"><i class="fa fa-floppy-o"></i><span langkey="sys_Btn_Save"></span></button>'
                                    // strHtml+='</div>'
                                strHtml+='</div>'

                                $(IdOrClass_Pn+' .pnFormCustomer').html(strHtml)

                                $('#chkIsTraveller',IdOrClass_Pn).prop('checked',true)

                                pngPn.getForm({
                                    action: 1,
                                    objInput: objInput,
                                    idOrClass: IdOrClass_Pn + ' .pnCus[data="0"] .pnForm_2',
                                    objDetail: {},
                                })
                                $(IdOrClass_Pn + ' .pnCus[data="0"]').find('.intAgeID').attr('disabled',true)

                                var Dtm_OrderBkDateFrom = moment().format('l')

                                $(IdOrClass_Pn).find('.intAgeID').change(function(){
                                    var data = $(this).parents('.pnCus').attr('data')
                                    var idOrClassPn = IdOrClass_Pn + " .pnCus[data="+data+"]"

                                    var self = this
                                    $(idOrClassPn+' .intPassengerAges').change(function(){
                                        var data = $(this).attr('data')
                                        if(self.value == 4){
                                            var dtmStartDate = moment(Dtm_OrderBkDateFrom).add('years', -this.value-1).add('days', 1).format('DD/MM/YYYY')
                                            var dtmEndDate = moment(Dtm_OrderBkDateFrom).add('years', -this.value).format('DD/MM/YYYY')

                                            // if(Arr_ListTbl[data]['intPassengerAges'] != this.value){

                                            //     Arr_ListTbl[data]['intPassengerAges'] = this.value

                                            //     $(idOrClassPn+" .dtmPassengerBirthday").val('').change()
                                            // }
                                            $(idOrClassPn+" .dtmPassengerBirthday").datepicker('setStartDate',dtmStartDate)
                                            $(idOrClassPn+" .dtmPassengerBirthday").datepicker('setEndDate',dtmEndDate)

                                        }
                                    })

                                    var dtmStartDate,dtmEndDate

                                    var intPassengerAges = null
                                    // intPassengerAges = Arr_ListTbl[data].intPassengerAges
                                    // if(intPassengerAges==null)
                                    //     intPassengerAges=9

                                    if(this.value == 4){
                                        $(idOrClassPn+' .intPassengerAges').parent().find('label').css('display','block')
                                        $(idOrClassPn+' .intPassengerAges').css('display','inline-block').css('width','50%')
                                        $(idOrClassPn+' .intAgeID').css('display','inline-block').css('width','50%')
                                        $(idOrClassPn+' .intPassengerAges').show()
                                        $(idOrClassPn+' .intPassengerAges').val(intPassengerAges).change()


                                    }else{
                                        $(idOrClassPn+' .intAgeID').css('width','100%')
                                        $(idOrClassPn+' .intPassengerAges').hide()

                                        dtmStartDate = ''
                                        dtmEndDate = moment(Dtm_OrderBkDateFrom).add('years', -18).format('DD/MM/YYYY')
                                        // ArrCustomerList[ArrCustomerListNoDelete[data].intKey]['intPassengerAges'] = null

                                        $(idOrClassPn+" .dtmPassengerBirthday").datepicker('setStartDate',dtmStartDate)
                                        $(idOrClassPn+" .dtmPassengerBirthday").datepicker('setEndDate',dtmEndDate)

                                    }

                                    // if(Arr_ListTbl[data]['intAgeID'] != this.value){

                                    //     $(idOrClassPn+" .dtmPassengerBirthday").val('').change()
                                    // }

                                }).change()

                            }


                        }


                        objEvtPanel.pnListChildAge = function(_idOrClassPn){




                        }

                        objEvtPanel.pnListSurcharge = function(_idOrClassPn){

                        }

                        objEvtPanel.pnListFOC = function(_idOrClassPn){



                        }


                        objEvtPanel.pnBtn = function(_idOrClassPn){
                            var IdOrClass_Pn = _idOrClassPn

                            var strHtml = ''
                                // strHtml+='<div id="pnTotal" class="pn-margin-t-b-15"></div>'
                                strHtml+='<button id="btnSave" class="btn btn-texticon bg-primary txt-white"><span>Book</span></button>'
                                strHtml+='<div class="pn-margin-t-b-15 txtDes"></div>'

                            $(IdOrClass_Pn).html(strHtml)

                            $('#btnSave').click(function(){

                                var arrSurcharge = []
                                var arrChildAge = []
                                if(Arr_Surcharge && Arr_Surcharge.length){
                                    var arr = Arr_Surcharge.filter(function(item) { return item.IsEnableInput })


                                    arrSurcharge = arr

                                }

                                if(Arr_ListChild && Arr_ListChild.length){

                                    var arr = Arr_ListChild.filter(function(item) { return item.IsEnableInput })

                                    arrChildAge = arr
                                }


                                var strListItemTypeGUID = ''
                                var strListSupplierChildAgeGUID = ''
                                var strListSurchargeDateGUID = ''

                                strListItemTypeGUID += Obj_Detail.strItemTypeGUID + '!' + Obj_Detail.intSglDblID + '!' + Obj_Detail.intQuantity + '!' + Obj_Detail.intMealIncludedTypeID + '!' + Obj_Detail.strItemTypeDetailGUID + '!' + _Opt.intChildOptionID + '#'

                                if(arrChildAge && arrChildAge.length){
                                    arrChildAge.forEach(function(val){
                                        strListSupplierChildAgeGUID+=Obj_Detail.strItemTypeGUID+'!'+val.strSupplierChildAgeGUID+'!'+Obj_Detail.intSglDblID+'!'+val.intQuantity+'#'
                                    })

                                }

                                if(arrSurcharge && arrSurcharge.length){
                                    arrSurcharge.forEach(function(val){
                                        strListSurchargeDateGUID+=Obj_Detail.strItemTypeGUID+'!'+val.strSurchargeDateGUID+'!'+Obj_Detail.intSglDblID+'!'+val.intQuantity+'#'
                                    })

                                }

                                var strListChildAge = ''
                                Obj_SearchDtl.arrChildren.forEach(function(value){
                                    strListChildAge+=value+','
                                })

                                pngPn.getForm({
                                    action: 2,
                                    objInput: objInput,
                                    idOrClass: IdOrClass__Main + ' #pnContent',
                                    OnChkSuccess: function(objRtn){
                                        if(objRtn){

                                            if(_Opt.intType == 1){
                                                png.postListApiGetValue({
                                                    objList_Api: ObjList_Api
                                                    //,objList_ComboValue: ObjList_ComboValue
                                                    ,objListApi_RtnVal: {
                                                        'AddBookingRequestForHotel':{
                                                            objParams_Cus: $.pngExtendObj(objRtn,{
                                                                strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                                                ,strSupplierGUID: Obj_Detail.strSupplierGUID
                                                                ,strPriceLevelGUID: Str_PriceLevelGUID
                                                                ,strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                                                ,strListItemTypeGUID: strListItemTypeGUID
                                                                ,strListSupplierChildAgeGUID: strListSupplierChildAgeGUID
                                                                ,strListSurchargeDateGUID: strListSurchargeDateGUID
                                                                // ,strListFocGUID: strListFocGUID
                                                                ,IsBookNotMinstay: IsBookNotMinstay
                                                                ,intAdult: Obj_SearchDtl.intNoAdult
                                                                ,strListChildAge: strListChildAge
                                                                ,dtmDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                                                ,dtmDateTo : Obj_SearchDtl.dtmDateCheckOut
                                                            })
                                                            ,OnSuccess: function(data){
                                                                var obj = JSON.parse(data)[0][0]

                                                                png.postSendEmail({
                                                                    strUserGUID: null
                                                                    ,strEmailsSendTo: null
                                                                    ,strEmailsCC: null
                                                                    ,strEmailTemplateSubject: null
                                                                    ,IsBodyHtml: 1
                                                                    ,strEmailTemplateContent: null
                                                                    ,strTempApiUrl:'api/system/GetEmailSendRequestBookingByAgent'
                                                                    ,objTempPar:{
                                                                        strUserGUID: options.strUserGUID
                                                                        ,strBookingRequestGUID: obj.strBookingRequestGUID
                                                                        ,intLangID: $.pngGetLangID()
                                                                    }
                                                                    ,OnSuccess: function (data) {
                                                                        GetLinkBooking()
                                                                    }
                                                                })

                                                                function GetLinkBooking(){

                                                                    $.Confirm({strContent:'Send Request Successfully !'})
                                                                    Obj_FN_Main.OnClosePp(true,true)
                                                                }
                                                            }
                                                        }
                                                    }
                                                })
                                            }


                                            if(_Opt.intType == 2){
                                                png.postListApiGetValue({
                                                    objList_Api: ObjList_Api
                                                    //,objList_ComboValue: ObjList_ComboValue
                                                    ,objListApi_RtnVal: {
                                                        'AddPassengerOrderForSupByHotelByPUB':{
                                                            objParams_Cus: $.pngExtendObj(objRtn,{
                                                                strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                                                ,strPriceLevelGUID: Str_PriceLevelGUID
                                                                ,strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                                                ,strListItemTypeGUID: strListItemTypeGUID
                                                                ,strListSupplierChildAgeGUID: strListSupplierChildAgeGUID
                                                                ,strListSurchargeDateGUID: strListSurchargeDateGUID
                                                                // ,strListFocGUID: strListFocGUID
                                                                ,IsBookNotMinstay: IsBookNotMinstay
                                                                ,intAdult: Obj_SearchDtl.intNoAdult
                                                                ,strListChildAge: strListChildAge
                                                                ,dtmDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                                                ,dtmDateTo : Obj_SearchDtl.dtmDateCheckOut
                                                            })
                                                            ,OnSuccess: function(data){
                                                                // var obj = JSON.parse(data)[0][0]

                                                                // png.postSendEmail({
                                                                //     strUserGUID: null
                                                                //     ,strEmailsSendTo: null
                                                                //     ,strEmailsCC: null
                                                                //     ,strEmailTemplateSubject: null
                                                                //     ,IsBodyHtml: 1
                                                                //     ,strEmailTemplateContent: null
                                                                //     ,strTempApiUrl:'api/system/GetEmailSendRequestBookingByAgent'
                                                                //     ,objTempPar:{
                                                                //         strUserGUID: options.strUserGUID
                                                                //         ,strBookingRequestGUID: obj.strBookingRequestGUID
                                                                //         ,intLangID: $.pngGetLangID()
                                                                //     }
                                                                //     ,OnSuccess: function (data) {
                                                                        GetLinkBooking()
                                                                //     }
                                                                // })

                                                                function GetLinkBooking(){

                                                                    window.location.href = '/user/orders'

                                                                }
                                                            }
                                                        }
                                                    }
                                                })
                                            }

                                            if(_Opt.intType == 3){

                                                objRtn = $.pngExtendObj(Obj_Detail,objRtn)

                                                png.postListApiGetValue({
                                                    objList_Api: ObjList_Api
                                                    //,objList_ComboValue: ObjList_ComboValue
                                                    ,objListApi_RtnVal: {
                                                        'AddBookingFromHotelByAgent':{
                                                            objParams_Cus: $.pngExtendObj(objRtn,{
                                                                strCompanyOwnerGUID: Str_CompanyOwnerGUID
                                                                ,strPriceLevelGUID: Str_PriceLevelGUID
                                                                ,strPriceListGUID: $('#pnListRoom .strPriceListGUID').val()
                                                                ,IsTraveller: $('.chkIsTraveller',IdOrClass__Main).is(':checked')
                                                                ,strListItemTypeGUID: strListItemTypeGUID
                                                                ,strListSupplierChildAgeGUID: strListSupplierChildAgeGUID
                                                                ,strListSurchargeDateGUID: strListSurchargeDateGUID
                                                                // ,strListFocGUID: strListFocGUID
                                                                ,IsBookNotMinstay: IsBookNotMinstay
                                                                ,intAdult: Obj_SearchDtl.intNoAdult
                                                                ,strListChildAge: strListChildAge
                                                                ,dtmDateFrom: Obj_SearchDtl.dtmDateCheckIn
                                                                ,dtmDateTo : Obj_SearchDtl.dtmDateCheckOut
                                                            })
                                                            ,OnSuccess: function(data){
                                                                var obj = JSON.parse(data)[0][0]


                                                                png.postSendEmail({
                                                                    strUserGUID: null
                                                                    ,strEmailsSendTo: null
                                                                    ,strEmailsCC: null
                                                                    ,strEmailTemplateSubject: null
                                                                    ,IsBodyHtml: 1
                                                                    ,strEmailTemplateContent: null
                                                                    ,strTempApiUrl:'api/system/GetEmailSendAgentHostByAgentBook'
                                                                    ,objTempPar:{
                                                                        strUserGUID: options.strUserGUID
                                                                        ,strBookingGUID: obj.strBookingGUID
                                                                        ,intLangID: $.pngGetLangID()
                                                                        ,strEmailTemplateCode:'BKK'
                                                                    }
                                                                    ,OnSuccess: function (data) {
                                                                        GetLinkBooking()
                                                                    }
                                                                })

                                                                function GetLinkBooking(){

                                                                    var strUrl = '/user/'+JSON.parse(png.ArrLS.UserDetail.get()).strUserName+'?strKey=ListBooking&status=0'

                                                                    window.location.href = strUrl
                                                                    // $.Confirm({strContent:'Send Request Successfully !'})
                                                                    // Obj_FN_Main.OnClosePp(true,true)
                                                                }
                                                            }
                                                        }
                                                    }
                                                })
                                            }


                                        }
                                    }
                                })

                                // var IsConfirm = false
                                // var intNoRooms = 0

                                // Arr_ListBook.forEach(function(value){
                                //     intNoRooms+=parseInt(value.intQuantity)
                                // })

                                // var ArrListForGIT = Arr_ListFoc.filter(function(item){ return item.intFOCTypeID==3 })

                                // if(ArrListForGIT.length){
                                //     if(intNoRooms >= ArrListForGIT[0].intFOCPax && intNoRooms - parseInt(Obj_Detail.intQuantity) < ArrListForGIT[0].intFOCPax ){
                                //         IsConfirm = true
                                //     }
                                // }


                                // if(IsConfirm){
                                //     $.Confirm({
                                //         strContent: 'Nếu bạn chọn phòng này, hệ thống sẽ cập nhật sang giá GIT. Bạn có muốn chọn không?'
                                //         , OnSuccess: function () {
                                //             Is_BookNotMinstay= IsBookNotMinstay
                                //             _Opt.OnSuccess.call(this,Arr_ListBook,Arr_ListFOCUse)
                                //             Obj_FN_Main.OnClosePp(false,true)
                                //         }
                                //     })
                                // }else{
                                //     Is_BookNotMinstay= IsBookNotMinstay
                                //     _Opt.OnSuccess.call(this,Arr_ListBook,Arr_ListFOCUse)
                                //     Obj_FN_Main.OnClosePp(false,true)
                                // }

                            })

                            // var dblTotalPriceAll = Obj_Detail.dblTotalPrice
                            // var dblTotalComPriceAll = Obj_Detail.dblTotalComPrice

                            // if(Arr_Surcharge && Arr_Surcharge.length){
                            //     var arr = Arr_Surcharge.filter(function(item) { return item.IsEnableInput })


                            //     Obj_Rtn['arrSurcharge'] = arr

                            //     arr.forEach(function(value){
                            //         dblTotalPriceAll+=value.dblTotalPrice
                            //     })
                            // }

                            // if(Arr_ListChild && Arr_ListChild.length){

                            //     var arr = Arr_ListChild.filter(function(item) { return item.IsEnableInput })


                            //     Obj_Rtn['arrChildAge'] = arr

                            //     arr.forEach(function(value){
                            //         dblTotalPriceAll+=(value.dblTotalPrice || 0)
                            //         dblTotalComPriceAll+=(value.dblTotalComPrice || 0)
                            //     })
                            // }


                            // Obj_Rtn['dblTotalPriceAll'] = dblTotalPriceAll
                            // Obj_Rtn['dblTotalComPriceAll'] = dblTotalComPriceAll

                            // strHtml = ''
                            // strHtml+='<div style="font-size:20px;font-weight:bold;color:#1076FC">Tổng giá:'+$.pngFormatPrice(dblTotalPriceAll)+' </div>'
                            // $('#pnTotal','#pnContent').html(strHtml)


                        }

                        // ===================================

                        pngPn.getPanelHtml({            // Get ra panel dạng html
                            objPanel: objPanel
                            ,objEvtPanel: objEvtPanel
                            ,idOrClass: IdOrClass__Main  // Id or class chính
                            ,OnChangeIdPn: function(_Fn){
                                Obj_FN_Main.pnMain = _Fn    // Hàm đổi trang
                            }
                        })



                    }


                    function GetPanel_pnListChildAge(_idOrClassPn){
                        var IdOrClass_Pn = _idOrClassPn

                        var IntNoOfNight = moment(Obj_SearchDtl.dtmDateCheckOut).diff(moment(Obj_SearchDtl.dtmDateCheckIn),'days')
                        



                        if(  Arr_ListChild.length){

                            var strIn = ''
                            if(Obj_SearchDtl.arrChildren.length){
                                strIn = ' in'
                            }
                            var strHtml_Age = ''
                            Arr_ListChildAge.forEach(function(value){
                                strHtml_Age+=value+' tuổi, '
                            })

                            strHtml_Age = (strHtml_Age+'|').replace(', |','').replace('|','')

                            var strHtml=''
                            strHtml+='<div>'
                                strHtml+=`<h3 class="pn-margin-t-30 pn-margin-b-15" style="display: inline-block;">
                                        <b>Trẻ em</b> 
                                    </h3>
                                    (<b style="font-size:12px"><i class="fa fa-child"></i></b> ${Arr_ListChildAge.length} [${strHtml_Age}] )    
                                `
                                
                                strHtml+= '<a id="btnViewFilter" class="btn btn-link" data-toggle="collapse" href="#pnForm1">'
                                strHtml+= '    <i class="fa fa-chevron-down"></i>'
                                strHtml+= '    <span></span>'
                                strHtml+= '</a>'
                            strHtml+='</div>'
                            
                            strHtml+= '<div id="pnForm1" class="panel-collapse collapse'+strIn+'">'
                                strHtml+='<div class="pnListPrice"></div>'
                            strHtml+= '</div>'

                            $(IdOrClass_Pn).html(strHtml)

                            $('#btnViewFilter').click(function(e){
                                setTimeout(function(){
                                    GetViewHideTxt(IdOrClass_Pn)
                                },500)
                            })
                            GetViewHideTxt(IdOrClass_Pn)

                            var IsFirst = true


                            var objCols = {
                                No: { name: '<span langkey="sys_Txt_No"></span>' }
                                    ,strChildAge:{name:'Child Age'}
                                    ,intQuantity:{name:'Quantity'
                                        ,input:{title: '',attr:"class='col-md-12' style='margin:0'",isRequire:false,IsRtn:true
                                            ,input:{type:'text',classEx:'form-control',attr:'input-fn="true" style="width: 100px;"'}
                                        }
                                    }
                                    ,dblUnitPrice_View:{name:'<span langkey="sys_Txt_Unitprice"></span> <span style="font-weight: normal;"<Cho '+IntNoOfNight+' Đêm</span>', strAttrTD:'style="text-align:right"'}
                                    ,dblTotalPrice:{name: '<span langkey="pg_Main_Supp_PPbook_TotalPrice"></span>' ,strAttrTD:'style="text-align:right"'}
                                    ,dblTotalComPrice:{name:'Tổng hoa hồng',strAttrTD:' style="text-align:right"'},
                            }

                            if ($(window).width() < 767){
                                objCols = {
                                    No: { name: '<span langkey="sys_Txt_No"></span>' }
                                    ,strChildAge:{name:'Child Age', strAttrTD: "style='vertical-align: top' " }
                                    ,intQuantity:{name:'Quantity', strAttrTD: "style='vertical-align: top' "
                                        ,list_input:{
                                            intQuantity:{title: '',attr:"class='col-md-12' style='margin:0'",isRequire:false,IsRtn:true
                                                ,input:{type:'text',classEx:'form-control',attr:'input-fn="true" style="width: 100px;"'}
                                            },
                                            dblUnitPrice_View:{title: '<span langkey="sys_Txt_Unitprice"></span> <span style="font-weight: normal;"<Cho '+IntNoOfNight+' Đêm</span>',attr:"class='col-md-12' style='margin:0'"
                                                ,input:{IsNoInput:true,IsViewDtl:true}
                                            },
                                            dblTotalPrice:{title: '<span langkey="pg_Main_Supp_PPbook_TotalPrice"></span>',attr:"class='col-md-12' style='margin:0'"
                                                ,input:{IsNoInput:true,IsViewDtl:true}
                                            },
                                        }
                                    }
                                }

                            }



                            pngPn.getTable2({
                                objApi: null
                                ,objParams_Cus: null
                                ,objCols: objCols
                                ,editRltArr: function(arr){
                                    return Arr_ListChild
                                }
                                ,editRlt: function(value,key){
                
                                    value['No'] = (key + 1)
                
                                    value['strChildAge'] = value.strAgeName //'['+value.dblAgeFrom+' - '+value.dblAgeTo+']'
                
                                    value['intQuantity'] = Obj_SearchDtl.arrChildren.filter( function(item){ return item >= value.dblAgeFrom && item <= value.dblAgeTo }).length
                                    
                                    var dblUnitPrice = 0
                                    var dblUnitComPrice = 0
                                    Arr_ListDate.forEach(function(_val){
                
                                        var arr = Arr_PriceRoom.filter(function(item){ return item.strPriceSeasonGUID.toUpperCase() == (_val.strPriceSeasonGUID || '').toUpperCase() && item.intMealIncludedTypeID == Obj_Detail.intMealIncludedTypeID})
                                        
                                        if( arr.length ){
                                            val = arr[0]
                
                                            var dblUnitPriceItem = 0
                                            var dblUnitComPriceItem = 0
                                            
                                            
                                            dblUnitPriceItem = val['dblPriceChild'+value.intSupplierChildAgeKeyID]
                                            dblUnitComPriceItem = 0
                                            
                                            dblUnitPrice+= dblUnitPriceItem
                                            dblUnitComPrice+= dblUnitComPriceItem
                                        }
                
                                    })
                                    value['dblUnitPrice'] = dblUnitPrice
                                    value['dblUnitComPrice'] = dblUnitComPrice
                                    value['dblTotalComPrice'] = dblUnitComPrice * value.intQuantity
                
                                    if(dblUnitPrice)
                                        value['dblUnitPrice_View'] = '<a action="ViewUnitPrice" intRowID="'+key+'" style="cursor: inherit;">'+$.pngFormatPrice(dblUnitPrice)+'</a>'
                                    else
                                        value['dblUnitPrice_View'] = 'N/A'
                                    // if(IsFirst){
                                    //     if(value.intIncludeTypeID == 2 || value.intIncludeTypeID == 3)
                                    //         value.IsEnableInput = 1
                                    // }
                
                                    
                                    
                                    // }else{
                
                                    //     // value.strItemTypeGUID
                                    //     value['dblUnitPrice'] = 0
                                    //     value['dblUnitComPrice'] = 0
                                    // }
                                    // value['strMarkupHtml'] = ''
                                    // value['strMarkupHtml']+= value.dblMarkup+'('+value.strMakupName+')'
                                }
                                ,customEvent:function(_idOrClassPnTbl){
                                    
                                    Arr_ListChild.forEach(function(value,key){
                
                                        if(IsFirst){
                                            if(value['intQuantity']){
                                                $('[row='+key+'] .IsEnableInput',_idOrClassPnTbl).prop('checked',true).change()
                                                value.IsEnableInput = 1
                                            }
                                        }
                
                
                                        var intMaxNoOfChild = Obj_Detail.intMaxNoOfChild
                                        if(Obj_Detail.intChildOptionID && Obj_Detail.intChildOptionID != '0'){
                                            var arr = Obj_Detail.arrOptionsChild.filter(function(item){ return item.intChildOptionID == Obj_Detail.intChildOptionID && (item.strSupplierChildAgeGUID || '').toUpperCase() == (value.strSupplierChildAgeGUID || '').toUpperCase() })
                                            intMaxNoOfChild = arr[0].intNoOfChild
                                        }
                
                                        $( '[row='+key+'] .intQuantity',_idOrClassPnTbl ).parent().append('<div>(Max: '+intMaxNoOfChild*Obj_Detail.intQuantity+')</div>')
                                        
                
                                        $( '[row='+key+'] a[action=ViewUnitPrice]',_idOrClassPnTbl ).hover(function() {
                
                                    
                                            var strHtml = ''
                                            strHtml+='<div id="pnSeeMore" class="bg-white pn-padding-15" style="position:absolute;z-index: 2;line-height: 25px;box-shadow: 0px 0px 18px -7px;text-align:left">'
                                            
                                            var dblUnitPrice = 0
                                            var intQuantity = 1
                                            var dtmDateFrom
                                            var dtmDateTo
                                            var strHtmlItem = ''
                
                                            Arr_ListDate.forEach(function(_val){
                
                                                var arr = Arr_PriceRoom.filter(function(item){ return item.strPriceSeasonGUID.toUpperCase() == (_val.strPriceSeasonGUID || '').toUpperCase() && item.intMealIncludedTypeID == Obj_Detail.intMealIncludedTypeID })
                                                
                                                if( arr.length ){
                
                                                    val = arr[0]
                
                                                        
                                                    var dblUnitPriceItem = 0
                
                                                    dblUnitPriceItem = val['dblPriceChild'+value.intSupplierChildAgeKeyID]
                
                                                    if(dblUnitPrice!=dblUnitPriceItem){
                                                        intQuantity = 1
                                                        dblUnitPrice=dblUnitPriceItem
                                                        dtmDateFrom = $.pngFormatDateTime(_val.dtmDate,'l')
                
                                                        strHtml+=strHtmlItem
                                                    }else{
                                                        intQuantity++
                                                    }
                
                                                    dtmDateTo = moment($.pngFormatDateTime(_val.dtmDate,'l')).add('days',1).format('l')
                                                    
                                                    strHtmlItem = ''
                                                    strHtmlItem+='<div><b>'+$.pngFormatDateTime(dtmDateFrom)+' - '+$.pngFormatDateTime(dtmDateTo)+'</b></div>'
                                                    strHtmlItem+='<div> '+intQuantity+' x '+$.pngFormatPrice(dblUnitPriceItem)+'</div>'
                
                                                    
                                                }
                                            })
                
                                            strHtml+=strHtmlItem
                
                                            strHtml+='</div>'
                
                                            $( this ).append( strHtml );
                                        }, function() {
                                            $( this ).find( "#pnSeeMore" ).remove();
                                        }
                                        
                                        );
                                    })
                
                                    IsFirst = false
                
                
                
                                    // IsFirst = false
                
                
                
                                    $('tbody input',_idOrClassPnTbl).change(function(){
                                        var intRowID = $(this).parents('tr').attr('row')
                
                                        Arr_ListChild[intRowID].intQuantity = $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val().getNumber()//parseFloat(this.value)
                                        Arr_ListChild[intRowID].IsEnableInput = $('[row='+intRowID+'] .IsEnableInput',_idOrClassPnTbl).is(':checked')
                        
                
                
                                        var dblTotalPrice = Arr_ListChild[intRowID].dblUnitPrice *Arr_ListChild[intRowID].intQuantity
                                        
                                        Arr_ListChild[intRowID].dblTotalPrice = dblTotalPrice
                                        Arr_ListChild[intRowID].dblTotalComPrice = Arr_ListChild[intRowID].dblUnitComPrice * Arr_ListChild[intRowID].intQuantity
                
                                        // $('.pn-dblUnitPrice_View[row='+intRowID+']',_idOrClassPnTbl).html($.pngFormatPrice((Arr_Surcharge[intRowID].dblUnitPrice)))
                                        
                                        if(dblTotalPrice){
                                            $('.pn-dblTotalPrice[row='+intRowID+']',_idOrClassPnTbl).html($.pngFormatPrice((dblTotalPrice)))
                                            $('[row='+intRowID+'] .pnElm-dblTotalPrice',_idOrClassPnTbl).html($.pngFormatPrice((dblTotalPrice)))
                                        }else{
                                            $('.pn-dblTotalPrice[row='+intRowID+']',_idOrClassPnTbl).html('N/A')
                                            $('[row='+intRowID+'] .pnElm-dblTotalPrice',_idOrClassPnTbl).html('N/A')
                                        }
                                        if(Arr_ListChild[intRowID].dblTotalComPrice)
                                            $('[row='+intRowID+'] .pn-dblTotalComPrice',_idOrClassPnTbl).html($.pngFormatPrice(Arr_ListChild[intRowID].dblTotalComPrice))
                                        else
                                            $('[row='+intRowID+'] .pn-dblTotalComPrice',_idOrClassPnTbl).html('N/A')
                
                                        // _OnUpdTotalPrice()
                                        // if(Obj_FN_Main.pnMain)
                                        //     Obj_FN_Main.pnMain('pnBtn')
                                            // GetPanel_TotalPrice()
                                    })
                                    setTimeout(function(){
                
                                        // GetPanel_TotalPrice()
                                    },100)
                                    // GetTotalAllPrice()
                                    // if(Obj_FN_Main.pnMain)
                                    //     Obj_FN_Main.pnMain('pnBtn')
                                    
                                }
                                , changeCkbMaster: function (_IsChecked, _intRowID, _arrList) {
                                    
                        
                        
                                    // if($(IdOrClass_Pn+' input[chkboxMaster="true"]:checked').length == 0){
                                    //     $(IdOrClass_Main+ " #pnListBtn .viewedit>span.intITs").text('')
                                    //     $(IdOrClass_Main+ " #pnListBtn .viewedit").hide()
                                    // }else{
                                    //     $(IdOrClass_Main+ " #pnListBtn .viewedit>span.intITs").text(' (' + $(IdOrClass_Pn+' input[chkboxMaster="true"]:checked').length + ')')
                                    //     $(IdOrClass_Main+ " #pnListBtn .viewedit").show()
                                    // }
                
                                    return Arr_ListChild  = _arrList;
                
                                }
                                ,IsViewCheckBoxMain: true
                                ,idOrClass: IdOrClass_Pn+' .pnListPrice'
                            })
                        }
                    }


                    function GetPanel_pnListSurcharge(_idOrClassPn){
                        var IdOrClass_Pn = _idOrClassPn


                    // if(Arr_Surcharge.length){


                        var strHtml=''
                        strHtml+='<div >'
                            strHtml+='<h3 class="pn-margin-t-30 pn-margin-b-15" style="display: inline-block;" ><b>Phụ thu</b> </h3>'
                            strHtml+= '<a id="btnViewFilter2" class="btn btn-link" data-toggle="collapse" href="#pnForm2">'
                            strHtml+= '    <i class="fa fa-chevron-down"></i>'
                            strHtml+= '    <span></span>'
                            strHtml+= '</a>'
                        strHtml+='</div>'

                        strHtml+= '<div id="pnForm2" class="panel-collapse collapse in">'
                            strHtml+='<div class="pnListPrice"></div>'
                        strHtml+= '</div>'

                        $(IdOrClass_Pn).html(strHtml)


                        $('#btnViewFilter2').click(function(e){
                            setTimeout(function(){
                                GetViewHideTxt(IdOrClass_Pn)
                            },500)
                        })
                        GetViewHideTxt(IdOrClass_Pn)

                        var IsFirst = true

                        var objCols =  {
                            No: { name: '<span langkey="sys_Txt_No"></span>' }
                            ,strSurchargeName_View:{name:'Surcharge Name'}
                            // ,strPerPaxName:{name:'Per Service Name'}
                            ,intNoOfDay:{name:'No Of Days'}
                            ,intQuantity:{name:'Quantity'
                                ,input:{title: '',attr:"class='col-md-12' style='margin:0'",isRequire:false,IsRtn:true
                                    ,input:{type:'text',classEx:'form-control',attr:'input-fn="true" style="width: 100px;"'}
                                }
                            }
                            ,dblUnitPrice_View:{name:'Unit Price', strAttrTD:'style="text-align:right"'}
                            ,dblTotalPrice:{name: '<span langkey="pg_Main_Supp_PPbook_TotalPrice"></span>', strAttrTD:'style="text-align:right"'}
                        }

                        if ($(window).width() < 767){
                            objCols = {
                                No: { name: '<span langkey="sys_Txt_No"></span>' }
                                ,strSurchargeName:{name:'Surcharge Name', strAttrTD: "style='vertical-align: top' "
                                    ,list_input:{

                                        strSurchargeName:{title:'',attr:"class='col-md-12' "
                                            ,input:{IsNoInput:true,IsViewDtl:true}
                                        },
                                        strPerPaxName:{title:'Per Service Name',attr:"class='col-md-12' style='margin-bottom:5px'"
                                            ,input:{IsNoInput:true,IsViewDtl:true}
                                        },
                                        dtmDateFromTo:{title:'Date',attr:"class='col-md-12' style='margin-bottom:5px'"
                                            ,input:{IsNoInput:true,IsViewDtl:true}
                                        },
                                    }
                                }
                                ,intQuantity:{name:'Quantity', strAttrTD: "style='vertical-align: top' "
                                    ,list_input:{

                                        intQuantity:{title:'',attr:"class='col-md-12' "
                                            ,input:{type:'text',classEx:'form-control',attr:'input-fn="true" style="width: 100px;"'}
                                        },
                                        dblUnitPrice_View:{title:'Unit Price',attr:"class='col-md-12' style='margin-bottom:5px'"
                                            ,input:{IsNoInput:true,IsViewDtl:true}
                                        },
                                        dblTotalPrice:{title:'<span langkey="pg_Main_Supp_PPbook_TotalPrice"></span>',attr:"class='col-md-12' style='margin-bottom:5px'"
                                            ,input:{IsNoInput:true,IsViewDtl:true}
                                        },
                                    }
                                }

                            }

                        }

                        pngPn.getTable2({
                            objApi: null
                            ,objParams_Cus: null
                            ,objCols: objCols
                            ,editRltArr: function(arr){
                                return Arr_Surcharge
                            }
                            ,editRlt: function(value,key){
                                // value['strSglDblName'] = 'Child Age ['+value.dblAgeFrom+' - '+value.dblAgeTo+']'

                                value['strSurchargeName_View'] = value['strSurchargeName']+' - '+value['strPerPaxName']

                                value.dtmDateFrom = $.pngFormatDateTime(value.dtmDateFrom,'l')
                                value.dtmDateTo = $.pngFormatDateTime(value.dtmDateTo,'l')
                                var dtmDateFrom, dtmDateTo
                                if(moment(value.dtmDateFrom) < moment(Obj_SearchDtl.dtmDateCheckIn) ){
                                    dtmDateFrom = Obj_SearchDtl.dtmDateCheckIn
                                }else{
                                    dtmDateFrom = value.dtmDateFrom
                                }
                                if(moment(value.dtmDateTo) > moment(Obj_SearchDtl.dtmDateCheckOut).add(-1,'days') ){
                                    dtmDateTo = moment(Obj_SearchDtl.dtmDateCheckOut).add(-1,'days')
                                }else{
                                    dtmDateTo = value.dtmDateTo
                                }

                                value['intNoOfDay'] = moment(dtmDateTo).diff(moment(dtmDateFrom), 'days')+1

                                value['dtmDateFromTo'] = $.pngFormatDateTime(moment(dtmDateFrom).format('l'))+' - '+$.pngFormatDateTime(moment(dtmDateTo).format('l'))

                                // if(IsFirst){
                                //     if(value.intIncludeTypeID == 2 || value.intIncludeTypeID == 3)
                                //         value.IsEnableInput = 1
                                // }

                                value['dblUnitPrice_View'] = $.pngFormatPrice(value['dblUnitPrice'])

                                // }else{

                                //     // value.strItemTypeGUID
                                //     value['dblUnitPrice'] = 0
                                //     value['dblUnitComPrice'] = 0
                                // }
                                // value['strMarkupHtml'] = ''
                                // value['strMarkupHtml']+= value.dblMarkup+'('+value.strMakupName+')'
                            }
                            ,customEvent:function(_idOrClassPnTbl){

                                Arr_Surcharge.forEach(function(value,key){
                                    if(IsFirst){
                                        if(value.intIncludeTypeID == 2 || value.intIncludeTypeID == 3)
                                            $('[row='+key+'] .IsEnableInput',_idOrClassPnTbl).prop('checked',true).change()
                                            value.IsEnableInput = 1
                                    }
                                })

                                IsFirst = false



                                $('tbody input.intQuantity',_idOrClassPnTbl).change(function(){
                                    var intRowID = $(this).parents('tr').attr('row')

                                    Arr_Surcharge[intRowID].IsEnableInput = $('[row='+intRowID+'] .IsEnableInput',_idOrClassPnTbl).is(':checked')//parseFloat(this.value)
                                    Arr_Surcharge[intRowID].intQuantity = $('[row='+intRowID+'] .intQuantity',_idOrClassPnTbl).val().getNumber()//parseFloat(this.value)


                                    var arr = ArrSurchargePrice.filter(function(item){ return item.strSurchargeDateGUID.toUpperCase() == Arr_Surcharge[intRowID].strSurchargeDateGUID.toUpperCase() && item.intPaxFrom <=Arr_Surcharge[intRowID].intQuantity  && item.intPaxTo >= Arr_Surcharge[intRowID].intQuantity })

                                    if(arr.length)
                                        Arr_Surcharge[intRowID].dblUnitPrice = arr[0].dblPrice
                                    else
                                        Arr_Surcharge[intRowID].dblUnitPrice = null


                                    var dblTotalPrice = Arr_Surcharge[intRowID].dblUnitPrice *Arr_Surcharge[intRowID].intQuantity

                                    Arr_Surcharge[intRowID].dblTotalPrice = dblTotalPrice
                                    if(Arr_Surcharge[intRowID].dblUnitPrice == null){
                                        $('.pn-dblUnitPrice_View[row='+intRowID+']',_idOrClassPnTbl).html('N/A')
                                        $('.pn-dblTotalPrice[row='+intRowID+']',_idOrClassPnTbl).html('N/A')
                                        $('[row='+intRowID+'] .pnElm-dblTotalPrice',_idOrClassPnTbl).html('N/A')
                                        $(_idOrClassPnTbl+' tr[row=' + intRowID + '] .IsEnableInput').attr('disabled',true).prop('checked',false).change()
                                    }else{
                                        if(Arr_Surcharge[intRowID].intIncludeTypeID != 3)
                                            $(_idOrClassPnTbl+' tr[row=' + intRowID + '] .IsEnableInput').attr('disabled',false )
                                        $('.pn-dblUnitPrice_View[row='+intRowID+']',_idOrClassPnTbl).html($.pngFormatPrice((Arr_Surcharge[intRowID].dblUnitPrice)))
                                        $('.pn-dblTotalPrice[row='+intRowID+']',_idOrClassPnTbl).html($.pngFormatPrice((dblTotalPrice)))
                                        $('[row='+intRowID+'] .pnElm-dblTotalPrice',_idOrClassPnTbl).html($.pngFormatPrice((dblTotalPrice)))
                                    }
                                    // GetTotalAllPrice()
                                    // if(Obj_FN_Main.pnMain)
                                    //     Obj_FN_Main.pnMain('pnBtn')
                                    GetPanel_TotalPrice()
                                })
                                // GetTotalAllPrice()
                                // if(Obj_FN_Main.pnMain)
                                //     Obj_FN_Main.pnMain('pnBtn')

                            }
                            , changeCkbMaster: function (_IsChecked, _intRowID, _arrList) {
                                if(Arr_Surcharge[_intRowID].intIncludeTypeID == 3)
                                    $(IdOrClass_Pn+' .pnListPrice tr[row=' + _intRowID + '] .IsEnableInput').attr('disabled',true).prop('checked',true)

                                if (_IsChecked){

                                    setTimeout(function(){
                                        if(Arr_Surcharge[_intRowID].dblUnitPrice == null){
                                            $(IdOrClass_Pn+' .pnListPrice tr[row=' + _intRowID + '] .IsEnableInput').prop('checked',false)
                                            Arr_Surcharge[_intRowID].IsEnableInput = false
                                        }
                                    },100)
                                    // $(IdOrClass_Pn + ' tr[row=' + _intRowID + '] td').css('background', '#E7EEFB')
                                }
                                else{
                                        $(IdOrClass_Pn+' .pnListPrice tr[row=' + _intRowID + '] .intQuantity').attr('disabled',false)
                                    // $(IdOrClass_Pn + ' tr[row=' + _intRowID + '] td').removeAttr('style')
                                }


                                // if($(IdOrClass_Pn+' input[chkboxMaster="true"]:checked').length == 0){
                                //     $(IdOrClass_Main+ " #pnListBtn .viewedit>span.intITs").text('')
                                //     $(IdOrClass_Main+ " #pnListBtn .viewedit").hide()
                                // }else{
                                //     $(IdOrClass_Main+ " #pnListBtn .viewedit>span.intITs").text(' (' + $(IdOrClass_Pn+' input[chkboxMaster="true"]:checked').length + ')')
                                //     $(IdOrClass_Main+ " #pnListBtn .viewedit").show()
                                // }

                                Arr_Surcharge = _arrList;
                                
                                GetPanel_TotalPrice()
                            }
                            ,IsViewCheckBoxMain:true
                            ,idOrClass: IdOrClass_Pn+' .pnListPrice'
                        })


                    // }

                    }


                    function GetPanel_pnListFOC(_idOrClassPn){
                        var IdOrClass_Pn = _idOrClassPn

                        // Is_BookNotMinstay = null

                        GetArr_ListFOC({
                            Arr_ListBook: Arr_ListBook,
                            Arr_ListFoc: Arr_ListFoc,
                            Obj_SearchDtl: Obj_SearchDtl,
                            Is_BookNotMinstay: IsBookNotMinstay,
                            OnSuccess: function (_arr) {
                                Arr_ListFOCUse = _arr
                            }
                        })

                        // if(Arr_ListFOCUse.length){


                            var strHtml=''
                            strHtml+='<div style="border-top: 1px solid #ccc">'
                                strHtml+='<h3 class=" pn-margin-t-b-15" style="display: inline-block;"><b>FOC</b> </h3>'
                                strHtml+= '<a id="btnViewFilter3" class="btn btn-link" data-toggle="collapse" href="#pnForm3">'
                                strHtml+= '    <i class="fa fa-chevron-down"></i>'
                                strHtml+= '    <span></span>'
                                strHtml+= '</a>'
                                strHtml+= '<div class="pnChkFOC" style="display:inline-flex;float: right;margin-top: 15px;">'
                                strHtml+= '</div>'
                            strHtml+='</div>'
                            strHtml+= '<div id="pnForm3" class="panel-collapse collapse in">'
                                strHtml+='<div class="pnListPrice"></div>'
                            strHtml+= '</div>'

                            $(IdOrClass_Pn).html(strHtml)

                            var arrFOC = Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID==1 && item.IsNotCombinedFOC })
                            var arrMinstay = Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID == 2 })

                            var IsFOCCombine=false

                            if(arrFOC.length && arrMinstay.length){
                                IsFOCCombine = true

                                strHtml = ''
                                strHtml+= '    <input type="checkbox" class="chkFOC chkCustom-1">'
                                strHtml+= '    <span style="line-height: 28px; margin-left: 5px;">(Chọn: <b>FOC</b>/Bỏ chọn: <b>Min-stay</b>)</span>'
                                $(IdOrClass_Pn+' .pnChkFOC').html(strHtml)
                                $('.chkFOC',IdOrClass_Pn+' .pnChkFOC').prop('checked',true)
                                $('.chkFOC',IdOrClass_Pn+' .pnChkFOC').change(function(){
                                    GetTableFOCBook()
                                })


                            }else{
                                IsFOCCombine = false
                            }



                            $('#btnViewFilter3').click(function(e){
                                setTimeout(function(){
                                    GetViewHideTxt(IdOrClass_Pn)
                                },500)
                            })
                            GetViewHideTxt(IdOrClass_Pn)

                            GetTableFOCBook()
                            function GetTableFOCBook(){

                                if(IsFOCCombine){

                                    IsBookNotMinstay = $('.chkFOC',IdOrClass_Pn).is(':checked')

                                    GetArr_ListFOC({
                                        Arr_ListBook: Arr_ListBook,
                                        Arr_ListFoc: Arr_ListFoc,
                                        Obj_SearchDtl: Obj_SearchDtl,
                                        Is_BookNotMinstay: IsBookNotMinstay,
                                        OnSuccess: function (_arr) {
                                            Arr_ListFOCUse = _arr
                                            GetPanel_TotalPrice()
                                        }
                                    })
                                }

                                // var arr =  Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID==1 || (item.intFOCTypeID==2 && item.strItemTypeGUID.toUpperCase() == Obj_Detail.strItemTypeGUID.toUpperCase() ) })

                                if(Arr_ListFOCUse && Arr_ListFOCUse.length)
                                    pngPn.getTable2({
                                        objApi: null
                                        ,objParams_Cus: null
                                        ,editRltArr: function(_arr){
                                            return Arr_ListFOCUse
                                        }
                                        ,editRlt: function(value,key){

                                            value['No'] = (key + 1)

                                            value['dblUnitPrice_View'] = $.pngFormatPrice(value.dblUnitPrice)
                                            value['dblTotalPrice'] = value.dblUnitPrice*value.intQuantity
                                            value['dblTotalPrice_View'] = $.pngFormatPrice(value.dblTotalPrice)


                                        }
                                        ,objCols: {
                                            No: { name: '<span langkey="sys_Txt_No"></span>' }
                                            ,strName:{name: pngElm.getLangKey({langkey:'sys_Txt_Description'})}
                                            ,intQuantity:{name: pngElm.getLangKey({langkey:'sys_Txt_Quantity'})}
                                            ,dblUnitPrice_View:{name:'<span langkey="sys_Txt_Unitprice"></span>', strAttrTD:'style="text-align:right"'}
                                            ,dblTotalPrice_View:{name: '<span langkey="pg_Main_Supp_PPbook_TotalPrice"></span>', strAttrTD:'style="text-align:right"'}
                                        }

                                        ,customEvent:function(_idOrClassPnTbl){
                                            // $(_idOrClassPnTbl)
                                            // if( Arr_ListFOCUse.length > 1 && Arr_ListFOCUse.filter(function(item){ return item.IsNotCombinedFOC && item.intFOCTypeID == 1 }).length){

                                            //     $(_idOrClassPnTbl).find('tr th:first-child input').hide()

                                            //     $(_idOrClassPnTbl).find('tr td:first-child input').attr('type','radio').attr('name','intFOC')

                                            //     if(Arr_ListFOCUse.filter(function(item){ return item.IsEnableInput }).length==0){
                                            //         $('[row=0] .IsEnableInput',_idOrClassPnTbl).prop('checked',true).change()
                                            //     }


                                            // }else{

                                            //     $(_idOrClassPnTbl).find('tr th:first-child,tr td:first-child').remove()
                                            //     Arr_ListFOCUse.forEach(function(value){
                                            //         value.IsEnableInput = true
                                            //     })
                                            // }

                                            Arr_ListFOCUse.forEach(function(value,key){
                                                if( value.strItemTypeGUID ){
                                                    if( value.strItemTypeGUID.toUpperCase() == Obj_Detail.strItemTypeGUID.toUpperCase() ){
                                                        $('[row='+key+']', _idOrClassPnTbl).css('font-weight','bold')
                                                    }else{
                                                        // $('[row='+key+']', _idOrClassPnTbl).css('color','#909090')
                                                    }
                                                }
                                            })


                                        }
                                        , changeCkbMaster: function (_IsChecked, _intRowID, _arrList) {



                                            // if($(IdOrClass_Pn+' input[chkboxMaster="true"]:checked').length == 0){
                                            //     $(IdOrClass_Main+ " #pnListBtn .viewedit>span.intITs").text('')
                                            //     $(IdOrClass_Main+ " #pnListBtn .viewedit").hide()
                                            // }else{
                                            //     $(IdOrClass_Main+ " #pnListBtn .viewedit>span.intITs").text(' (' + $(IdOrClass_Pn+' input[chkboxMaster="true"]:checked').length + ')')
                                            //     $(IdOrClass_Main+ " #pnListBtn .viewedit").show()
                                            // }

                                            // _arrList.forEach(function(value,key){
                                            //     if(key == _intRowID && _IsChecked){
                                            //         value.IsEnableInput = true
                                            //     }else{
                                            //         value.IsEnableInput = false
                                            //     }
                                            // })

                                            Arr_ListFOCUse  = _arrList;

                                        }
                                        ,IsViewCheckBoxMain: false
                                        ,idOrClass: IdOrClass_Pn+' .pnListPrice'
                                    })
                                else{
                                    $(IdOrClass_Pn+' .pnListPrice').html('')
                                    if(!IsFOCCombine){
                                        $(IdOrClass_Pn).html('')
                                    }
                                }


                                // var arrTbl = []



                                // if(IsFOCCombine){
                                //     Arr_ListFOCUse.forEach(function(value){
                                //         value.IsEnableInput = 0
                                //     })
                                //     if($('.chkFOC',IdOrClass_Pn).is(':checked')){
                                //         arrTbl = Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID==1 })

                                //         arrTbl.forEach(function(value){
                                //             value.IsEnableInput = 1
                                //         })

                                //     }else{
                                //         arrTbl = Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID==2 && item.strItemTypeGUID.toUpperCase() == Obj_Detail.strItemTypeGUID.toUpperCase() })
                                //         Arr_ListFOCUse.forEach(function(value){
                                //             if(value.intFOCTypeID==2)
                                //                 value.IsEnableInput = 1
                                //         })
                                //     }
                                // }else{
                                //     arrTbl = arrTbl.concat( Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID==1 }) )
                                //     arrTbl = arrTbl.concat( Arr_ListFOCUse.filter(function(item){ return item.intFOCTypeID==2 }) )
                                //     arrTbl.forEach(function(value){
                                //         value.IsEnableInput = 1
                                //     })
                                // }
                            }



                        // }
                    }


                    function GetViewHideTxt(_idOrClassPn){
                        if($(_idOrClassPn).find('.panel-collapse').hasClass('in')){
                            // $(_idOrClassPn).find('a span').text(pngElm.getLangKey({langkey:'sys_Txt_HideLess'}))
                            $(_idOrClassPn).find('a i').attr('class','fa fa-chevron-up')
                        }else{
                            // $(_idOrClassPn).find('a span').text(pngElm.getLangKey({langkey:'sys_Txt_ViewMore'}))
                            $(_idOrClassPn).find('a i').attr('class','fa fa-chevron-down')
                        }
                    }


                    function GetPopUp_PayMethod(_Opt){
                        var Dft = {
                            objDetail: {},
                            ArrListAccount: [],
                            IsBankAcc:null,
                            //IsDuplicate:null,
                            OnSuccess: function () {

                            }
                        }
                        _Opt = $.extend(Dft, _Opt);

                        var IdOrClass_Main = ''

                        var Obj_Detail = _Opt.objDetail
                        //---------Obj_XXX      // Khai báo các biến dùng chung cho cả hàm
                        //---------Arr_XXX
                        //---------Is_XXX
                        //---------Int_XXX
                        //---------Str_XXX

                        // if(Object.keys(Obj_Detail).length){
                        //     Is_Edit = true
                        // }else{
                        //     Is_Create = true
                        // }
                        // if(options.IsDuplicate){
                        //     Is_Edit = false
                        //     Is_Duplicate = true
                        // }
                        var Arr_BankAccountGUID = _Opt.ArrListAccount


                        //------------------- Khái báo biển chính của giao diện
                        var Obj_Filter_Dtl = {}
                        var Obj_Filter = {}

                        var Obj_FormInput = {}
                        var Arr_ListTbl = []

                        var Obj_FN_Main = {}
                        //---------------
                        GetPopUp()
                        function GetPopUp(){
                            var strTitle = 'Config Payment method'
                            // if(Is_Create){
                            //     strTitle = pngElm.getLangKey({langkey:'sys_Btn_Create'})
                            // }

                            // if(Is_Edit){
                            //     strTitle = pngElm.getLangKey({langkey:'sys_Btn_Edit'})
                            // }
                            // if(Is_Duplicate){
                            //     strTitle = pngElm.getLangKey({langkey:'sys_Btn_Duplicate'})
                            // }
                            pngPn.getPopUp({
                                strTitle: strTitle
                                , intTypeSize:1//------------1 small ---2 medium ---3 large
                                , OnPanel: GetMainPanel
                                , OnClosePopUp: function () {
                                    //------Chọn sự kiện khi Đóng PopUP
                                    // options.OnSuccess.call()
                                    // _Opt.OnSuccess.call()
                                }
                            })
                        }

                        function GetMainPanel(_IdOrClassPp,_OnClosePp){

                            IdOrClass_Main = _IdOrClassPp
                            Obj_FN_Main.OnClosePp = _OnClosePp

                            //Obj_FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                            //Obj_FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}


                            var objPanel = {
                                pnMain:{tag:'div',attr:'class=""'
                                        ,childTags:[{div:'class="row"'}]
                                    // ,pnListBtn:{tag:'div',attr:'class="col-md-12"'}
                                    // ,pnFormFilter:{tag:'div',attr:'class="col-md-12"'}
                                    // ,pnTable:{tag:'div',attr:'class="col-md-12"'}

                                    ,pnForm:{tag:'div',attr:'class="col-md-12"'}
                                    ,pnBtn:{tag:'div',attr:'class="col-md-12"'}
                                }
                            }
                            var objEvtPanel = {}
                            objEvtPanel.pnForm = function(_idOrClassPn){
                                var IdOrClass_Pn = _idOrClassPn
                                Obj_FormInput = {
                                    ///-----------INSERT INPUT
                                    intPaymentMethodID:{title:'Payment Method',isRequire:false,attr:"class='col-md-6'",IsRtn:true
                                        ,input:{type:'select',classEx:'form-control',attr:''}
                                        ,dropDown:{arrList: $.pngGetArrComboValue(Arr_PaymentMethodID,'intID','strName') }
                                    },

                                    strCompanyBankAccountGUID:{title:'Bank Account',isRequire:false,attr:"class='col-md-6'",IsRtn:true
                                        ,input:{type:'select',classEx:'form-control',attr:''}
                                        ,dropDown:{arrList: $.pngGetArrComboValue(Arr_BankAccountGUID,'strCompanyBankAccountGUID','strNameDisplay') }
                                    },
                                    pnPayEx2:{title:'',attr:"class='col-md-12' style=''"
                                        ,input:{IsNoInput:true}
                                    },
                                }

                                pngPn.getForm({
                                    action: 1,
                                    objInput: Obj_FormInput,
                                    idOrClass: IdOrClass_Pn,
                                    objDetail: Obj_Detail,
                                })

                                if(_Opt.IsBankAcc){
                                    $('.intPaymentMethodID',IdOrClass_Pn).parent().hide()
                                }

                                // $('.pnElm-pnAmount',IdOrClass_Pn).html(Dbl_VATAmount)

                                // $('input',IdOrClass_Pn).change(function(){
                                //     Dbl_VATAmount = Obj_Detail.dblTotalPrice/100*this.value
                                //     $('.pnElm-pnAmount',IdOrClass_Pn).html(Dbl_VATAmount)
                                // })
                                $('.intPaymentMethodID',IdOrClass_Pn).change(function(){
                                    if(this.value != 1){
                                        $('.strCompanyBankAccountGUID',IdOrClass_Pn).parent().hide()
                                    }else{
                                        $('.strCompanyBankAccountGUID',IdOrClass_Pn).parent().show()
                                    }

                                    // $('input',IdOrClass_Pn).attr('disabled',(this.value == 1))
                                }).change()

                                $('.strCompanyBankAccountGUID',IdOrClass_Pn).change(function(){
                                    GetPanelAccount(this.value)
                                }).change()

                                function GetPanelAccount(_strCompanyBankAccountGUID){
                                        var obj = Arr_BankAccountGUID.filter(function(item){ return item.strCompanyBankAccountGUID == _strCompanyBankAccountGUID })[0]

                                        strHtml =''
                                        strHtml+='<div class="pn-margin-b-15"> '
                                        strHtml+='<b>Account Name:</b> '+obj.strCompanyBankAccountName
                                        strHtml+='<br><b>Account Code:</b> '+obj.strCompanyBankAccountCode
                                        strHtml+='<br><b>Bank Name:</b> '+obj.strCompanyBankAccountInfo
                                        strHtml+='<br><b>Bank Add:</b> '+obj.strBankAddress
                                        strHtml+='<br><b>SwiftCode:</b> '+obj.strSwiftCode
                                        strHtml+='</div> '

                                        $('.pnElm-pnPayEx2 ', IdOrClass_Pn).html(strHtml)

                                }

                            }
                            objEvtPanel.pnBtn = function(_idOrClassPn){
                                var IdOrClass_Pn = _idOrClassPn

                                var strHtml = ''
                                    strHtml+='<button id="btnSave" class="btn btn-texticon bg-primary txt-white"><i class="fa fa-floppy-o"></i><span>'+pngElm.getLangKey({langkey:'sys_Btn_Save'})+'</span></button>'
                                $(IdOrClass_Pn).html(strHtml)

                                $(IdOrClass_Pn+ ' #btnSave').click(function(){
                                    pngPn.getForm({
                                        action: 2,
                                        objInput: Obj_FormInput,
                                        idOrClass: IdOrClass_Main + ' #pnForm',
                                        OnChkSuccess: function(objRtn){
                                            if (objRtn) {

                                                // objRtn = $.pngExtendObj(Obj_Detail,objRtn)

                                                if(objRtn.intPaymentMethodID != 1)
                                                    objRtn.strCompanyBankAccountGUID = null

                                                Obj_FN_Main.OnClosePp(false,true)
                                                _Opt.OnSuccess.call(this,objRtn)
                                            }


                                        }
                                    })
                                })
                            }
                            // ===================================

                            pngPn.getPanelHtml({            // Get ra panel dạng html
                                objPanel: objPanel
                                ,objEvtPanel: objEvtPanel
                                ,idOrClass: IdOrClass_Main  // Id or class chính
                                ,OnChangeIdPn: function(_Fn){
                                    Obj_FN_Main.pnMain = _Fn    // Hàm đổi trang
                                }
                            })



                        }
                    }

                    function GetPanel_TotalPrice(){
                        var dblTotalPriceAll = Obj_Detail.dblTotalPrice
                        var dblTotalComPriceAll = Obj_Detail.dblTotalComPrice

                        if(Arr_Surcharge && Arr_Surcharge.length){
                            var arr = Arr_Surcharge.filter(function(item) { return item.IsEnableInput })


                            Obj_Detail['arrSurcharge'] = arr

                            arr.forEach(function(value){
                                dblTotalPriceAll+=value.dblTotalPrice
                            })
                        }

                        if(Arr_ListChild && Arr_ListChild.length){

                            var arr = Arr_ListChild.filter(function(item) { return item.IsEnableInput })


                            Obj_Detail['arrChildAge'] = arr

                            arr.forEach(function(value){
                                dblTotalPriceAll+=(value.dblTotalPrice || 0)
                                dblTotalComPriceAll+=(value.dblTotalComPrice || 0)
                            })
                        }

                        if(Arr_ListFOCUse && Arr_ListFOCUse.length){

                            Arr_ListFOCUse.forEach(function(value){
                                dblTotalPriceAll+=(value.dblTotalPrice || 0)
                            })
                        }


                        Obj_Detail['dblTotalPriceAll'] = dblTotalPriceAll
                        Obj_Detail['dblTotalComPriceAll'] = dblTotalComPriceAll



                        var arr = Arr_OrderPaymentTerm.filter(function(item){ return item.IsInstantTerm })

                        if(arr.length){
                            Arr_OrderPaymentTerm = arr
                        }

                        var Dbl_PriceCharge = 0
                        Arr_OrderPaymentTerm.forEach(function(value){

                            var strFromDate = moment(Obj_SearchDtl.dtmDateCheckIn).add('days', 0 - value.intDayTo).format('l')
                            var strToDate = moment(Obj_SearchDtl.dtmDateCheckIn).add('days', 0 - value.intDayFrom).format('l')
                            var dblPriceCharge = dblTotalPriceAll/100 * value['dblPaymentPercentage']

                            if(value.IsDepositOnBook){
                                strFromDate = moment().format('l')
                                strToDate = moment().add(value.intHourInHold,'h').format('l')
                            }
                            // value['strFromDate'] = $.pngFormatDateTime(strFromDate)
                            // value['strToDate'] = $.pngFormatDateTime(strToDate)
                            // value['dblPaymentPrice'] = $.pngFormatPrice( dblPriceCharge ) +(value.IsDepositOnBook? ' (Deposit)' : '')


                            if( (new Date(moment(strFromDate)) <= new Date(moment().format('l')) && new Date(moment(strToDate)) >= new Date(moment().format('l')) )
                                || new Date(moment(strToDate)) <= new Date(moment().format('l'))
                            ){
                                // value['IsPayment'] = true
                                Dbl_PriceCharge+= dblPriceCharge
                            }
                        })

                        $('.pnPayment .dblSumRemain').html($.pngFormatPrice(Dbl_PriceCharge))
                        $('.pnPayment .txtComPricePay').html($.pngFormatPrice(0))

                    }

                }

                function GetArr_ListFOC(_Opt){
                    var Dft = {
                        Arr_ListBook: null,
                        Arr_ListFoc: null,
                        Obj_SearchDtl:{},
                        Is_BookNotMinstay:null,
                        OnSuccess: function () {

                        }
                    }
                    _Opt = $.extend(Dft, _Opt);

                    var Arr_ListBook= _Opt.Arr_ListBook
                    var Arr_ListFoc= _Opt.Arr_ListFoc
                    var Obj_SearchDtl= _Opt.Obj_SearchDtl


                    var IntNoOfNight = moment(Obj_SearchDtl.dtmDateCheckOut).diff(moment(Obj_SearchDtl.dtmDateCheckIn),'days')


                    var ArrListForFOC = Arr_ListFoc.filter(function(item){ return item.intFOCTypeID==1 })
                    var ArrListForMinstay = Arr_ListFoc.filter(function(item){ return item.intFOCTypeID==2 })

                    var Arr_ListBookFOC = []

                    // var arrFOC = []

                    ArrListForFOC.forEach(function(value){
                        var intFOCPax = 0
                        var strName = ''
                        var dblUnitPrice = 0

                        if(value.intUomID==1){//-----Room
                            Arr_ListBook.forEach(function(val){
                                intFOCPax+= parseFloat(val.intQuantity)

                                var dblUnitPriceItem = 0

                                Arr_ListDate.forEach(function(val2) {
                                    if(moment(value.dtmDateFrom) <= moment($.pngFormatDateTime(val2.dtmDate,'l')) && moment(value.dtmDateTo) >= moment($.pngFormatDateTime(val2.dtmDate,'l'))){

                                        val['arrListPrice'].forEach(function(val3) {

                                            if(val3.strPriceSeasonGUID == val2.strPriceSeasonGUID){
                                                dblUnitPriceItem+=val3.dblUnitPrice
                                            }

                                        });

                                    }
                                })


                                if(!dblUnitPrice || dblUnitPrice > dblUnitPriceItem)
                                    dblUnitPrice = dblUnitPriceItem
                            })

                            strName='Đặt '+value.intFOCPax+' phòng được '+value.dblFOCGet+' FOC('+(value.dblFOCMax? 'tối đa được '+value.dblFOCMax+' FOC': 'Không giới hạn FOC' )+')'
                        }
                        if(value.intUomID==3){//-----Pax
                            intFOCPax = Obj_SearchDtl.intNoAdult + Obj_SearchDtl.arrChildren.filter(function(item){ return item > 2 }).length
                        }

                        if(value.intFOCPax <= intFOCPax){

                            var intQuantity = value.dblFOCGet * parseInt(intFOCPax/value.intFOCPax)

                            if(value.dblFOCMax && intQuantity>value.dblFOCMax)
                                intQuantity = value.dblFOCMax

                            var obj = $.pngExtendObj(value,{
                                strName: strName,
                                intQuantity: -1*intQuantity,
                                dblUnitPrice: dblUnitPrice
                            })



                            if(_Opt.Is_BookNotMinstay == null || _Opt.Is_BookNotMinstay == true)
                                Arr_ListBookFOC.push(obj)
                        }

                    })

                    // if(arrFOC.length)
                    //     Arr_ListBookFOC = JSON.parse(JSON.stringify(arrFOC))


                    ArrListForMinstay.forEach(function(value){
                        var strItemTypeGUID = ''

                        var arr = Arr_ListBook

                        if(value.strItemTypeGUID)
                            arr = Arr_ListBook.filter(function(item){ return item.strItemTypeGUID.toUpperCase() == value.strItemTypeGUID.toUpperCase() })

                        arr = JSON.parse(JSON.stringify(arr))

                        arr.sort(function (a, b) {
                            return a['No'] - b['No'];
                        });


                        arr.forEach(function(val){

                            if(strItemTypeGUID!=val.strItemTypeGUID){
                                strItemTypeGUID=val.strItemTypeGUID

                                var intFOCPax = 0
                                var dblUnitPrice = 0

                                Arr_ListDate.forEach(function(val2) {
                                    if(moment(value.dtmDateFrom) <= moment($.pngFormatDateTime(val2.dtmDate,'l')) && moment(value.dtmDateTo) >= moment($.pngFormatDateTime(val2.dtmDate,'l'))){
                                        intFOCPax++
                                        val['arrListPrice'].forEach(function(val3) {

                                            if(val3.strPriceSeasonGUID == val2.strPriceSeasonGUID){

                                                if(!dblUnitPrice || dblUnitPrice > val3.dblUnitPrice)
                                                    dblUnitPrice = val3.dblUnitPrice
                                            }

                                        });


                                    }
                                })

                                if(value.intFOCPax <= intFOCPax){
                                    var intQuantity = (value.intFOCPax - value.dblFOCGet) * parseInt(intFOCPax/value.intFOCPax)

                                    var strName='Đặt '+value.intFOCPax+' đêm trả tiền '+value.dblFOCGet+' đêm('+val.strItemTypeName+')'

                                    var intNoOfRooms = 0

                                    var arrItemType = arr.filter(function(item){ return item.strItemTypeGUID.toUpperCase() == val.strItemTypeGUID.toUpperCase() })
                                    arrItemType.forEach(function(val2){
                                        intNoOfRooms+=val2.intQuantity.getNumber()
                                    })

                                    var obj = $.pngExtendObj(value,{
                                        strName: strName,
                                        intQuantity: -1*intQuantity*intNoOfRooms,
                                        dblUnitPrice: dblUnitPrice,
                                        strItemTypeGUID:strItemTypeGUID
                                    })

                                    if(_Opt.Is_BookNotMinstay == null || _Opt.Is_BookNotMinstay == false)
                                        Arr_ListBookFOC.push(obj)

                                }



                            }



                        })


                        // if(value.intFOCPax <= IntNoOfNight){
                        //     arrFOC.push(value)
                        // }
                    })
                    // if(arrFOC.length)
                    //     ArrListForMinstay = JSON.parse(JSON.stringify(arrFOC))
                    // else
                    //     ArrListForMinstay = []


                    // ArrListForMinstay.forEach(function(value){



                    //     var strName = ''
                    //     var dblUnitPrice = 0
                    //     var strItemTypeGUID = ''

                    //     var arr = Arr_ListBook

                    //     if(value.strItemTypeGUID)
                    //         arr = Arr_ListBook.filter(function(item){ return item.strItemTypeGUID.toUpperCase() == value.strItemTypeGUID.toUpperCase() })

                    //     arr = JSON.parse(JSON.stringify(arr))

                    //     arr.sort(function (a, b) {
                    //         return a['No'] - b['No'];
                    //       });

                    //     arr.forEach(function(val){
                    //         dblUnitPrice = 0
                    //         if(strItemTypeGUID!=val.strItemTypeGUID){
                    //             strItemTypeGUID=val.strItemTypeGUID

                    //             val['arrListPrice'].forEach(function(val2){
                    //                 if(!dblUnitPrice || dblUnitPrice > val2.dblUnitPrice)
                    //                     dblUnitPrice = val2.dblUnitPrice
                    //             })

                    //             strName='Đặt '+value.intFOCPax+' đêm trả tiền '+value.dblFOCGet+' đêm('+val.strItemTypeName+')'


                    //             // if(value.intFOCPax <= IntNoOfNight){

                    //                 var intQuantity = (value.intFOCPax - value.dblFOCGet) * parseInt(IntNoOfNight/value.intFOCPax)

                    //                 var intNoOfRooms = 0

                    //                 var arrItemType = arr.filter(function(item){ return item.strItemTypeGUID.toUpperCase() == val.strItemTypeGUID.toUpperCase() })
                    //                 console.log(arrItemType)
                    //                 arrItemType.forEach(function(val2){
                    //                     intNoOfRooms+=val2.intQuantity.getNumber()
                    //                 })

                    //                 var obj = $.pngExtendObj(value,{
                    //                     strName: strName,
                    //                     intQuantity: -1*intQuantity*intNoOfRooms,
                    //                     dblUnitPrice: dblUnitPrice,
                    //                     strItemTypeGUID:strItemTypeGUID
                    //                 })

                    //                 if(_Opt.Is_BookNotMinstay == null || _Opt.Is_BookNotMinstay == false)
                    //                     Arr_ListBookFOC.push(obj)
                    //             // }

                    //         }

                    //     })


                    // })

                    _Opt.OnSuccess.call(this,Arr_ListBookFOC)


                }



                function GetPopUp_ChangeMealIncludeType(_Opt){
                    var Dft = {
                        arrList: [],
                        objDetail: {},
                        OnSuccess: function () {

                        }
                    }
                    _Opt = $.extend(Dft, _Opt);

                    var IdOrClass_Main = ''

                    var Obj_Detail = _Opt.objDetail

                    //---------Obj__XXX      // Khai báo các biến dùng chung cho cả hàm
                    //---------Arr__XXX
                    //---------Is__XXX
                    //---------Int__XXX
                    //---------Str__XXX



                    //------------------- Khái báo biển chính của giao diện
                    var Obj__Filter_Dtl = {}
                    var Obj__Filter = {}

                    // var Obj_FormInput = {}
                    var Arr_ListTbl = _Opt.arrList

                    var Obj_FN_Main = {}
                    //-------------------


                    GetPopUp()

                    function GetPopUp(){
                        pngPn.getPopUp({
                            strTitle: 'Change meal included type'
                            , intTypeSize:1//------------1 small ---2 medium ---3 large
                            , OnPanel: GetMainPanel
                            , OnClosePopUp: function () {
                                //------Chọn sự kiện khi Đóng PopUP
                            }
                        })
                    }

                    function GetMainPanel(_IdOrClassPp,_OnClosePp){

                        IdOrClass_Main = _IdOrClassPp
                        Obj_FN_Main.OnClosePp = _OnClosePp

                        // Obj_FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                        // Obj_FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}


                        var objPanel = {
                            pnMain:{tag:'div',attr:'class=""'
                                    ,childTags:[{div:'class="row"'}]
                                ,pnContent:{tag:'div',attr:'class="col-md-12"'}
                                ,pnForm:{tag:'div',attr:'class="col-md-12"'}
                                ,pnBtn:{tag:'div',attr:'class="col-md-12"'}
                            }
                        }

                        var objEvtPanel = {}
                        objEvtPanel.pnContent = function(_idOrClassPn){
                            var IdOrClass_Pn = _idOrClassPn

                            var strHtml = ''
                            strHtml+= '<div class="pn-margin-b-15">'
                            strHtml+= Obj_Detail.strItemTypeName
                            strHtml+= '</div>'
                            $(IdOrClass_Pn).html(strHtml)
                        }

                        objEvtPanel.pnForm = function(_idOrClassPn){
                            var IdOrClass_Pn = _idOrClassPn
                            Obj_Detail.intMealIncludedTypeID = Obj_Detail.intMealIncludedTypeID.toString()
                            Obj_FormInput = {
                                ///-----------INSERT INPUT
                                intMealIncludedTypeID:{title:'Meal include type',attr:"class='col-md-12'",isRequire:true,IsRtn:true
                                    ,listCheckbox:{arrList: $.pngGetArrComboValue(Arr_ListTbl,'intMealIncludedTypeID','strMealIncludedTypeName') ,formatItem:'<span style="margin-right:15px;display:inline-block">{chk} {tit}</span>',IsCheckAll:false,splitReturn:','}
                                },
                            }

                            pngPn.getForm({
                                action: 1,
                                objInput: Obj_FormInput,
                                idOrClass: IdOrClass_Pn,
                                objDetail: Obj_Detail,
                            })

                            $('input',IdOrClass_Pn).attr('type','radio').attr('name','meal')

                        }
                        objEvtPanel.pnBtn = function(_idOrClassPn){
                            var IdOrClass_Pn = _idOrClassPn

                            var strHtml = ''
                                strHtml+='<button id="btnSave" class="btn btn-texticon bg-primary txt-white"><i class="fa fa-floppy-o"></i><span>'+pngElm.getLangKey({langkey:'sys_Btn_Save'})+'</span></button>'
                            $(IdOrClass_Pn).html(strHtml)

                            $(IdOrClass_Pn+ ' #btnSave').click(function(){
                                pngPn.getForm({
                                    action: 2,
                                    objInput: Obj_FormInput,
                                    idOrClass: IdOrClass_Main + ' #pnForm',
                                    OnChkSuccess: function(objRtn){
                                        if (objRtn) {


                                            Obj_FN_Main.OnClosePp(false,true)
                                            _Opt.OnSuccess.call(this,objRtn.intMealIncludedTypeID)

                                        }


                                    }
                                })
                            })
                        }
                        // ===================================

                        pngPn.getPanelHtml({            // Get ra panel dạng html
                            objPanel: objPanel
                            ,objEvtPanel: objEvtPanel
                            ,idOrClass: IdOrClass_Main  // Id or class chính
                            ,OnChangeIdPn: function(_Fn){
                                Obj_FN_Main.pnMain = _Fn    // Hàm đổi trang
                            }
                        })



                    }
                }
            }


            $.ModuleMainLead_Hotel_Detail_PopUpAllotment = function (options) {
                var defaults = {
                    strUserGUID: null
                    , strCompanyPartnerGUID: null
                    , strCompanyOwnerGUID: null
                    , intAdult: null
                    , arrChildren: []
                    , dtmDateFrom: null
                    , dtmDateTo: null
                    , strPriceLevelGUID: null
                    , strPriceListGUID: null
                    , strListItemTypeGUID: null
                    , strListSupplierChildAgeGUID: null
                    , strListSurchargeDateGUID: null
                    , strListFocGUID: null
                    , dblTotalPrice: null
                    , dblTotalComPrice: null
                    , Arr_ListBook: null
                    , Arr_ListBookFOC: null
                    , OnSuccess: function () {

                    }
                }
                options = $.extend(defaults, options);

                var IdOrClass_Main = ''


                //---------Obj_XXX
                //---------Arr_XXX
                //---------Is_XXX
                //---------Int_XXX
                //---------Str_XXX
                var Obj_TourDetail = options.objTourDetail


                var Arr_ListBook = options.Arr_ListBook
                var Arr_ListBookFOC = options.Arr_ListBookFOC


                var Str_ReturnUrl = png.ObjClnUrl.APPB2B_Agent
                Str_ReturnUrl = $.pngGetQSVal('cname', $.pngGetQSVal('cname'), Str_ReturnUrl)
                Str_ReturnUrl = $.pngGetQSVal('page', 'payonline-return', Str_ReturnUrl)
                Str_ReturnUrl = $.pngGetQSVal('IsBooking', 'AddTourToBooking', Str_ReturnUrl)

                var xmlNoOfChild = ''
                options.arrChildren.forEach(function (value) {
                    xmlNoOfChild += '<child>' + value + '</child>'
                })



                var ObjList_Api = {
                    GetFilterCompanyBankAccount: {
                        strApiLink: 'api/user/GetFilterCompanyBankAccount'
                        , objParams: {
                            strAgentCode: null
                            , strWhere: null
                            , strOrder: null
                            , strCompanyGUID: options.strCompanyOwnerGUID
                            , intCurPage: null
                            , intPageSize: null
                            , tblsReturn: null
                        }
                    },
                    GetUrlPayOnline: {
                        strApiLink: 'api/payonline/GetUrlPayOnline'
                        , objParams: {
                            strOrderBeforePaymentCode: null
                            , strReturnUrl: Str_ReturnUrl
                            , dblAmount: 0
                            , strDescription: "payment online"
                        }
                    },
                    // GetCheckRemainCreditForAddTourToBookingByAgent:{
                    //     strApiLink:'api/tour/GetCheckRemainCreditForAddTourToBookingByAgent'
                    //     ,objParams:{
                    //         strUserGUID: options.strUserGUID
                    //         ,strCompanyGUID: options.strCompanyPartnerGUID
                    //         ,strBookingGUID: options.strBookingGUID
                    //         ,strTourGUID: options.strTourGUID
                    //         ,strPaxBookingTourCode: options.strPaxBookingTourCode
                    //         ,strPaxDailyBookingTourCode: options.strPaxDailyBookingTourCode
                    //         ,dblPriceTotal: options.dblTotalPrice
                    //     }
                    // },

                    // GetCheckRemainForServicesBooking:{
                    //     strApiLink:'api/tour/GetCheckRemainForServicesBooking'
                    //     ,objParams:{
                    //         strUserGUID: options.strUserGUID
                    //         ,strBookingGUID: options.strBookingGUID
                    //         ,intCateID: Obj_TourDetail.intCateID
                    //         ,strTourGUID:options.strTourGUID
                    //         ,strPaxBookingTourCode: options.strPaxBookingTourCode
                    //         ,strPaxDailyBookingTourCode: options.strPaxDailyBookingTourCode
                    //         ,dtmDateStart: options.dtmDateFrom
                    //     }
                    // },

                    // AddPaymentTransactionByAgent:{
                    //     strApiLink:'api/booking/AddPaymentTransactionByAgent'
                    //     ,objParams:{
                    //         strUserGUID: options.strUserGUID
                    //         ,strOrderBookingCode : options.strOrderBookingCode
                    //         ,intOrderStatusID: 4
                    //         ,dblPaymentTransactionAmount : null
                    //     }
                    // },
                    // AddBookingItemForTour:{
                    //     strApiLink:'api/booking/AddBookingItemForTour'
                    //     ,objParams:{
                    //         strUserGUID : options.strUserGUID
                    //         ,strTourGUID : options.strTourGUID
                    //         ,strBookingGUID : options.strBookingGUID
                    //         ,strTourPriceItemLevelGUID : options.strTourPriceItemLevelGUID
                    //         ,strDepartureTourLevelGUID : options.strDepartureTourLevelGUID
                    //         ,strPaxBookingTourCode : options.strPaxBookingTourCode
                    //         ,strCompanyPartnerGUID : options.strCompanyPartnerGUID
                    //         ,strCompanyOwnerGUID : options.strCompanyOwnerGUID
                    //         ,dtmDateFrom : options.dtmDateFrom
                    //         ,dtmDateTo : options.dtmDateTo
                    //         ,intPaymentMethodID : null
                    //         ,strCompanyBankAccountGUID : null
                    //         ,strPaidRemark : null
                    //     }
                    // },
                    AddBookingForHotelInstant: {
                        strApiLink: 'api/booking/AddBookingForHotelInstant'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierGUID: $.pngGetQSVal("idmdit")
                            , strCompanyPartnerGUID: options.strCompanyPartnerGUID
                            , strCompanyOwnerGUID: options.strCompanyOwnerGUID

                            , intAdult: options.intAdult
                            , xmlNoOfChild: xmlNoOfChild
                            // ,strListSupplierMappingPriceGUID: options.strListSupplierMappingPriceGUID
                            // ,strListChildSupplierMappingPriceGUID: options.strListChildSupplierMappingPriceGUID
                            // ,strListSurchargeDateGUID: options.strListSurchargeDateGUID
                            , strPriceLevelGUID: options.strPriceLevelGUID
                            , strPriceListGUID: options.strPriceListGUID
                            , strListItemTypeGUID: options.strListItemTypeGUID
                            , strListSupplierChildAgeGUID: options.strListSupplierChildAgeGUID
                            , strListSurchargeDateGUID: options.strListSurchargeDateGUID
                            , strListFocGUID: options.strListFocGUID

                            , dtmDateFrom: options.dtmDateFrom
                            , dtmDateTo: options.dtmDateTo

                            , intPaymentMethodID: null
                            , strCompanyBankAccountGUID: null
                            , strPaidRemark: null
                        }
                    },

                    GetListSupplierPaymentTerm: {
                        strApiLink: 'api/public/supplier/GetListSupplierPaymentTerm'
                        , objParams: {
                            strUserGUID: options.strUserGUID
                            , strSupplierPaymentTermGUID: null
                            , strCompanyGUID: null
                            , strSupplierGUID: Obj_Detail.strSupplierGUID
                            , dtmCheckInDate: null
                            , intProductIDForBook: null
                            , intCurPage: null
                            , intPageSize: null
                            , strOrder: 'IsDepositOnBook desc,intDayTo desc'
                            , tblsReturn: '[0]'
                        }
                    },
                }

                var ObjList_ComboValue = {
                    Arr_ValCode: {
                        strCombocode: ''
                    }
                    , Arr_SQL: {
                        strTableName: ''
                        , strFeildSelect: ' AS intID, AS strName'
                        , strWhere: 'WHERE IsActive = 1'
                    }
                }


                var Arr_TourPaymentTerm = []
                var Arr_ListAccount = []
                var Arr_PaymentMethod = []

                var Obj_Payment = {}
                var Obj_PaymentAmountAndPeriod = {}


                var Obj_ListArrListAcount = {}
                var Dbl_PriceCharge = 0

                //---------
                var Obj_FormInput = {}
                var Obj_FN_Main = {}
                //---------

                png.postListApiGetValue({
                    objList_Api: ObjList_Api
                    , objList_ComboValue: ObjList_ComboValue
                    , objListApi_RtnVal: {
                        'GetListSupplierPaymentTerm': {
                            objParams_Cus: {
                            }
                            , OnSuccess: function (data) {
                                Arr_TourPaymentTerm = JSON.parse(data)[0]
                                Dbl_PriceCharge = 0

                                var arr = Arr_TourPaymentTerm.filter(function (item) { return item.IsInstantTerm })

                                if (arr.length) {
                                    Arr_TourPaymentTerm = arr
                                }

                                Arr_TourPaymentTerm.forEach(function (value) {

                                    var strFromDate = moment(options.dtmDateFrom).add('days', 0 - value.intDayTo).format('l')
                                    var strToDate = moment(options.dtmDateFrom).add('days', 0 - value.intDayFrom).format('l')
                                    var dblPriceCharge = options.dblTotalPrice / 100 * value['dblPaymentPercentage']

                                    if (value.IsDepositOnBook) {
                                        strFromDate = moment().format('l')
                                        strToDate = moment().add(value.intHourInHold, 'h').format('l')
                                    }

                                    value['strFromDate'] = $.pngFormatDateTime(strFromDate)
                                    value['strToDate'] = $.pngFormatDateTime(strToDate)
                                    value['dblPaymentPrice'] = $.pngFormatPrice(dblPriceCharge) + (value.IsDepositOnBook ? ' (Deposit)' : '')


                                    if ((new Date(moment(strFromDate)) <= new Date(moment().format('l')) && new Date(moment(strToDate)) >= new Date(moment().format('l')))
                                        || new Date(moment(strToDate)) <= new Date(moment().format('l'))
                                    ) {
                                        value['IsPayment'] = true
                                        Dbl_PriceCharge += dblPriceCharge
                                    }
                                })
                                // return JSON.parse(data)[0]
                            }
                        }
                    }
                    , objListComboValue_RtnVal: {
                        'Arr_SQL': {
                            objParams_Cus: {
                                strTableName: 'OB12'
                                , strFeildSelect: 'OB12_PaymentMethodID AS intID,OB12_PaymentMethodName AS strName'
                                , strWhere: 'WHERE IsActive=1 AND OB12_PaymentMethodID<>3 ORDER BY OB12_Order'
                            },
                            OnSuccess: function (data) {
                                Arr_PaymentMethod = data   // Dữ liệu trả về từ dropdownlist trên
                            }
                        }
                    }
                    , OnSuccessList: function (data) {


                        Obj_PaymentAmountAndPeriod = {
                            IsPayment: true
                        }
                        if (Dbl_PriceCharge == 0) {
                            Obj_PaymentAmountAndPeriod.IsPayment = false
                        }
                        GetPopUp()
                    }
                })

                // GetPopUp()
                function GetPopUp() {
                    pngPn.getPopUp({
                        strTitle: 'Instant Booking'
                        , intTypeSize: 1//------------1 small ---2 medium ---3 large
                        , OnPanel: GetMainPanel
                        , OnClosePopUp: function () {
                            //------Chọn sự kiện khi Đóng PopUP
                        }
                    })
                }

                function GetMainPanel(_IdOrClassPp, _OnClosePp) {

                    IdOrClass_Main = _IdOrClassPp
                    Obj_FN_Main.OnClosePp = _OnClosePp
                    console.log(Obj_TourDetail)

                    // Obj_FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                    // Obj_FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}

                    var objPanel = {
                        pnMain: {
                            tag: 'div', attr: 'class=""', childTags: [{ div: 'class="row"' }]
                            , pnTable: { tag: 'div', attr: 'class="col-md-12"' }
                            , pnContent: { tag: 'div', attr: 'class="col-md-12 pn-padding-t-15" style="border-bottom:1px solid #ccc"' }
                            , pnBtn: { tag: 'div', attr: 'class="col-md-12"' }
                        }
                    }

                    var objEvtPanel = {}
                    objEvtPanel.pnTable = function (_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = ''
                        strHtml += '<div class="pnList"></div>'
                        // strHtml+= '<div id="pnListChild"></div>'
                        // strHtml+= '<div id="pnSurcharge"></div>'

                        $(IdOrClass_Pn).html(strHtml)


                        strHtml = ''
                        Arr_ListBook.forEach(function (Obj_Rtn) {
                            strHtml += '<div style="padding-bottom: 15px;margin-bottom: 15px;border-bottom: 1px solid #ccc;">'
                            strHtml += '<div>'
                            strHtml += '<b>' + Obj_Rtn.strItemTypeName + ' - ' + Obj_Rtn.strSglDblName + '</b>'
                            strHtml += ' (' + Obj_Rtn.intQuantity + ' x ' + $.pngFormatPrice(Obj_Rtn.dblUnitPrice) + ')'
                            strHtml += '</div>'
                            strHtml += '<div> '

                            strHtml += '<div><b>' + pngElm.getLangKey({ langkey: 'sys_Txt_CheckIn' }) + ' - ' + pngElm.getLangKey({ langkey: 'sys_Txt_CheckOut' }) + ': </b></div>'
                            strHtml += '<div> ' + $.pngFormatDateTime(options.dtmDateFrom) + ' - ' + $.pngFormatDateTime(options.dtmDateTo) + '</div>'
                            if (Obj_Rtn.arrChildAge && Obj_Rtn.arrChildAge.length) {
                                strHtml += '<div><b>' + pngElm.getLangKey({ langkey: 'sys_Txt_ChildAge' }) + '</b></div>'
                                Obj_Rtn.arrChildAge.forEach(function (value, key) {
                                    strHtml += '<div> - <b>' + value.strChildAge + '</b>: ' + value.intQuantity + ' x ' + $.pngFormatPrice(value.dblUnitPrice) + '</div>'
                                })
                            }
                            if (Obj_Rtn.arrSurcharge && Obj_Rtn.arrSurcharge.length) {
                                strHtml += '<div><b>Surcharge</b></div>'
                                Obj_Rtn.arrSurcharge.forEach(function (value, key) {
                                    strHtml += '<div> - <b>' + value.strSurchargeName + '</b>: ' + value.intQuantity + ' x ' + $.pngFormatPrice(value.dblUnitPrice) + '</div>'
                                })
                            }
                            strHtml += '</div> '
                            // if(Obj_Rtn.arrFOC && Obj_Rtn.arrFOC.length){
                            //     strHtml+= '<div><b>FOC</b></div>'
                            //     Obj_Rtn.arrFOC.forEach(function(value,key){
                            //         strHtml+= '<div> - <b>'+value.strName+'</b>: '+value.intQuantity+' x '+$.pngFormatPrice(value.dblUnitPrice)+'</div>'
                            //     })
                            // }
                            strHtml += '</div>'
                        })

                        if (Arr_ListBookFOC.length) {
                            strHtml += '<div ><b>FOC</b></div>'
                            Arr_ListBookFOC.forEach(function (value) {
                                strHtml += '<div> - <b>' + value.strName + '</b>: ' + value.intQuantity + ' x ' + $.pngFormatPrice(value.dblUnitPrice) + '</div>'

                            })
                        }

                        $(IdOrClass_Pn).html(strHtml)

                        // console.log( Arr_PriceRoom)
                        // console.log( Arr_PriceChildAge)
                        // console.log( Arr_Surcharge )

                        // var ArrPriceTableItem = []

                        // Arr_PriceRoom.forEach(function(value){
                        //     var obj = {
                        //         strServiceName_View: value.strItemTypeName+' -- '+value.strSglDblName
                        //         // ,strBookingDateFrom: ''
                        //         // ,strBookingDateTo: ''
                        //         ,intTotalPax_View: value.intNoOfRooms
                        //         ,dblPriceUnitView: $.pngFormatPrice(value.dblUnitPrice)
                        //         ,dblPriceTotalView: $.pngFormatPrice(value.dblTotalPrice)
                        //     }
                        //     ArrPriceTableItem.push(obj)
                        // })


                        // Arr_PriceChildAge.forEach(function(value){
                        //     var obj = {
                        //         strServiceName_View: 'Child Age: ['+value.dblAgeFrom+' - '+value.dblAgeTo+']'
                        //         // ,strBookingDateFrom: ''
                        //         // ,strBookingDateTo: ''
                        //         ,intTotalPax_View: value.intQuantity
                        //         ,dblPriceUnitView: $.pngFormatPrice(value.dblUnitPrice)
                        //         ,dblPriceTotalView: $.pngFormatPrice(value.dblTotalPrice)
                        //     }
                        //     ArrPriceTableItem.push(obj)
                        // })

                        // Arr_Surcharge.forEach(function(value){
                        //     var obj = {
                        //         strServiceName_View: value.strIncludeTypeName+' - '+value.strPerPaxName
                        //         // ,strBookingDateFrom: ''
                        //         // ,strBookingDateTo: ''
                        //         ,intTotalPax_View: value.intQuantity
                        //         ,dblPriceUnitView: $.pngFormatPrice(value.dblUnitPrice)
                        //         ,dblPriceTotalView: $.pngFormatPrice(value.dblTotalPrice)
                        //     }
                        //     ArrPriceTableItem.push(obj)
                        // })

                        // pngPn.getTable2({
                        //     objApi:null
                        //     ,objParams_Cus:null
                        //     ,editRltArr: function(arr){
                        //         return ArrPriceTableItem
                        //     }
                        //     ,editRlt: function(value,key){
                        //         value['No'] = (key+1)
                        //     }
                        //     ,objCols: {'No':{name:'<span langkey="sys_Txt_Tbl-No"></span>'}
                        //         ,strServiceName_View: {name:'<span langkey="pg_Dft_TC_OrDtl_ServiceName"></span>'}
                        //         // ,strDtmDateFreeCancellation: {name: pngElm.getLangKey({langkey:'pg_Dft_TC_OrDtl_FreeCancellationTill'})}
                        //         // ,strBookingDateFrom: {name:'<span langkey="pg_Dft_TC_OrDtl_DateFrom"></span>'}
                        //         // ,strBookingDateTo: {name:'<span langkey="pg_Dft_TC_OrDtl_DateTo"></span>'}
                        //         ,intTotalPax_View: {name:'<span langkey="pg_Dft_TC_OrDtl_TotalPax"></span>', strAttrTD:'style="text-align:right"'}
                        //         ,dblPriceUnitView: {name:'<span langkey="pg_Dft_TC_OrDtl_PriceUnit"></span>', strAttrTD:'style="text-align:right"'}
                        //         ,dblPriceTotalView: {name:'<span langkey="pg_Dft_TC_OrDtl_PriceTotal"></span>', strAttrTD:'style="text-align:right"'}
                        //         // ,strHtmlAction: {name:'<span langkey="sys_Txt_Action"></span>', strAttrTD:''}
                        //     }
                        //     // ,editTableInput:function(){}
                        //     , changeCkbMaster: function (IsChecked, intRowID,arrList) {


                        //         ArrPriceTableItem = arrList
                        //     }
                        //     ,customEvent: function(_idOrClassPn){
                        //     }
                        //     // ,changeInput:function(){}
                        //     ,IsViewCheckBoxMain:false
                        //     ,idOrClass:IdOrClass_Pn + ' .pnList'
                        // })




                    }
                    objEvtPanel.pnContent = function (_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        // Obj_Payment['strServiceName'] = Obj_TourDetail.strServiceName
                        // Obj_Payment['strCompanyName'] = Obj_TourDetail.strCompanyName
                        Obj_Payment['dblPriceTotal_View'] = $.pngFormatPrice(options.dblTotalPrice)
                        Obj_Payment['dblPricePayment_View'] = '<a action="ViewListTerm">' + $.pngFormatPrice(Dbl_PriceCharge) + "</a>"


                        Obj_Payment['intPaymentMethodID'] = 11

                        var DblPriceCharge = 0//Obj_Payment['dblPricePayment']
                        var DblCreditRemain = 0

                        coreLoadPage.getCredit({
                            OnSuccess: function (obj) {
                                DblCreditRemain = obj.dblCreditRemain
                            }
                        })


                        Obj_FormInput = {

                            // strServiceName:{title:'Tour',attr:"class='col-md-4'"
                            //     ,input:{IsNoInput:true,IsViewDtl:true}
                            // },
                            // strCompanyName:{title:'Company Name',attr:"class='col-md-4'"
                            //     ,input:{IsNoInput:true,IsViewDtl:true}
                            // },
                            // _______1:{title:'',attr:"class='col-md-12' style=='margin:0'"
                            //     ,input:{IsNoInput:true}
                            // },
                            dblPriceTotal_View: {
                                title: 'Total Price', attr: "class='col-md-4'"
                                , input: { IsNoInput: true, IsViewDtl: true }
                            },
                            // dtmInvoiceDeadline_View:{title:'Deadline',attr:"class='col-md-4'"
                            //     ,input:{IsNoInput:true,IsViewDtl:true}
                            // },
                            dblPricePayment_View: {
                                title: 'Price Payment', attr: "class='col-md-4'"
                                , input: { IsNoInput: true, IsViewDtl: true }
                            },

                            _______2: {
                                title: '', attr: "class='col-md-12' style=='margin:0'"
                                , input: { IsNoInput: true }
                            },
                            IsPayment: {
                                title: 'Các dịch vụ chưa đến thời hạn trả tiền. Bạn có muốn thanh toán luôn không?', isRequire: false, attr: "class='col-md-12' ", IsRtn: false
                                , input: { IsNoInput: true }
                            },
                            intPaymentMethodID: {
                                title: 'Phương thức thanh toán', attr: "class='col-md-4'", isRequire: false, IsRtn: true
                                , input: { type: 'select', classEx: 'form-control', attr: '' }
                                , dropDown: { arrList: $.pngGetArrComboValue(Arr_PaymentMethod, 'intID', 'strName') }
                            },
                            pnPayEx: {
                                title: '', attr: "class='col-md-12'"
                                , input: { IsNoInput: true }
                            },
                            strPaidRemark: {
                                title: 'Remark', isRequire: false, attr: "class='col-md-12'", IsRtn: true
                                , input: { type: 'textarea', classEx: 'form-control', attr: 'rows="5" ' }//====> Có Attr ckeditor sẽ hiển thị CK Editor
                            }
                        }

                        pngPn.getForm({
                            action: 1,
                            objInput: Obj_FormInput,
                            idOrClass: IdOrClass_Pn,
                            objDetail: Obj_Payment,
                        })

                        if (Obj_PaymentAmountAndPeriod['IsPayment']) {
                            $('.pnElm-IsPayment', IdOrClass_Pn).parent().hide()
                        } else {
                            $('.pnElm-IsPayment', IdOrClass_Pn).parent().show()

                            Obj_Payment['dtmInvoiceDeadline'] = null
                            Obj_Payment['dblPricePayment'] = null

                            $('#btnPayment', IdOrClass_Main).attr('disabled', false)
                            $('.intPaymentMethodID,.pnElm-pnPayEx', IdOrClass_Pn).parent().hide()
                            // $('.IsPayment',IdOrClass_Pn).change(function(){

                            //     if(this.checked){
                            //         Obj_Payment['dtmInvoiceDeadline'] = $.pngFormatDateTime(Obj_PaymentAmountAndPeriod['dtmDateDeadline'],'l')
                            //         Obj_Payment['dblPricePayment'] = Obj_PaymentAmountAndPeriod['dblPriceCharge']

                            //         $('.intPaymentMethodID,.pnElm-pnPayEx',IdOrClass_Pn).parent().show()
                            //         $(".intPaymentMethodID",IdOrClass_Pn).change()
                            //     }else{

                            //         Obj_Payment['dtmInvoiceDeadline'] = null
                            //         Obj_Payment['dblPricePayment'] = null

                            //         $('#btnPayment',IdOrClass_Main).attr('disabled',false)
                            //         $('.intPaymentMethodID,.pnElm-pnPayEx',IdOrClass_Pn).parent().hide()
                            //     }
                            // }).change()
                        }

                        $('a', IdOrClass_Pn).click(function () {
                            var action = $(this).attr('action')

                            if (action == "ViewListTerm") {
                                console.log(Arr_TourPaymentTerm)
                                Get_PopUpViewListTerm({
                                    strUserGUID: options.strUserGUID
                                    , arrPaymentTerm: Arr_TourPaymentTerm.filter(function (item) { return (item.IsPayment) })
                                    , OnSuccess: function () { }
                                })
                            }
                        })

                        $(".intPaymentMethodID", IdOrClass_Pn).change(function () {
                            $('#btnPayment', IdOrClass_Main).attr('disabled', false)
                            Obj_Payment['strCompanyBankAccountGUID'] = null
                            var strHtml = ''

                            if (this.value == 11) {
                                strHtml += pngElm.getLangKey({ langkey: 'sys_Txt_Creditbalance' }) + ': <b>' + $.pngFormatPrice(DblCreditRemain) + '</b>'
                                $('.pnElm-pnPayEx').html(strHtml)

                                setTimeout(function () {
                                    if (DblPriceCharge > DblCreditRemain && ((!Obj_PaymentAmountAndPeriod['IsPayment'] && $('.IsPayment', IdOrClass_Pn).is(':checked')) || Obj_PaymentAmountAndPeriod['IsPayment'])) {
                                        $('#btnPayment', IdOrClass_Main).attr('disabled', true)
                                    }
                                }, 100)
                            }

                            if (this.value == 1) {

                                if (Arr_ListAccount.length == 0) {
                                    png.postListApiGetValue({
                                        objList_Api: ObjList_Api
                                        , objListApi_RtnVal: {
                                            'GetFilterCompanyBankAccount': {
                                                objParams_Cus: {}
                                                , OnSuccess: function (data) {
                                                    Arr_ListAccount = JSON.parse(data)[0]

                                                    GetPanelAccount()
                                                }
                                            }
                                        }
                                    })
                                } else {
                                    GetPanelAccount()
                                }
                                function GetPanelAccount() {

                                    strHtml += '<select class="form-control" style="width:inherit">'
                                    Arr_ListAccount.forEach(function (value) {
                                        strHtml += '<option value="' + value.strCompanyBankAccountGUID + '">' + value.strNameDisplay + '</option>'
                                    })
                                    strHtml += '</select>'
                                    strHtml += '<div id="pnCnt"></div>'
                                    $('.pnElm-pnPayEx').html(strHtml)


                                    $('.pnElm-pnPayEx').find('select').change(function () {
                                        var self = this
                                        Obj_Payment['strCompanyBankAccountGUID'] = this.value
                                        var obj = Arr_ListAccount.filter(function (item) { return item.strCompanyBankAccountGUID == self.value })[0]

                                        strHtml = ''
                                        strHtml += '<b>Account Name:</b> ' + obj.strCompanyBankAccountName
                                        strHtml += '<br><b>Account Code:</b> ' + obj.strCompanyBankAccountCode
                                        strHtml += '<br><b>Bank Name:</b> ' + obj.strCompanyBankAccountInfo
                                        strHtml += '<br><b>Bank Add:</b> ' + obj.strBankAddress
                                        strHtml += '<br><b>SwiftCode:</b> ' + obj.strSwiftCode
                                        $('.pnElm-pnPayEx #pnCnt').html(strHtml)

                                    }).change()
                                }




                            }

                            if (this.value == 3) {
                                // strHtml+= '<img src="https://logos-world.net/wp-content/uploads/2020/04/PayPal-Logo.png" style="height: 35px;">'
                                // strHtml+= '<img src="https://thietkelogo.com/wp-content/uploads/2017/10/logo-mastercard.jpg" style="height: 35px;">'
                                strHtml += 'Thanh toán qua <b>VN Pay</b>'
                                $('.pnElm-pnPayEx').html(strHtml)

                            }
                        }).change()



                    }
                    objEvtPanel.pnBtn = function (_idOrClassPn) {
                        var IdOrClass_Pn = _idOrClassPn

                        var strHtml = '<button id="btnPayment" class="btn btn-primary pn-round-10em">Thanh toán</button>'
                        $(IdOrClass_Pn).html(strHtml)

                        $('#btnPayment').click(function () {

                            $.Confirm({
                                strContent: '<span langkey="sys_Cfm_AYS"></span>'
                                , OnSuccess: function () {

                                    pngPn.getForm({
                                        action: 2,
                                        objInput: Obj_FormInput,
                                        idOrClass: IdOrClass_Main + ' #pnContent',
                                        OnChkSuccess: function (objRtn) {
                                            if (objRtn) {
                                                Obj_Payment = $.pngExtendObj(Obj_Payment, objRtn)
                                                // png.postListApiGetValue({
                                                //     objList_Api: ObjList_Api
                                                //     ,objListApi_RtnVal: {
                                                //         'GetCheckRemainForServicesBooking':{
                                                //             objParams_Cus: {}
                                                //             , OnSuccess: function(data){

                                                //                 var obj = JSON.parse(data)[0][0]

                                                //                 // Obj_Payment.strOrderBeforePaymentCode = obj.strOrderBeforePaymentCode
                                                //                 if(obj.IsCheckBooking){
                                                //                     if(Obj_PaymentAmountAndPeriod['IsPayment']){
                                                //                         if(Obj_Payment.intPaymentMethodID == 1){
                                                //                             GetAddBooking()
                                                //                         }

                                                //                         if(Obj_Payment.intPaymentMethodID == 3){
                                                //                             GetPayOnline()
                                                //                         }

                                                //                         if(Obj_Payment.intPaymentMethodID == 11){

                                                //                             png.postListApiGetValue({
                                                //                                 objList_Api: ObjList_Api
                                                //                                 ,objListApi_RtnVal: {
                                                //                                     'GetCheckRemainCreditForAddTourToBookingByAgent':{
                                                //                                         objParams_Cus: {}
                                                //                                         , OnSuccess: function(data){

                                                //                                             var obj = JSON.parse(data)[0][0]
                                                //                                             if(obj.IsCheckCredit){
                                                //                                                 GetAddBooking()
                                                //                                             }else{
                                                //                                                 $.Confirm({ strContent: 'You do not have enough Credit Limit. Your current credit amount is '+$.pngFormatPrice(obj.dblCreditRemain) });
                                                //                                             }

                                                //                                         }
                                                //                                     }
                                                //                                 }
                                                //                             })
                                                //                         }
                                                //                     }else{
                                                //                         Obj_Payment.intPaymentMethodID=null
                                                //                         GetAddBooking()
                                                //                     }
                                                //                 }else{
                                                //                     $.Confirm({ strContent: 'Service: '+obj.strServiceName+' > '+obj.intTotalPaxRemain+' Pax' });
                                                //                 }

                                                //             }
                                                //         }
                                                //     }
                                                // })

                                                GetAddBooking()




                                            }
                                        }
                                    })
                                }
                            })

                            function GetAddBooking() {

                                png.postListApiGetValue({
                                    objList_Api: ObjList_Api
                                    , objListApi_RtnVal: {
                                        'AddBookingForHotelInstant': {
                                            objParams_Cus: Obj_Payment
                                            , OnSuccess: function (data) {
                                                var obj = JSON.parse(data)[0][0]

                                                coreLoadPage.viewOrderBooking({
                                                    IsDelete: true
                                                })

                                                var strUrl = coreLoadPage.getUrlHost()
                                                strUrl = $.pngGetQSVal('cname', $.pngGetQSVal('cname'), strUrl)
                                                strUrl = $.pngGetQSVal('page', 'bookingdetail', strUrl)
                                                strUrl = $.pngGetQSVal('BKID', obj.strBookingGUID, strUrl)

                                                window.location.href = strUrl

                                            }
                                        }
                                    }
                                })

                            }

                            function GetPayOnline() {

                                png.postListApiGetValue({
                                    objList_Api: ObjList_Api
                                    , objListApi_RtnVal: {
                                        'AddPaymentTransactionByAgent': {
                                            objParams_Cus: {
                                                dblPaymentTransactionAmount: Obj_PaymentAmountAndPeriod['dblPriceCharge']
                                            }
                                            , OnSuccess: function (data) {
                                                var obj = JSON.parse(data)[0][0]
                                                png.postListApiGetValue({
                                                    objList_Api: ObjList_Api
                                                    , objListApi_RtnVal: {
                                                        'GetUrlPayOnline': {
                                                            objParams_Cus: {
                                                                strOrderBeforePaymentCode: obj['strPaymentTransactionCode']
                                                                , dblAmount: Obj_PaymentAmountAndPeriod['dblPriceCharge']
                                                                , strDescription: (Obj_Payment.strPaidRemark || "payment online")
                                                            }
                                                            , OnSuccess: function (data) {
                                                                window.location.href = JSON.parse(data).strPaymentUrl
                                                            }
                                                        },
                                                    }
                                                })
                                            }
                                        },
                                    }
                                })



                            }
                        })

                    }

                    // ===================================

                    pngPn.getPanelHtml({            // Get ra panel dạng html
                        objPanel: objPanel
                        , objEvtPanel: objEvtPanel
                        , idOrClass: IdOrClass_Main  // Id or class chính
                        , OnChangeIdPn: function (_Fn) {
                            Obj_FN_Main.pnMain = _Fn    // Hàm đổi trang
                        }
                    })

                }

                function Get_PopUpViewListTerm(_Opt) {
                    var Dft = {
                        strUserGUID: options.strUserGUID
                        , arrPaymentTerm: []
                        , OnSuccess: function () {

                        }
                    }
                    _Opt = $.extend(Dft, _Opt);

                    var IdOrClass_Main = ''
                    Obj_FN_Main.ppViewListTerm = {}
                    GetPopUp()
                    function GetPopUp() {
                        pngPn.getPopUp({
                            strTitle: 'View List Term'
                            , intTypeSize: 2//------------1 small ---2 medium ---3 large
                            , OnPanel: GetMainPanel
                            , OnClosePopUp: function () {
                                //------Chọn sự kiện khi Đóng PopUP
                            }
                        })
                    }

                    function GetMainPanel(_IdOrClassPp, _OnClosePp) {

                        IdOrClass_Main = _IdOrClassPp
                        Obj_FN_Main.ppViewListTerm.OnClosePp = _OnClosePp

                        // Obj_FN_Main.OnClosePp(true)----------- chạy câu lệnh trong OnClosePopUp: function (){} khi tắt PopUp
                        // Obj_FN_Main.OnClosePp(true,true)-----------Đóng Pop Up + chạy câu lệnh trong OnClosePopUp: function (){}


                        var objPanel = {                 // Khai báo các thành phần của panel
                            pnMain: {
                                tag: 'div', attr: 'class=""'
                                , childTags: [{ div: 'class="row"' }]
                                , pnContent: { tag: 'div', attr: 'class="col-md-12"' }
                            }
                        }

                        var objEvtPanel = {}
                        objEvtPanel.pnContent = function (_idOrClassPn) {
                            var IdOrClass_Pn = _idOrClassPn

                            pngPn.getTable2({
                                objApi: null
                                , objParams_Cus: null
                                , objCols: {
                                    No: { name: pngElm.getLangKey({ langkey: 'sys_Txt_Tbl-No' }) }
                                    , strFromDate: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_FromDate' }) }
                                    , strToDate: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_ToDate' }) }
                                    , dblPaymentPrice: { name: pngElm.getLangKey({ langkey: 'pg_Main_Tour_MdDtl_Payment' }) }
                                    // ,dblPaymentPercentage: {name:'Payment'}
                                }
                                , editRltArr: function (arr) {
                                    return _Opt.arrPaymentTerm
                                }
                                , editRlt: function (value, key) {

                                }
                                , customEvent: function (_idOrClassPn) {

                                }
                                , changeCkbMaster: function (_IsChecked, _intRowID, _arrList) {

                                    // Arr_ListTbl = _arrList
                                }
                                , IsViewCheckBoxMain: false
                                , idOrClass: IdOrClass_Pn
                            })
                        }

                        // ===================================

                        pngPn.getPanelHtml({            // Get ra panel dạng html
                            objPanel: objPanel
                            , objEvtPanel: objEvtPanel
                            , idOrClass: IdOrClass_Main  // Id or class chính
                            , OnChangeIdPn: function (_Fn) {
                                Obj_FN_Main.ppViewListTerm.pnMain = _Fn    // Hàm đổi trang
                            }
                        })



                    }

                }

            }


            coreSystem.getLoadPage({
                OnSuccess: function () {
                    $.ModuleMainLead_Hotel_Detail();
                }
            })

        </script>
    </app-content-display>